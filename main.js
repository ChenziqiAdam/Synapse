/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var __defProp = Object.defineProperty;
var __getOwnPropDesc = Object.getOwnPropertyDescriptor;
var __getOwnPropNames = Object.getOwnPropertyNames;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __export = (target, all) => {
  for (var name in all)
    __defProp(target, name, { get: all[name], enumerable: true });
};
var __copyProps = (to, from, except, desc) => {
  if (from && typeof from === "object" || typeof from === "function") {
    for (let key of __getOwnPropNames(from))
      if (!__hasOwnProp.call(to, key) && key !== except)
        __defProp(to, key, { get: () => from[key], enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable });
  }
  return to;
};
var __toCommonJS = (mod) => __copyProps(__defProp({}, "__esModule", { value: true }), mod);

// src/main.ts
var main_exports = {};
__export(main_exports, {
  default: () => SynapsePlugin
});
module.exports = __toCommonJS(main_exports);
var import_obsidian3 = require("obsidian");

// src/settings.ts
var DEFAULT_SETTINGS = {
  ollamaUrl: "http://localhost:11434",
  ollamaModel: "gemma3n:e2b",
  autoLinkEnabled: true,
  summaryLocation: "top",
  flashcardFormat: "simple",
  maxResponseLength: 1e3,
  explanationFolder: "Explanations",
  flashcardFolder: "Flashcards",
  useSummaryYaml: true,
  chatFolder: "Chats",
  enableLiveChat: true,
  enableLiveSuggestions: false,
  suggestionDelay: 3e3,
  // Simplified settings with defaults
  showGhostText: true,
  allowQuickAccept: true
};

// src/ui/SettingsTab.ts
var import_obsidian = require("obsidian");

// src/ollama.ts
var OllamaClient = class {
  constructor(baseUrl, model) {
    this.baseUrl = baseUrl.replace(/\/$/, "");
    this.model = model;
  }
  async isAvailable() {
    try {
      const response = await fetch(`${this.baseUrl}/api/tags`);
      return response.ok;
    } catch (error) {
      return false;
    }
  }
  async generate(prompt, systemPrompt, chatHistory) {
    try {
      let fullPrompt = prompt;
      if (chatHistory && chatHistory.trim()) {
        fullPrompt = `Chat history:
${chatHistory}

Current message: ${prompt}`;
      }
      const requestBody = {
        model: this.model,
        prompt: fullPrompt,
        system: systemPrompt || "",
        stream: false,
        options: {
          temperature: 0.7,
          top_p: 0.9,
          top_k: 40
        }
      };
      const response = await fetch(`${this.baseUrl}/api/generate`, {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify(requestBody)
      });
      if (!response.ok) {
        throw new Error(`Ollama API error: ${response.status}`);
      }
      const data = await response.json();
      return data.response.trim();
    } catch (error) {
      throw new Error(`Failed to generate response: ${error.message}`);
    }
  }
  async getAvailableModels() {
    var _a;
    try {
      const response = await fetch(`${this.baseUrl}/api/tags`);
      if (!response.ok) {
        throw new Error(`Failed to fetch models: ${response.status}`);
      }
      const data = await response.json();
      return ((_a = data.models) == null ? void 0 : _a.map((model) => model.name)) || [];
    } catch (error) {
      console.error("Error fetching models:", error);
      return [];
    }
  }
};

// src/ui/SettingsTab.ts
var SynapseSettingsTab = class extends import_obsidian.PluginSettingTab {
  constructor(app, plugin) {
    super(app, plugin);
    this.plugin = plugin;
  }
  display() {
    const { containerEl } = this;
    containerEl.empty();
    containerEl.createEl("h2", { text: "Synapse Settings" });
    containerEl.createEl("h3", { text: "Ollama Configuration" });
    new import_obsidian.Setting(containerEl).setName("Ollama URL").setDesc("URL where Ollama is running (default: http://localhost:11434)").addText((text) => text.setPlaceholder("http://localhost:11434").setValue(this.plugin.settings.ollamaUrl).onChange(async (value) => {
      this.plugin.settings.ollamaUrl = value;
      await this.plugin.saveSettings();
    }));
    new import_obsidian.Setting(containerEl).setName("Model").setDesc("Ollama model to use (e.g., phi3:mini, llama2, mistral)").addText((text) => text.setPlaceholder("phi3:mini").setValue(this.plugin.settings.ollamaModel).onChange(async (value) => {
      this.plugin.settings.ollamaModel = value;
      await this.plugin.saveSettings();
    }));
    new import_obsidian.Setting(containerEl).setName("Test Connection").setDesc("Test connection to Ollama").addButton((button) => button.setButtonText("Test").setCta().onClick(async () => {
      const client = new OllamaClient(this.plugin.settings.ollamaUrl, this.plugin.settings.ollamaModel);
      const isAvailable = await client.isAvailable();
      if (isAvailable) {
        button.setButtonText("\u2713 Connected");
        button.buttonEl.style.backgroundColor = "#4caf50";
        setTimeout(() => {
          button.setButtonText("Test");
          button.buttonEl.style.backgroundColor = "";
        }, 2e3);
      } else {
        button.setButtonText("\u2717 Failed");
        button.buttonEl.style.backgroundColor = "#f44336";
        setTimeout(() => {
          button.setButtonText("Test");
          button.buttonEl.style.backgroundColor = "";
        }, 2e3);
      }
    }));
    containerEl.createEl("h3", { text: "Feature Settings" });
    new import_obsidian.Setting(containerEl).setName("Auto-linking").setDesc('Automatically create links when using "Explain & Link"').addToggle((toggle) => toggle.setValue(this.plugin.settings.autoLinkEnabled).onChange(async (value) => {
      this.plugin.settings.autoLinkEnabled = value;
      await this.plugin.saveSettings();
    }));
    new import_obsidian.Setting(containerEl).setName("Summary Location").setDesc("Where to place summaries in notes").addDropdown((dropdown) => dropdown.addOption("top", "Top of note").addOption("bottom", "Bottom of note").setValue(this.plugin.settings.summaryLocation).onChange(async (value) => {
      this.plugin.settings.summaryLocation = value;
      await this.plugin.saveSettings();
    }));
    new import_obsidian.Setting(containerEl).setName("Use YAML for Summaries").setDesc("Add summaries to note frontmatter as YAML").addToggle((toggle) => toggle.setValue(this.plugin.settings.useSummaryYaml).onChange(async (value) => {
      this.plugin.settings.useSummaryYaml = value;
      await this.plugin.saveSettings();
    }));
    new import_obsidian.Setting(containerEl).setName("Max Response Length").setDesc("Maximum length for AI responses (characters)").addSlider((slider) => slider.setLimits(500, 3e3, 100).setValue(this.plugin.settings.maxResponseLength).setDynamicTooltip().onChange(async (value) => {
      this.plugin.settings.maxResponseLength = value;
      await this.plugin.saveSettings();
    }));
    containerEl.createEl("h3", { text: "Folder Organization" });
    new import_obsidian.Setting(containerEl).setName("Explanations Folder").setDesc("Folder for explanation notes (empty for vault root)").addText((text) => text.setPlaceholder("Explanations").setValue(this.plugin.settings.explanationFolder).onChange(async (value) => {
      this.plugin.settings.explanationFolder = value;
      await this.plugin.saveSettings();
    }));
    new import_obsidian.Setting(containerEl).setName("Flashcards Folder").setDesc("Folder for flashcard notes (empty for vault root)").addText((text) => text.setPlaceholder("Flashcards").setValue(this.plugin.settings.flashcardFolder).onChange(async (value) => {
      this.plugin.settings.flashcardFolder = value;
      await this.plugin.saveSettings();
    }));
    new import_obsidian.Setting(containerEl).setName("Chat Folder").setDesc("Folder for chat session notes (empty for vault root)").addText((text) => text.setPlaceholder("Chats").setValue(this.plugin.settings.chatFolder).onChange(async (value) => {
      this.plugin.settings.chatFolder = value;
      await this.plugin.saveSettings();
    }));
    containerEl.createEl("h3", { text: "Live Features" });
    new import_obsidian.Setting(containerEl).setName("Enable Live Chat").setDesc("Enable interactive chat sessions in notes").addToggle((toggle) => toggle.setValue(this.plugin.settings.enableLiveChat).onChange(async (value) => {
      this.plugin.settings.enableLiveChat = value;
      await this.plugin.saveSettings();
    }));
    new import_obsidian.Setting(containerEl).setName("Enable Live Suggestions").setDesc("Provide suggestions as you type (experimental)").addToggle((toggle) => toggle.setValue(this.plugin.settings.enableLiveSuggestions).onChange(async (value) => {
      this.plugin.settings.enableLiveSuggestions = value;
      await this.plugin.saveSettings();
      this.updateLiveFeatureSettingsVisibility();
    }));
    const liveSuggestionsContainer = containerEl.createDiv("synapse-live-settings");
    new import_obsidian.Setting(liveSuggestionsContainer).setName("Show Ghost Text").setDesc("Show suggested text completions as you type").addToggle((toggle) => toggle.setValue(this.plugin.settings.showGhostText).onChange(async (value) => {
      this.plugin.settings.showGhostText = value;
      await this.plugin.saveSettings();
    })).setDisabled(!this.plugin.settings.enableLiveSuggestions);
    new import_obsidian.Setting(liveSuggestionsContainer).setName("Allow Quick Accept").setDesc("Show accept button for suggestions").addToggle((toggle) => toggle.setValue(this.plugin.settings.allowQuickAccept).onChange(async (value) => {
      this.plugin.settings.allowQuickAccept = value;
      await this.plugin.saveSettings();
    })).setDisabled(!this.plugin.settings.enableLiveSuggestions);
    new import_obsidian.Setting(liveSuggestionsContainer).setName("Suggestion Delay").setDesc("Delay before showing suggestions (milliseconds)").addSlider((slider) => slider.setLimits(500, 5e3, 100).setValue(this.plugin.settings.suggestionDelay).setDynamicTooltip().onChange(async (value) => {
      this.plugin.settings.suggestionDelay = value;
      await this.plugin.saveSettings();
    })).setDisabled(!this.plugin.settings.enableLiveSuggestions);
    this.updateLiveFeatureSettingsVisibility();
    containerEl.createEl("h3", { text: "Usage Instructions" });
    const instructions = containerEl.createDiv();
    instructions.innerHTML = `
            <p><strong>Commands available:</strong></p>
            <ul>
                <li><strong>Explain & Link:</strong> Select text and use command palette or right-click menu</li>
                <li><strong>Summarize Note:</strong> Run command to summarize entire current note</li>
                <li><strong>Create Flashcards:</strong> Select text to generate study flashcards</li>
                <li><strong>Start Chat Session:</strong> Begin an interactive chat with the AI</li>
                <li><strong>Send Chat Message:</strong> In a chat note, send the current line to the AI</li>
            </ul>
            <p><strong>Requirements:</strong> Make sure Ollama is installed and running with your selected model.</p>
        `;
  }
  updateLiveFeatureSettingsVisibility() {
    const liveSettingsDiv = this.containerEl.querySelector(".synapse-live-settings");
    if (liveSettingsDiv) {
      liveSettingsDiv.style.display = this.plugin.settings.enableLiveSuggestions ? "block" : "none";
    }
  }
};

// src/commands.ts
var import_obsidian2 = require("obsidian");
var SynapseCommands = class {
  constructor(app, ollama, settings) {
    this.app = app;
    this.ollama = ollama;
    this.settings = settings;
  }
  updateSettings(settings) {
    this.settings = settings;
    this.ollama = new OllamaClient(settings.ollamaUrl, settings.ollamaModel);
  }
  async explainAndLink(editor, selectedText) {
    if (!selectedText.trim()) {
      new import_obsidian2.Notice("Please select text to explain");
      return;
    }
    const noticeLoading = new import_obsidian2.Notice("Generating explanation...", 0);
    try {
      const systemPrompt = `You are a helpful educational assistant. Create a clear, concise explanation of the given concept. 
            Format your response as a well-structured note with:
            1. A brief definition
            2. Key characteristics or properties
            3. A simple analogy or example if helpful
            4. Why this concept is important
            
            Keep the explanation under ${this.settings.maxResponseLength} characters and use clear, educational language.`;
      const prompt = `Explain this concept: "${selectedText}"`;
      const explanation = await this.ollama.generate(prompt, systemPrompt);
      const noteTitle = this.sanitizeFileName(selectedText);
      await this.ensureFolderExists(this.settings.explanationFolder);
      const filePath = `${this.settings.explanationFolder}/${noteTitle}.md`;
      const existingFile = this.app.vault.getAbstractFileByPath(filePath);
      if (existingFile instanceof import_obsidian2.TFile) {
        new import_obsidian2.Notice(`Note "${noteTitle}" already exists`);
        noticeLoading.hide();
        return;
      }
      const noteContent = `# ${noteTitle}

${explanation}

---
*Generated by Synapse AI*
*Created: ${new Date().toLocaleDateString()}*`;
      const newFile = await this.app.vault.create(filePath, noteContent);
      const link = `[[${filePath.replace(".md", "")}|${noteTitle}]]`;
      editor.replaceSelection(link);
      await this.app.workspace.getLeaf().openFile(newFile);
      noticeLoading.hide();
      new import_obsidian2.Notice(`Created and linked note: ${noteTitle}`);
    } catch (error) {
      noticeLoading.hide();
      new import_obsidian2.Notice(`Error: ${error.message}`);
      console.error("Explain and Link error:", error);
    }
  }
  async summarizeNote(editor, content) {
    var _a, _b;
    if (!content.trim()) {
      new import_obsidian2.Notice("No content to summarize");
      return;
    }
    const noticeLoading = new import_obsidian2.Notice("Generating summary...", 0);
    try {
      const systemPrompt = `You are a helpful assistant that creates concise summaries. 
            Create a bullet-point summary (3-5 points) of the main ideas in the given text. 
            Each bullet point should be clear and capture a key concept.
            Format as markdown bullets starting with "- ".`;
      const prompt = `Summarize this content:

${content}`;
      const summary = await this.ollama.generate(prompt, systemPrompt);
      let summarySection;
      if (this.settings.useSummaryYaml) {
        summarySection = `---
summary:
${summary.split("\n").map((line) => `  ${line}`).join("\n")}
---

`;
      } else {
        summarySection = `## Summary

${summary}

---

`;
      }
      if (this.settings.summaryLocation === "top") {
        const lines = content.split("\n");
        let insertIndex = 0;
        if ((_a = lines[0]) == null ? void 0 : _a.startsWith("---")) {
          let endFrontMatter = lines.findIndex((line, i) => i > 0 && line.startsWith("---"));
          if (endFrontMatter !== -1) {
            insertIndex = endFrontMatter + 1;
          }
        }
        if (this.settings.useSummaryYaml && ((_b = lines[0]) == null ? void 0 : _b.startsWith("---"))) {
          const endFrontMatter = lines.findIndex((line, i) => i > 0 && line.startsWith("---"));
          if (endFrontMatter !== -1) {
            const existingFrontmatter = lines.slice(0, endFrontMatter + 1).join("\n");
            const openFrontmatter = existingFrontmatter.replace(/---\s*$/, "");
            const summaryYaml = `summary:
${summary.split("\n").map((line) => `  ${line}`).join("\n")}
---`;
            const newContent2 = openFrontmatter + summaryYaml + "\n\n" + lines.slice(endFrontMatter + 1).join("\n");
            editor.setValue(newContent2);
            noticeLoading.hide();
            new import_obsidian2.Notice("Summary added to frontmatter");
            return;
          }
        }
        const newContent = [
          ...lines.slice(0, insertIndex),
          "",
          summarySection,
          ...lines.slice(insertIndex)
        ].join("\n");
        editor.setValue(newContent);
      } else {
        editor.setValue(content + "\n\n" + summarySection);
      }
      noticeLoading.hide();
      new import_obsidian2.Notice("Summary added to note");
    } catch (error) {
      noticeLoading.hide();
      new import_obsidian2.Notice(`Error: ${error.message}`);
      console.error("Summarize error:", error);
    }
  }
  async createFlashcards(editor, selectedText) {
    if (!selectedText.trim()) {
      new import_obsidian2.Notice("Please select text to create flashcards from");
      return;
    }
    const noticeLoading = new import_obsidian2.Notice("Creating flashcards...", 0);
    try {
      const systemPrompt = `You are a helpful assistant that creates study flashcards. 
            From the given text, identify 3-7 key concepts and create flashcards in this exact format:

            **Q:** Question here?
            **A:** Answer here

            Make questions clear and specific. Answers should be concise but complete.
            Focus on the most important concepts for learning and retention.`;
      const prompt = `Create flashcards from this content:

${selectedText}`;
      const flashcards = await this.ollama.generate(prompt, systemPrompt);
      const activeFile = this.app.workspace.getActiveFile();
      const noteTitle = activeFile ? activeFile.basename : "Untitled";
      await this.ensureFolderExists(this.settings.flashcardFolder);
      const flashcardFileName = `${this.settings.flashcardFolder}/${noteTitle} - Flashcards.md`;
      const flashcardContent = `# Flashcards for ${noteTitle}

${flashcards}

---
*Generated from: [[${activeFile ? activeFile.path.replace(".md", "") : "Unknown source"}]]*
*Created: ${new Date().toLocaleDateString()}*
`;
      const existingFile = this.app.vault.getAbstractFileByPath(flashcardFileName);
      if (existingFile instanceof import_obsidian2.TFile) {
        const existingContent = await this.app.vault.read(existingFile);
        const newContent = existingContent + "\n\n## New Flashcards\n\n" + flashcards;
        await this.app.vault.modify(existingFile, newContent);
        await this.app.workspace.getLeaf().openFile(existingFile);
        noticeLoading.hide();
        new import_obsidian2.Notice("Added flashcards to existing note");
      } else {
        const newFile = await this.app.vault.create(flashcardFileName, flashcardContent);
        await this.app.workspace.getLeaf().openFile(newFile);
        noticeLoading.hide();
        new import_obsidian2.Notice("Created new flashcards note");
      }
      const link = `

[[${flashcardFileName.replace(".md", "")}|Flashcards for this note]]
`;
      const cursor = editor.getCursor();
      editor.setLine(cursor.line, editor.getLine(cursor.line) + link);
    } catch (error) {
      noticeLoading.hide();
      new import_obsidian2.Notice(`Error: ${error.message}`);
      console.error("Create Flashcards error:", error);
    }
  }
  async startChatSession(editor) {
    await this.ensureFolderExists(this.settings.chatFolder);
    const timestamp = new Date().toISOString().replace(/[:.]/g, "-");
    const chatFileName = `${this.settings.chatFolder}/Chat-${timestamp}.md`;
    const chatTemplate = `# Chat Session ${new Date().toLocaleString()}

## Context
*This is a chat session with Synapse AI. Type your messages after the > prompt.*

## Chat

> 

`;
    const newFile = await this.app.vault.create(chatFileName, chatTemplate);
    const leaf = this.app.workspace.getLeaf();
    await leaf.openFile(newFile);
    const newEditor = this.getActiveEditor();
    if (newEditor) {
      const lines = chatTemplate.split("\n");
      const promptLine = lines.findIndex((line) => line === "> ");
      if (promptLine !== -1) {
        newEditor.setCursor({ line: promptLine, ch: 2 });
        newEditor.focus();
      }
    }
    new import_obsidian2.Notice("Started new chat session");
  }
  async sendChatMessage(editor) {
    const content = editor.getValue();
    const lines = content.split("\n");
    const currentLine = editor.getCursor().line;
    let promptLine = currentLine;
    while (promptLine >= 0 && !lines[promptLine].startsWith(">")) {
      promptLine--;
    }
    if (promptLine < 0) {
      new import_obsidian2.Notice("No chat prompt found. Please start message with >");
      return;
    }
    const userMessage = lines[promptLine].substring(2).trim();
    if (!userMessage) {
      new import_obsidian2.Notice("Please type a message first");
      return;
    }
    lines[promptLine] = `> ${userMessage}`;
    lines.splice(promptLine + 1, 0, "\n_Synapse is thinking..._");
    editor.setValue(lines.join("\n"));
    const chatHistory = this.extractChatHistory(lines, promptLine);
    try {
      const systemPrompt = `You are a helpful AI assistant in a chat session. 
            Provide thoughtful, concise responses to the user's questions.
            Use markdown formatting when appropriate.
            Reference prior messages in the conversation when relevant.`;
      const response = await this.ollama.generate(userMessage, systemPrompt, chatHistory);
      lines.splice(promptLine + 1, 1);
      lines.splice(
        promptLine + 1,
        0,
        `
${response}
`,
        `> `
      );
      const scrollInfo = editor.getScrollInfo ? editor.getScrollInfo() : null;
      editor.setValue(lines.join("\n"));
      setTimeout(() => {
        const updatedContent = editor.getValue();
        const updatedLines = updatedContent.split("\n");
        let newPromptLine = -1;
        for (let i = promptLine + 1; i < updatedLines.length; i++) {
          if (updatedLines[i] === "> ") {
            newPromptLine = i;
            break;
          }
        }
        if (newPromptLine >= 0) {
          editor.setCursor({ line: newPromptLine, ch: 2 });
          const cmEditor = editor.cm;
          if (cmEditor) {
            if (cmEditor.scrollIntoView) {
              cmEditor.scrollIntoView({
                line: newPromptLine,
                ch: 2
              }, 100);
            }
          } else {
            editor.scrollIntoView({
              from: { line: newPromptLine, ch: 0 },
              to: { line: newPromptLine, ch: 2 }
            }, true);
          }
          const editorElement = document.querySelector(".cm-scroller");
          if (editorElement) {
            editorElement.scrollTop = editorElement.scrollHeight;
          }
          editor.focus();
        }
      }, 100);
    } catch (error) {
      new import_obsidian2.Notice(`Error: ${error.message}`);
      console.error("Chat error:", error);
      lines.splice(promptLine + 1, 1);
      lines.splice(promptLine + 1, 0, "_Error: Could not generate response_");
      editor.setValue(lines.join("\n"));
    }
  }
  async generateLiveSuggestion(editor) {
    if (!this.settings.enableLiveSuggestions)
      return;
    const content = editor.getValue();
    const cursor = editor.getCursor();
    const currentLine = cursor.line;
    const contextLines = content.split("\n").slice(Math.max(0, currentLine - 5), currentLine + 1);
    const context = contextLines.join("\n");
    if (context.trim().length < 10)
      return;
    try {
      const systemPrompt = `You are an AI writing assistant. 
            Based on the context provided, suggest a brief continuation (1-3 words maximum).
            Make your suggestion directly relevant to what's being written.
            Do not repeat what's already written.`;
      const response = await this.ollama.generate(`Continue this text: ${context}`, systemPrompt);
      this.displayGhostText(editor, response);
    } catch (error) {
      console.error("Suggestion error:", error);
    }
  }
  displayGhostText(editor, text) {
    if (!this.settings.showGhostText)
      return;
    const notice = new import_obsidian2.Notice(`Suggestion: ${text.substring(0, 50)}${text.length > 50 ? "..." : ""}`, 5e3);
    if (this.settings.allowQuickAccept) {
      const noticeEl = notice.noticeEl;
      const buttonContainer = noticeEl.createDiv("synapse-suggestion-actions");
      const acceptButton = buttonContainer.createEl("button", {
        text: "Accept",
        cls: "synapse-accept-button"
      });
      acceptButton.addEventListener("click", () => {
        const cursor = editor.getCursor();
        editor.replaceRange(text, cursor);
        notice.hide();
      });
    }
  }
  sanitizeFileName(text) {
    return text.replace(/[^\w\s-]/g, "").replace(/\s+/g, " ").trim().substring(0, 50);
  }
  async ensureFolderExists(folderPath) {
    if (!folderPath)
      return;
    const folders = folderPath.split("/").filter((p) => p.trim());
    let currentPath = "";
    for (const folder of folders) {
      currentPath = currentPath ? `${currentPath}/${folder}` : folder;
      if (!this.app.vault.getAbstractFileByPath(currentPath)) {
        try {
          await this.app.vault.createFolder(currentPath);
        } catch (error) {
          console.error(`Failed to create folder ${currentPath}:`, error);
        }
      }
    }
  }
  getActiveEditor() {
    const view = this.app.workspace.getActiveViewOfType(import_obsidian2.MarkdownView);
    return (view == null ? void 0 : view.editor) || null;
  }
  extractChatHistory(lines, currentPromptLine) {
    let chatHistory = "";
    let inChat = false;
    for (let i = 0; i < currentPromptLine; i++) {
      const line = lines[i];
      if (line === "## Chat") {
        inChat = true;
        continue;
      }
      if (inChat) {
        if (line.startsWith("> ")) {
          chatHistory += `User: ${line.substring(2)}
`;
        } else if (line.trim() && !line.startsWith("_") && line !== "") {
          chatHistory += `AI: ${line}
`;
        }
      }
    }
    return chatHistory;
  }
};

// src/main.ts
var SynapsePlugin = class extends import_obsidian3.Plugin {
  async onload() {
    await this.loadSettings();
    this.ollama = new OllamaClient(this.settings.ollamaUrl, this.settings.ollamaModel);
    this.commands = new SynapseCommands(this.app, this.ollama, this.settings);
    this.debouncedSuggestion = (0, import_obsidian3.debounce)(
      (editor) => this.commands.generateLiveSuggestion(editor),
      this.settings.suggestionDelay
    );
    this.addSettingTab(new SynapseSettingsTab(this.app, this));
    this.addCommand({
      id: "explain-and-link",
      name: "Explain & Link Selected Text",
      editorCallback: (editor) => {
        const selectedText = editor.getSelection();
        this.commands.explainAndLink(editor, selectedText);
      }
    });
    this.addCommand({
      id: "summarize-note",
      name: "Summarize Current Note",
      editorCallback: (editor) => {
        const content = editor.getValue();
        this.commands.summarizeNote(editor, content);
      }
    });
    this.addCommand({
      id: "create-flashcards",
      name: "Create Flashcards from Selection",
      editorCallback: (editor) => {
        const selectedText = editor.getSelection();
        this.commands.createFlashcards(editor, selectedText);
      }
    });
    this.addCommand({
      id: "start-chat",
      name: "Start New Chat Session",
      editorCallback: (editor) => {
        this.commands.startChatSession(editor);
      }
    });
    this.addCommand({
      id: "send-chat-message",
      name: "Send Chat Message",
      editorCallback: (editor) => {
        this.commands.sendChatMessage(editor);
      }
    });
    this.addCommand({
      id: "toggle-live-suggestions",
      name: "Toggle Live Suggestions",
      callback: () => {
        this.settings.enableLiveSuggestions = !this.settings.enableLiveSuggestions;
        this.saveSettings();
        new import_obsidian3.Notice(`Live suggestions ${this.settings.enableLiveSuggestions ? "enabled" : "disabled"}`);
      }
    });
    this.registerEvent(
      this.app.workspace.on("editor-menu", (menu, editor) => {
        var _a;
        const selectedText = editor.getSelection();
        if (selectedText) {
          menu.addItem((item) => {
            item.setTitle("\u{1F9E0} Explain & Link").setIcon("brain-circuit").onClick(async () => {
              await this.commands.explainAndLink(editor, selectedText);
            });
          });
          menu.addItem((item) => {
            item.setTitle("\u{1F3B4} Create Flashcards").setIcon("card-stack").onClick(async () => {
              await this.commands.createFlashcards(editor, selectedText);
            });
          });
        }
        menu.addItem((item) => {
          item.setTitle("\u{1F4DD} Summarize Note").setIcon("list-checks").onClick(async () => {
            const content = editor.getValue();
            await this.commands.summarizeNote(editor, content);
          });
        });
        const fileName = ((_a = this.app.workspace.getActiveFile()) == null ? void 0 : _a.basename) || "";
        if (fileName.startsWith("Chat-")) {
          menu.addItem((item) => {
            item.setTitle("\u{1F4AC} Send Chat Message").setIcon("message-square").onClick(async () => {
              await this.commands.sendChatMessage(editor);
            });
          });
        } else {
          menu.addItem((item) => {
            item.setTitle("\u{1F4AC} Start Chat Session").setIcon("message-circle").onClick(async () => {
              await this.commands.startChatSession(editor);
            });
          });
        }
      })
    );
    this.registerLiveSuggestionEvents();
    this.checkOllamaConnection();
    console.log("Synapse plugin loaded");
  }
  onunload() {
    console.log("Synapse plugin unloaded");
  }
  async loadSettings() {
    this.settings = Object.assign({}, DEFAULT_SETTINGS, await this.loadData());
  }
  async saveSettings() {
    await this.saveData(this.settings);
    this.commands.updateSettings(this.settings);
    this.debouncedSuggestion = (0, import_obsidian3.debounce)(
      (editor) => this.commands.generateLiveSuggestion(editor),
      this.settings.suggestionDelay
    );
    this.registerLiveSuggestionEvents();
  }
  registerLiveSuggestionEvents() {
    if (this.liveSuggestionEvent) {
      this.app.workspace.off("editor-change", this.liveSuggestionEvent);
    }
    if (this.settings.enableLiveSuggestions) {
      this.liveSuggestionEvent = this.app.workspace.on("editor-change", (editor) => {
        this.debouncedSuggestion(editor);
      });
      this.registerEvent(this.liveSuggestionEvent);
    }
  }
  async checkOllamaConnection() {
    const isAvailable = await this.ollama.isAvailable();
    if (!isAvailable) {
      new import_obsidian3.Notice(
        "Synapse: Cannot connect to Ollama. Please make sure Ollama is running on " + this.settings.ollamaUrl,
        8e3
      );
    } else {
      new import_obsidian3.Notice("Synapse: Connected to Ollama successfully", 3e3);
    }
  }
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsic3JjL21haW4udHMiLCAic3JjL3NldHRpbmdzLnRzIiwgInNyYy91aS9TZXR0aW5nc1RhYi50cyIsICJzcmMvb2xsYW1hLnRzIiwgInNyYy9jb21tYW5kcy50cyJdLAogICJzb3VyY2VzQ29udGVudCI6IFsiaW1wb3J0IHsgUGx1Z2luLCBFZGl0b3IsIE1hcmtkb3duVmlldywgTWVudSwgTm90aWNlLCBkZWJvdW5jZSB9IGZyb20gJ29ic2lkaWFuJztcbmltcG9ydCB7IFN5bmFwc2VTZXR0aW5ncywgREVGQVVMVF9TRVRUSU5HUyB9IGZyb20gJy4vc2V0dGluZ3MnO1xuaW1wb3J0IHsgU3luYXBzZVNldHRpbmdzVGFiIH0gZnJvbSAnLi91aS9TZXR0aW5nc1RhYic7XG5pbXBvcnQgeyBPbGxhbWFDbGllbnQgfSBmcm9tICcuL29sbGFtYSc7XG5pbXBvcnQgeyBTeW5hcHNlQ29tbWFuZHMgfSBmcm9tICcuL2NvbW1hbmRzJztcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgU3luYXBzZVBsdWdpbiBleHRlbmRzIFBsdWdpbiB7XG4gICAgc2V0dGluZ3M6IFN5bmFwc2VTZXR0aW5ncztcbiAgICBvbGxhbWE6IE9sbGFtYUNsaWVudDtcbiAgICBjb21tYW5kczogU3luYXBzZUNvbW1hbmRzO1xuICAgIGRlYm91bmNlZFN1Z2dlc3Rpb246IGFueTtcbiAgICBsaXZlU3VnZ2VzdGlvbkV2ZW50OiBhbnk7XG5cbiAgICBhc3luYyBvbmxvYWQoKSB7XG4gICAgICAgIGF3YWl0IHRoaXMubG9hZFNldHRpbmdzKCk7XG5cbiAgICAgICAgLy8gSW5pdGlhbGl6ZSBPbGxhbWEgY2xpZW50IGFuZCBjb21tYW5kc1xuICAgICAgICB0aGlzLm9sbGFtYSA9IG5ldyBPbGxhbWFDbGllbnQodGhpcy5zZXR0aW5ncy5vbGxhbWFVcmwsIHRoaXMuc2V0dGluZ3Mub2xsYW1hTW9kZWwpO1xuICAgICAgICB0aGlzLmNvbW1hbmRzID0gbmV3IFN5bmFwc2VDb21tYW5kcyh0aGlzLmFwcCwgdGhpcy5vbGxhbWEsIHRoaXMuc2V0dGluZ3MpO1xuXG4gICAgICAgIC8vIFNldCB1cCBkZWJvdW5jZWQgc3VnZ2VzdGlvbiB3aXRoIG1vcmUgYWR2YW5jZWQgZmVhdHVyZXNcbiAgICAgICAgdGhpcy5kZWJvdW5jZWRTdWdnZXN0aW9uID0gZGVib3VuY2UoXG4gICAgICAgICAgICAoZWRpdG9yOiBFZGl0b3IpID0+IHRoaXMuY29tbWFuZHMuZ2VuZXJhdGVMaXZlU3VnZ2VzdGlvbihlZGl0b3IpLFxuICAgICAgICAgICAgdGhpcy5zZXR0aW5ncy5zdWdnZXN0aW9uRGVsYXlcbiAgICAgICAgKTtcblxuICAgICAgICAvLyBBZGQgc2V0dGluZ3MgdGFiXG4gICAgICAgIHRoaXMuYWRkU2V0dGluZ1RhYihuZXcgU3luYXBzZVNldHRpbmdzVGFiKHRoaXMuYXBwLCB0aGlzKSk7XG5cbiAgICAgICAgLy8gUmVnaXN0ZXIgY29tbWFuZHNcbiAgICAgICAgdGhpcy5hZGRDb21tYW5kKHtcbiAgICAgICAgICAgIGlkOiAnZXhwbGFpbi1hbmQtbGluaycsXG4gICAgICAgICAgICBuYW1lOiAnRXhwbGFpbiAmIExpbmsgU2VsZWN0ZWQgVGV4dCcsXG4gICAgICAgICAgICBlZGl0b3JDYWxsYmFjazogKGVkaXRvcjogRWRpdG9yKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3Qgc2VsZWN0ZWRUZXh0ID0gZWRpdG9yLmdldFNlbGVjdGlvbigpO1xuICAgICAgICAgICAgICAgIHRoaXMuY29tbWFuZHMuZXhwbGFpbkFuZExpbmsoZWRpdG9yLCBzZWxlY3RlZFRleHQpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGhpcy5hZGRDb21tYW5kKHtcbiAgICAgICAgICAgIGlkOiAnc3VtbWFyaXplLW5vdGUnLFxuICAgICAgICAgICAgbmFtZTogJ1N1bW1hcml6ZSBDdXJyZW50IE5vdGUnLFxuICAgICAgICAgICAgZWRpdG9yQ2FsbGJhY2s6IChlZGl0b3I6IEVkaXRvcikgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IGNvbnRlbnQgPSBlZGl0b3IuZ2V0VmFsdWUoKTtcbiAgICAgICAgICAgICAgICB0aGlzLmNvbW1hbmRzLnN1bW1hcml6ZU5vdGUoZWRpdG9yLCBjb250ZW50KTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRoaXMuYWRkQ29tbWFuZCh7XG4gICAgICAgICAgICBpZDogJ2NyZWF0ZS1mbGFzaGNhcmRzJyxcbiAgICAgICAgICAgIG5hbWU6ICdDcmVhdGUgRmxhc2hjYXJkcyBmcm9tIFNlbGVjdGlvbicsXG4gICAgICAgICAgICBlZGl0b3JDYWxsYmFjazogKGVkaXRvcjogRWRpdG9yKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3Qgc2VsZWN0ZWRUZXh0ID0gZWRpdG9yLmdldFNlbGVjdGlvbigpO1xuICAgICAgICAgICAgICAgIHRoaXMuY29tbWFuZHMuY3JlYXRlRmxhc2hjYXJkcyhlZGl0b3IsIHNlbGVjdGVkVGV4dCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9KTtcbiAgICAgICAgXG4gICAgICAgIC8vIEFkZCBuZXcgY2hhdCBjb21tYW5kc1xuICAgICAgICB0aGlzLmFkZENvbW1hbmQoe1xuICAgICAgICAgICAgaWQ6ICdzdGFydC1jaGF0JyxcbiAgICAgICAgICAgIG5hbWU6ICdTdGFydCBOZXcgQ2hhdCBTZXNzaW9uJyxcbiAgICAgICAgICAgIGVkaXRvckNhbGxiYWNrOiAoZWRpdG9yOiBFZGl0b3IpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmNvbW1hbmRzLnN0YXJ0Q2hhdFNlc3Npb24oZWRpdG9yKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0pO1xuICAgICAgICBcbiAgICAgICAgdGhpcy5hZGRDb21tYW5kKHtcbiAgICAgICAgICAgIGlkOiAnc2VuZC1jaGF0LW1lc3NhZ2UnLFxuICAgICAgICAgICAgbmFtZTogJ1NlbmQgQ2hhdCBNZXNzYWdlJyxcbiAgICAgICAgICAgIGVkaXRvckNhbGxiYWNrOiAoZWRpdG9yOiBFZGl0b3IpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmNvbW1hbmRzLnNlbmRDaGF0TWVzc2FnZShlZGl0b3IpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gQWRkIG5ldyBjb21tYW5kIGZvciBMaXZlIENvcGlsb3RcbiAgICAgICAgdGhpcy5hZGRDb21tYW5kKHtcbiAgICAgICAgICAgIGlkOiAndG9nZ2xlLWxpdmUtc3VnZ2VzdGlvbnMnLFxuICAgICAgICAgICAgbmFtZTogJ1RvZ2dsZSBMaXZlIFN1Z2dlc3Rpb25zJyxcbiAgICAgICAgICAgIGNhbGxiYWNrOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5zZXR0aW5ncy5lbmFibGVMaXZlU3VnZ2VzdGlvbnMgPSAhdGhpcy5zZXR0aW5ncy5lbmFibGVMaXZlU3VnZ2VzdGlvbnM7XG4gICAgICAgICAgICAgICAgdGhpcy5zYXZlU2V0dGluZ3MoKTtcbiAgICAgICAgICAgICAgICBuZXcgTm90aWNlKGBMaXZlIHN1Z2dlc3Rpb25zICR7dGhpcy5zZXR0aW5ncy5lbmFibGVMaXZlU3VnZ2VzdGlvbnMgPyAnZW5hYmxlZCcgOiAnZGlzYWJsZWQnfWApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICAvLyBBZGQgY29udGV4dCBtZW51IGl0ZW1zXG4gICAgICAgIHRoaXMucmVnaXN0ZXJFdmVudChcbiAgICAgICAgICAgIHRoaXMuYXBwLndvcmtzcGFjZS5vbignZWRpdG9yLW1lbnUnLCAobWVudTogTWVudSwgZWRpdG9yOiBFZGl0b3IpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBzZWxlY3RlZFRleHQgPSBlZGl0b3IuZ2V0U2VsZWN0aW9uKCk7XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgaWYgKHNlbGVjdGVkVGV4dCkge1xuICAgICAgICAgICAgICAgICAgICBtZW51LmFkZEl0ZW0oKGl0ZW0pID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuc2V0VGl0bGUoJ1x1RDgzRVx1RERFMCBFeHBsYWluICYgTGluaycpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLnNldEljb24oJ2JyYWluLWNpcmN1aXQnKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5vbkNsaWNrKGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5jb21tYW5kcy5leHBsYWluQW5kTGluayhlZGl0b3IsIHNlbGVjdGVkVGV4dCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgIG1lbnUuYWRkSXRlbSgoaXRlbSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgaXRlbVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5zZXRUaXRsZSgnXHVEODNDXHVERkI0IENyZWF0ZSBGbGFzaGNhcmRzJylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuc2V0SWNvbignY2FyZC1zdGFjaycpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLm9uQ2xpY2soYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLmNvbW1hbmRzLmNyZWF0ZUZsYXNoY2FyZHMoZWRpdG9yLCBzZWxlY3RlZFRleHQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBtZW51LmFkZEl0ZW0oKGl0ZW0pID0+IHtcbiAgICAgICAgICAgICAgICAgICAgaXRlbVxuICAgICAgICAgICAgICAgICAgICAgICAgLnNldFRpdGxlKCdcdUQ4M0RcdURDREQgU3VtbWFyaXplIE5vdGUnKVxuICAgICAgICAgICAgICAgICAgICAgICAgLnNldEljb24oJ2xpc3QtY2hlY2tzJylcbiAgICAgICAgICAgICAgICAgICAgICAgIC5vbkNsaWNrKGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjb250ZW50ID0gZWRpdG9yLmdldFZhbHVlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5jb21tYW5kcy5zdW1tYXJpemVOb3RlKGVkaXRvciwgY29udGVudCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAvLyBBZGQgY2hhdCBvcHRpb25cbiAgICAgICAgICAgICAgICBjb25zdCBmaWxlTmFtZSA9IHRoaXMuYXBwLndvcmtzcGFjZS5nZXRBY3RpdmVGaWxlKCk/LmJhc2VuYW1lIHx8ICcnO1xuICAgICAgICAgICAgICAgIGlmIChmaWxlTmFtZS5zdGFydHNXaXRoKCdDaGF0LScpKSB7XG4gICAgICAgICAgICAgICAgICAgIG1lbnUuYWRkSXRlbSgoaXRlbSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgaXRlbVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5zZXRUaXRsZSgnXHVEODNEXHVEQ0FDIFNlbmQgQ2hhdCBNZXNzYWdlJylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuc2V0SWNvbignbWVzc2FnZS1zcXVhcmUnKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5vbkNsaWNrKGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5jb21tYW5kcy5zZW5kQ2hhdE1lc3NhZ2UoZWRpdG9yKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgbWVudS5hZGRJdGVtKChpdGVtKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpdGVtXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLnNldFRpdGxlKCdcdUQ4M0RcdURDQUMgU3RhcnQgQ2hhdCBTZXNzaW9uJylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuc2V0SWNvbignbWVzc2FnZS1jaXJjbGUnKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5vbkNsaWNrKGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5jb21tYW5kcy5zdGFydENoYXRTZXNzaW9uKGVkaXRvcik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pXG4gICAgICAgICk7XG4gICAgICAgIFxuICAgICAgICAvLyBSZWdpc3RlciBlZGl0b3IgZXZlbnQgZm9yIGxpdmUgc3VnZ2VzdGlvbnNcbiAgICAgICAgdGhpcy5yZWdpc3RlckxpdmVTdWdnZXN0aW9uRXZlbnRzKCk7XG5cbiAgICAgICAgLy8gQ2hlY2sgT2xsYW1hIGF2YWlsYWJpbGl0eSBvbiBzdGFydHVwXG4gICAgICAgIHRoaXMuY2hlY2tPbGxhbWFDb25uZWN0aW9uKCk7XG5cbiAgICAgICAgY29uc29sZS5sb2coJ1N5bmFwc2UgcGx1Z2luIGxvYWRlZCcpO1xuICAgIH1cblxuICAgIG9udW5sb2FkKCkge1xuICAgICAgICBjb25zb2xlLmxvZygnU3luYXBzZSBwbHVnaW4gdW5sb2FkZWQnKTtcbiAgICB9XG5cbiAgICBhc3luYyBsb2FkU2V0dGluZ3MoKSB7XG4gICAgICAgIHRoaXMuc2V0dGluZ3MgPSBPYmplY3QuYXNzaWduKHt9LCBERUZBVUxUX1NFVFRJTkdTLCBhd2FpdCB0aGlzLmxvYWREYXRhKCkpO1xuICAgIH1cblxuICAgIGFzeW5jIHNhdmVTZXR0aW5ncygpIHtcbiAgICAgICAgYXdhaXQgdGhpcy5zYXZlRGF0YSh0aGlzLnNldHRpbmdzKTtcbiAgICAgICAgLy8gVXBkYXRlIGNvbW1hbmRzIHdpdGggbmV3IHNldHRpbmdzXG4gICAgICAgIHRoaXMuY29tbWFuZHMudXBkYXRlU2V0dGluZ3ModGhpcy5zZXR0aW5ncyk7XG4gICAgICAgIFxuICAgICAgICAvLyBSZS1pbml0aWFsaXplIGRlYm91bmNlZCBzdWdnZXN0aW9uIHdpdGggbmV3IGRlbGF5XG4gICAgICAgIHRoaXMuZGVib3VuY2VkU3VnZ2VzdGlvbiA9IGRlYm91bmNlKFxuICAgICAgICAgICAgKGVkaXRvcjogRWRpdG9yKSA9PiB0aGlzLmNvbW1hbmRzLmdlbmVyYXRlTGl2ZVN1Z2dlc3Rpb24oZWRpdG9yKSxcbiAgICAgICAgICAgIHRoaXMuc2V0dGluZ3Muc3VnZ2VzdGlvbkRlbGF5XG4gICAgICAgICk7XG4gICAgICAgIFxuICAgICAgICAvLyBVcGRhdGUgZXZlbnQgbGlzdGVuZXJzIGZvciBsaXZlIHN1Z2dlc3Rpb25zXG4gICAgICAgIHRoaXMucmVnaXN0ZXJMaXZlU3VnZ2VzdGlvbkV2ZW50cygpO1xuICAgIH1cblxuICAgIHByaXZhdGUgcmVnaXN0ZXJMaXZlU3VnZ2VzdGlvbkV2ZW50cygpIHtcbiAgICAgICAgLy8gVW5yZWdpc3RlciBleGlzdGluZyBldmVudCBpZiBuZWVkZWRcbiAgICAgICAgaWYgKHRoaXMubGl2ZVN1Z2dlc3Rpb25FdmVudCkge1xuICAgICAgICAgICAgdGhpcy5hcHAud29ya3NwYWNlLm9mZignZWRpdG9yLWNoYW5nZScsIHRoaXMubGl2ZVN1Z2dlc3Rpb25FdmVudCk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBPbmx5IHJlZ2lzdGVyIGlmIGZlYXR1cmUgaXMgZW5hYmxlZFxuICAgICAgICBpZiAodGhpcy5zZXR0aW5ncy5lbmFibGVMaXZlU3VnZ2VzdGlvbnMpIHtcbiAgICAgICAgICAgIHRoaXMubGl2ZVN1Z2dlc3Rpb25FdmVudCA9IHRoaXMuYXBwLndvcmtzcGFjZS5vbignZWRpdG9yLWNoYW5nZScsIChlZGl0b3I6IEVkaXRvcikgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuZGVib3VuY2VkU3VnZ2VzdGlvbihlZGl0b3IpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB0aGlzLnJlZ2lzdGVyRXZlbnQodGhpcy5saXZlU3VnZ2VzdGlvbkV2ZW50KTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgYXN5bmMgY2hlY2tPbGxhbWFDb25uZWN0aW9uKCkge1xuICAgICAgICBjb25zdCBpc0F2YWlsYWJsZSA9IGF3YWl0IHRoaXMub2xsYW1hLmlzQXZhaWxhYmxlKCk7XG4gICAgICAgIFxuICAgICAgICBpZiAoIWlzQXZhaWxhYmxlKSB7XG4gICAgICAgICAgICBuZXcgTm90aWNlKFxuICAgICAgICAgICAgICAgICdTeW5hcHNlOiBDYW5ub3QgY29ubmVjdCB0byBPbGxhbWEuIFBsZWFzZSBtYWtlIHN1cmUgT2xsYW1hIGlzIHJ1bm5pbmcgb24gJyArIFxuICAgICAgICAgICAgICAgIHRoaXMuc2V0dGluZ3Mub2xsYW1hVXJsLCBcbiAgICAgICAgICAgICAgICA4MDAwXG4gICAgICAgICAgICApO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgbmV3IE5vdGljZSgnU3luYXBzZTogQ29ubmVjdGVkIHRvIE9sbGFtYSBzdWNjZXNzZnVsbHknLCAzMDAwKTtcbiAgICAgICAgfVxuICAgIH1cbn0iLCAiZXhwb3J0IGludGVyZmFjZSBTeW5hcHNlU2V0dGluZ3Mge1xuICAgIG9sbGFtYVVybDogc3RyaW5nO1xuICAgIG9sbGFtYU1vZGVsOiBzdHJpbmc7XG4gICAgYXV0b0xpbmtFbmFibGVkOiBib29sZWFuO1xuICAgIHN1bW1hcnlMb2NhdGlvbjogJ3RvcCcgfCAnYm90dG9tJztcbiAgICBmbGFzaGNhcmRGb3JtYXQ6ICdzaW1wbGUnIHwgJ3NwYWNlZCc7XG4gICAgbWF4UmVzcG9uc2VMZW5ndGg6IG51bWJlcjtcbiAgICBleHBsYW5hdGlvbkZvbGRlcjogc3RyaW5nO1xuICAgIGZsYXNoY2FyZEZvbGRlcjogc3RyaW5nO1xuICAgIHVzZVN1bW1hcnlZYW1sOiBib29sZWFuO1xuICAgIGNoYXRGb2xkZXI6IHN0cmluZztcbiAgICBlbmFibGVMaXZlQ2hhdDogYm9vbGVhbjtcbiAgICBlbmFibGVMaXZlU3VnZ2VzdGlvbnM6IGJvb2xlYW47XG4gICAgc3VnZ2VzdGlvbkRlbGF5OiBudW1iZXI7XG4gICAgLy8gU2ltcGxpZmllZCBMaXZlIENvcGlsb3Qgc2V0dGluZ3NcbiAgICBzaG93R2hvc3RUZXh0OiBib29sZWFuO1xuICAgIGFsbG93UXVpY2tBY2NlcHQ6IGJvb2xlYW47XG59XG5cbmV4cG9ydCBjb25zdCBERUZBVUxUX1NFVFRJTkdTOiBTeW5hcHNlU2V0dGluZ3MgPSB7XG4gICAgb2xsYW1hVXJsOiAnaHR0cDovL2xvY2FsaG9zdDoxMTQzNCcsXG4gICAgb2xsYW1hTW9kZWw6ICdnZW1tYTNuOmUyYicsXG4gICAgYXV0b0xpbmtFbmFibGVkOiB0cnVlLFxuICAgIHN1bW1hcnlMb2NhdGlvbjogJ3RvcCcsXG4gICAgZmxhc2hjYXJkRm9ybWF0OiAnc2ltcGxlJyxcbiAgICBtYXhSZXNwb25zZUxlbmd0aDogMTAwMCxcbiAgICBleHBsYW5hdGlvbkZvbGRlcjogJ0V4cGxhbmF0aW9ucycsXG4gICAgZmxhc2hjYXJkRm9sZGVyOiAnRmxhc2hjYXJkcycsXG4gICAgdXNlU3VtbWFyeVlhbWw6IHRydWUsXG4gICAgY2hhdEZvbGRlcjogJ0NoYXRzJyxcbiAgICBlbmFibGVMaXZlQ2hhdDogdHJ1ZSxcbiAgICBlbmFibGVMaXZlU3VnZ2VzdGlvbnM6IGZhbHNlLFxuICAgIHN1Z2dlc3Rpb25EZWxheTogMzAwMCxcbiAgICAvLyBTaW1wbGlmaWVkIHNldHRpbmdzIHdpdGggZGVmYXVsdHNcbiAgICBzaG93R2hvc3RUZXh0OiB0cnVlLFxuICAgIGFsbG93UXVpY2tBY2NlcHQ6IHRydWVcbn07XG4iLCAiaW1wb3J0IHsgQXBwLCBQbHVnaW5TZXR0aW5nVGFiLCBTZXR0aW5nIH0gZnJvbSAnb2JzaWRpYW4nO1xuaW1wb3J0IFN5bmFwc2VQbHVnaW4gZnJvbSAnLi4vbWFpbic7XG5pbXBvcnQgeyBPbGxhbWFDbGllbnQgfSBmcm9tICcuLi9vbGxhbWEnO1xuXG5leHBvcnQgY2xhc3MgU3luYXBzZVNldHRpbmdzVGFiIGV4dGVuZHMgUGx1Z2luU2V0dGluZ1RhYiB7XG4gICAgcGx1Z2luOiBTeW5hcHNlUGx1Z2luO1xuXG4gICAgY29uc3RydWN0b3IoYXBwOiBBcHAsIHBsdWdpbjogU3luYXBzZVBsdWdpbikge1xuICAgICAgICBzdXBlcihhcHAsIHBsdWdpbik7XG4gICAgICAgIHRoaXMucGx1Z2luID0gcGx1Z2luO1xuICAgIH1cblxuICAgIGRpc3BsYXkoKTogdm9pZCB7XG4gICAgICAgIGNvbnN0IHsgY29udGFpbmVyRWwgfSA9IHRoaXM7XG4gICAgICAgIGNvbnRhaW5lckVsLmVtcHR5KCk7XG5cbiAgICAgICAgY29udGFpbmVyRWwuY3JlYXRlRWwoJ2gyJywgeyB0ZXh0OiAnU3luYXBzZSBTZXR0aW5ncycgfSk7XG5cbiAgICAgICAgLy8gT2xsYW1hIENvbmZpZ3VyYXRpb25cbiAgICAgICAgY29udGFpbmVyRWwuY3JlYXRlRWwoJ2gzJywgeyB0ZXh0OiAnT2xsYW1hIENvbmZpZ3VyYXRpb24nIH0pO1xuXG4gICAgICAgIG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxuICAgICAgICAgICAgLnNldE5hbWUoJ09sbGFtYSBVUkwnKVxuICAgICAgICAgICAgLnNldERlc2MoJ1VSTCB3aGVyZSBPbGxhbWEgaXMgcnVubmluZyAoZGVmYXVsdDogaHR0cDovL2xvY2FsaG9zdDoxMTQzNCknKVxuICAgICAgICAgICAgLmFkZFRleHQodGV4dCA9PiB0ZXh0XG4gICAgICAgICAgICAgICAgLnNldFBsYWNlaG9sZGVyKCdodHRwOi8vbG9jYWxob3N0OjExNDM0JylcbiAgICAgICAgICAgICAgICAuc2V0VmFsdWUodGhpcy5wbHVnaW4uc2V0dGluZ3Mub2xsYW1hVXJsKVxuICAgICAgICAgICAgICAgIC5vbkNoYW5nZShhc3luYyAodmFsdWUpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3Mub2xsYW1hVXJsID0gdmFsdWU7XG4gICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuICAgICAgICAgICAgICAgIH0pKTtcblxuICAgICAgICBuZXcgU2V0dGluZyhjb250YWluZXJFbClcbiAgICAgICAgICAgIC5zZXROYW1lKCdNb2RlbCcpXG4gICAgICAgICAgICAuc2V0RGVzYygnT2xsYW1hIG1vZGVsIHRvIHVzZSAoZS5nLiwgcGhpMzptaW5pLCBsbGFtYTIsIG1pc3RyYWwpJylcbiAgICAgICAgICAgIC5hZGRUZXh0KHRleHQgPT4gdGV4dFxuICAgICAgICAgICAgICAgIC5zZXRQbGFjZWhvbGRlcigncGhpMzptaW5pJylcbiAgICAgICAgICAgICAgICAuc2V0VmFsdWUodGhpcy5wbHVnaW4uc2V0dGluZ3Mub2xsYW1hTW9kZWwpXG4gICAgICAgICAgICAgICAgLm9uQ2hhbmdlKGFzeW5jICh2YWx1ZSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5vbGxhbWFNb2RlbCA9IHZhbHVlO1xuICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcbiAgICAgICAgICAgICAgICB9KSk7XG5cbiAgICAgICAgLy8gVGVzdCBjb25uZWN0aW9uIGJ1dHRvblxuICAgICAgICBuZXcgU2V0dGluZyhjb250YWluZXJFbClcbiAgICAgICAgICAgIC5zZXROYW1lKCdUZXN0IENvbm5lY3Rpb24nKVxuICAgICAgICAgICAgLnNldERlc2MoJ1Rlc3QgY29ubmVjdGlvbiB0byBPbGxhbWEnKVxuICAgICAgICAgICAgLmFkZEJ1dHRvbihidXR0b24gPT4gYnV0dG9uXG4gICAgICAgICAgICAgICAgLnNldEJ1dHRvblRleHQoJ1Rlc3QnKVxuICAgICAgICAgICAgICAgIC5zZXRDdGEoKVxuICAgICAgICAgICAgICAgIC5vbkNsaWNrKGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgY2xpZW50ID0gbmV3IE9sbGFtYUNsaWVudCh0aGlzLnBsdWdpbi5zZXR0aW5ncy5vbGxhbWFVcmwsIHRoaXMucGx1Z2luLnNldHRpbmdzLm9sbGFtYU1vZGVsKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgaXNBdmFpbGFibGUgPSBhd2FpdCBjbGllbnQuaXNBdmFpbGFibGUoKTtcbiAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgIGlmIChpc0F2YWlsYWJsZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgYnV0dG9uLnNldEJ1dHRvblRleHQoJ1x1MjcxMyBDb25uZWN0ZWQnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJ1dHRvbi5idXR0b25FbC5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSAnIzRjYWY1MCc7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBidXR0b24uc2V0QnV0dG9uVGV4dCgnVGVzdCcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJ1dHRvbi5idXR0b25FbC5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSAnJztcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sIDIwMDApO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgYnV0dG9uLnNldEJ1dHRvblRleHQoJ1x1MjcxNyBGYWlsZWQnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJ1dHRvbi5idXR0b25FbC5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSAnI2Y0NDMzNic7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBidXR0b24uc2V0QnV0dG9uVGV4dCgnVGVzdCcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJ1dHRvbi5idXR0b25FbC5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSAnJztcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sIDIwMDApO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSkpO1xuXG4gICAgICAgIC8vIEZlYXR1cmUgU2V0dGluZ3NcbiAgICAgICAgY29udGFpbmVyRWwuY3JlYXRlRWwoJ2gzJywgeyB0ZXh0OiAnRmVhdHVyZSBTZXR0aW5ncycgfSk7XG5cbiAgICAgICAgbmV3IFNldHRpbmcoY29udGFpbmVyRWwpXG4gICAgICAgICAgICAuc2V0TmFtZSgnQXV0by1saW5raW5nJylcbiAgICAgICAgICAgIC5zZXREZXNjKCdBdXRvbWF0aWNhbGx5IGNyZWF0ZSBsaW5rcyB3aGVuIHVzaW5nIFwiRXhwbGFpbiAmIExpbmtcIicpXG4gICAgICAgICAgICAuYWRkVG9nZ2xlKHRvZ2dsZSA9PiB0b2dnbGVcbiAgICAgICAgICAgICAgICAuc2V0VmFsdWUodGhpcy5wbHVnaW4uc2V0dGluZ3MuYXV0b0xpbmtFbmFibGVkKVxuICAgICAgICAgICAgICAgIC5vbkNoYW5nZShhc3luYyAodmFsdWUpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MuYXV0b0xpbmtFbmFibGVkID0gdmFsdWU7XG4gICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuICAgICAgICAgICAgICAgIH0pKTtcblxuICAgICAgICBuZXcgU2V0dGluZyhjb250YWluZXJFbClcbiAgICAgICAgICAgIC5zZXROYW1lKCdTdW1tYXJ5IExvY2F0aW9uJylcbiAgICAgICAgICAgIC5zZXREZXNjKCdXaGVyZSB0byBwbGFjZSBzdW1tYXJpZXMgaW4gbm90ZXMnKVxuICAgICAgICAgICAgLmFkZERyb3Bkb3duKGRyb3Bkb3duID0+IGRyb3Bkb3duXG4gICAgICAgICAgICAgICAgLmFkZE9wdGlvbigndG9wJywgJ1RvcCBvZiBub3RlJylcbiAgICAgICAgICAgICAgICAuYWRkT3B0aW9uKCdib3R0b20nLCAnQm90dG9tIG9mIG5vdGUnKVxuICAgICAgICAgICAgICAgIC5zZXRWYWx1ZSh0aGlzLnBsdWdpbi5zZXR0aW5ncy5zdW1tYXJ5TG9jYXRpb24pXG4gICAgICAgICAgICAgICAgLm9uQ2hhbmdlKGFzeW5jICh2YWx1ZTogJ3RvcCcgfCAnYm90dG9tJykgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5zdW1tYXJ5TG9jYXRpb24gPSB2YWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG4gICAgICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgICAgIFxuICAgICAgICBuZXcgU2V0dGluZyhjb250YWluZXJFbClcbiAgICAgICAgICAgIC5zZXROYW1lKCdVc2UgWUFNTCBmb3IgU3VtbWFyaWVzJylcbiAgICAgICAgICAgIC5zZXREZXNjKCdBZGQgc3VtbWFyaWVzIHRvIG5vdGUgZnJvbnRtYXR0ZXIgYXMgWUFNTCcpXG4gICAgICAgICAgICAuYWRkVG9nZ2xlKHRvZ2dsZSA9PiB0b2dnbGVcbiAgICAgICAgICAgICAgICAuc2V0VmFsdWUodGhpcy5wbHVnaW4uc2V0dGluZ3MudXNlU3VtbWFyeVlhbWwpXG4gICAgICAgICAgICAgICAgLm9uQ2hhbmdlKGFzeW5jICh2YWx1ZSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy51c2VTdW1tYXJ5WWFtbCA9IHZhbHVlO1xuICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcbiAgICAgICAgICAgICAgICB9KSk7XG5cbiAgICAgICAgbmV3IFNldHRpbmcoY29udGFpbmVyRWwpXG4gICAgICAgICAgICAuc2V0TmFtZSgnTWF4IFJlc3BvbnNlIExlbmd0aCcpXG4gICAgICAgICAgICAuc2V0RGVzYygnTWF4aW11bSBsZW5ndGggZm9yIEFJIHJlc3BvbnNlcyAoY2hhcmFjdGVycyknKVxuICAgICAgICAgICAgLmFkZFNsaWRlcihzbGlkZXIgPT4gc2xpZGVyXG4gICAgICAgICAgICAgICAgLnNldExpbWl0cyg1MDAsIDMwMDAsIDEwMClcbiAgICAgICAgICAgICAgICAuc2V0VmFsdWUodGhpcy5wbHVnaW4uc2V0dGluZ3MubWF4UmVzcG9uc2VMZW5ndGgpXG4gICAgICAgICAgICAgICAgLnNldER5bmFtaWNUb29sdGlwKClcbiAgICAgICAgICAgICAgICAub25DaGFuZ2UoYXN5bmMgKHZhbHVlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLm1heFJlc3BvbnNlTGVuZ3RoID0gdmFsdWU7XG4gICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuICAgICAgICAgICAgICAgIH0pKTtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgLy8gRm9sZGVyIG9yZ2FuaXphdGlvblxuICAgICAgICBjb250YWluZXJFbC5jcmVhdGVFbCgnaDMnLCB7IHRleHQ6ICdGb2xkZXIgT3JnYW5pemF0aW9uJyB9KTtcbiAgICAgICAgXG4gICAgICAgIG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxuICAgICAgICAgICAgLnNldE5hbWUoJ0V4cGxhbmF0aW9ucyBGb2xkZXInKVxuICAgICAgICAgICAgLnNldERlc2MoJ0ZvbGRlciBmb3IgZXhwbGFuYXRpb24gbm90ZXMgKGVtcHR5IGZvciB2YXVsdCByb290KScpXG4gICAgICAgICAgICAuYWRkVGV4dCh0ZXh0ID0+IHRleHRcbiAgICAgICAgICAgICAgICAuc2V0UGxhY2Vob2xkZXIoJ0V4cGxhbmF0aW9ucycpXG4gICAgICAgICAgICAgICAgLnNldFZhbHVlKHRoaXMucGx1Z2luLnNldHRpbmdzLmV4cGxhbmF0aW9uRm9sZGVyKVxuICAgICAgICAgICAgICAgIC5vbkNoYW5nZShhc3luYyAodmFsdWUpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MuZXhwbGFuYXRpb25Gb2xkZXIgPSB2YWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG4gICAgICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgICAgIFxuICAgICAgICBuZXcgU2V0dGluZyhjb250YWluZXJFbClcbiAgICAgICAgICAgIC5zZXROYW1lKCdGbGFzaGNhcmRzIEZvbGRlcicpXG4gICAgICAgICAgICAuc2V0RGVzYygnRm9sZGVyIGZvciBmbGFzaGNhcmQgbm90ZXMgKGVtcHR5IGZvciB2YXVsdCByb290KScpXG4gICAgICAgICAgICAuYWRkVGV4dCh0ZXh0ID0+IHRleHRcbiAgICAgICAgICAgICAgICAuc2V0UGxhY2Vob2xkZXIoJ0ZsYXNoY2FyZHMnKVxuICAgICAgICAgICAgICAgIC5zZXRWYWx1ZSh0aGlzLnBsdWdpbi5zZXR0aW5ncy5mbGFzaGNhcmRGb2xkZXIpXG4gICAgICAgICAgICAgICAgLm9uQ2hhbmdlKGFzeW5jICh2YWx1ZSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5mbGFzaGNhcmRGb2xkZXIgPSB2YWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG4gICAgICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgICAgIFxuICAgICAgICBuZXcgU2V0dGluZyhjb250YWluZXJFbClcbiAgICAgICAgICAgIC5zZXROYW1lKCdDaGF0IEZvbGRlcicpXG4gICAgICAgICAgICAuc2V0RGVzYygnRm9sZGVyIGZvciBjaGF0IHNlc3Npb24gbm90ZXMgKGVtcHR5IGZvciB2YXVsdCByb290KScpXG4gICAgICAgICAgICAuYWRkVGV4dCh0ZXh0ID0+IHRleHRcbiAgICAgICAgICAgICAgICAuc2V0UGxhY2Vob2xkZXIoJ0NoYXRzJylcbiAgICAgICAgICAgICAgICAuc2V0VmFsdWUodGhpcy5wbHVnaW4uc2V0dGluZ3MuY2hhdEZvbGRlcilcbiAgICAgICAgICAgICAgICAub25DaGFuZ2UoYXN5bmMgKHZhbHVlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmNoYXRGb2xkZXIgPSB2YWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG4gICAgICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAvLyBMaXZlIGZlYXR1cmVzXG4gICAgICAgIGNvbnRhaW5lckVsLmNyZWF0ZUVsKCdoMycsIHsgdGV4dDogJ0xpdmUgRmVhdHVyZXMnIH0pO1xuXG4gICAgICAgIG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxuICAgICAgICAgICAgLnNldE5hbWUoJ0VuYWJsZSBMaXZlIENoYXQnKVxuICAgICAgICAgICAgLnNldERlc2MoJ0VuYWJsZSBpbnRlcmFjdGl2ZSBjaGF0IHNlc3Npb25zIGluIG5vdGVzJylcbiAgICAgICAgICAgIC5hZGRUb2dnbGUodG9nZ2xlID0+IHRvZ2dsZVxuICAgICAgICAgICAgICAgIC5zZXRWYWx1ZSh0aGlzLnBsdWdpbi5zZXR0aW5ncy5lbmFibGVMaXZlQ2hhdClcbiAgICAgICAgICAgICAgICAub25DaGFuZ2UoYXN5bmMgKHZhbHVlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmVuYWJsZUxpdmVDaGF0ID0gdmFsdWU7XG4gICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuICAgICAgICAgICAgICAgIH0pKTtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgbmV3IFNldHRpbmcoY29udGFpbmVyRWwpXG4gICAgICAgICAgICAuc2V0TmFtZSgnRW5hYmxlIExpdmUgU3VnZ2VzdGlvbnMnKVxuICAgICAgICAgICAgLnNldERlc2MoJ1Byb3ZpZGUgc3VnZ2VzdGlvbnMgYXMgeW91IHR5cGUgKGV4cGVyaW1lbnRhbCknKVxuICAgICAgICAgICAgLmFkZFRvZ2dsZSh0b2dnbGUgPT4gdG9nZ2xlXG4gICAgICAgICAgICAgICAgLnNldFZhbHVlKHRoaXMucGx1Z2luLnNldHRpbmdzLmVuYWJsZUxpdmVTdWdnZXN0aW9ucylcbiAgICAgICAgICAgICAgICAub25DaGFuZ2UoYXN5bmMgKHZhbHVlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmVuYWJsZUxpdmVTdWdnZXN0aW9ucyA9IHZhbHVlO1xuICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcbiAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgIC8vIFVwZGF0ZSB2aXNpYmlsaXR5IG9mIHJlbGF0ZWQgc2V0dGluZ3NcbiAgICAgICAgICAgICAgICAgICAgdGhpcy51cGRhdGVMaXZlRmVhdHVyZVNldHRpbmdzVmlzaWJpbGl0eSgpO1xuICAgICAgICAgICAgICAgIH0pKTtcblxuICAgICAgICAvLyBBZGQgc2ltcGxpZmllZCBMaXZlIENvcGlsb3Qgc2V0dGluZ3NcbiAgICAgICAgY29uc3QgbGl2ZVN1Z2dlc3Rpb25zQ29udGFpbmVyID0gY29udGFpbmVyRWwuY3JlYXRlRGl2KCdzeW5hcHNlLWxpdmUtc2V0dGluZ3MnKTtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgbmV3IFNldHRpbmcobGl2ZVN1Z2dlc3Rpb25zQ29udGFpbmVyKVxuICAgICAgICAgICAgLnNldE5hbWUoJ1Nob3cgR2hvc3QgVGV4dCcpXG4gICAgICAgICAgICAuc2V0RGVzYygnU2hvdyBzdWdnZXN0ZWQgdGV4dCBjb21wbGV0aW9ucyBhcyB5b3UgdHlwZScpXG4gICAgICAgICAgICAuYWRkVG9nZ2xlKHRvZ2dsZSA9PiB0b2dnbGVcbiAgICAgICAgICAgICAgICAuc2V0VmFsdWUodGhpcy5wbHVnaW4uc2V0dGluZ3Muc2hvd0dob3N0VGV4dClcbiAgICAgICAgICAgICAgICAub25DaGFuZ2UoYXN5bmMgKHZhbHVlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLnNob3dHaG9zdFRleHQgPSB2YWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG4gICAgICAgICAgICAgICAgfSkpXG4gICAgICAgICAgICAuc2V0RGlzYWJsZWQoIXRoaXMucGx1Z2luLnNldHRpbmdzLmVuYWJsZUxpdmVTdWdnZXN0aW9ucyk7XG5cbiAgICAgICAgbmV3IFNldHRpbmcobGl2ZVN1Z2dlc3Rpb25zQ29udGFpbmVyKVxuICAgICAgICAgICAgLnNldE5hbWUoJ0FsbG93IFF1aWNrIEFjY2VwdCcpXG4gICAgICAgICAgICAuc2V0RGVzYygnU2hvdyBhY2NlcHQgYnV0dG9uIGZvciBzdWdnZXN0aW9ucycpXG4gICAgICAgICAgICAuYWRkVG9nZ2xlKHRvZ2dsZSA9PiB0b2dnbGVcbiAgICAgICAgICAgICAgICAuc2V0VmFsdWUodGhpcy5wbHVnaW4uc2V0dGluZ3MuYWxsb3dRdWlja0FjY2VwdClcbiAgICAgICAgICAgICAgICAub25DaGFuZ2UoYXN5bmMgKHZhbHVlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmFsbG93UXVpY2tBY2NlcHQgPSB2YWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG4gICAgICAgICAgICAgICAgfSkpXG4gICAgICAgICAgICAuc2V0RGlzYWJsZWQoIXRoaXMucGx1Z2luLnNldHRpbmdzLmVuYWJsZUxpdmVTdWdnZXN0aW9ucyk7XG4gICAgICAgICAgICAgICAgXG4gICAgICAgIG5ldyBTZXR0aW5nKGxpdmVTdWdnZXN0aW9uc0NvbnRhaW5lcilcbiAgICAgICAgICAgIC5zZXROYW1lKCdTdWdnZXN0aW9uIERlbGF5JylcbiAgICAgICAgICAgIC5zZXREZXNjKCdEZWxheSBiZWZvcmUgc2hvd2luZyBzdWdnZXN0aW9ucyAobWlsbGlzZWNvbmRzKScpXG4gICAgICAgICAgICAuYWRkU2xpZGVyKHNsaWRlciA9PiBzbGlkZXJcbiAgICAgICAgICAgICAgICAuc2V0TGltaXRzKDUwMCwgNTAwMCwgMTAwKVxuICAgICAgICAgICAgICAgIC5zZXRWYWx1ZSh0aGlzLnBsdWdpbi5zZXR0aW5ncy5zdWdnZXN0aW9uRGVsYXkpXG4gICAgICAgICAgICAgICAgLnNldER5bmFtaWNUb29sdGlwKClcbiAgICAgICAgICAgICAgICAub25DaGFuZ2UoYXN5bmMgKHZhbHVlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLnN1Z2dlc3Rpb25EZWxheSA9IHZhbHVlO1xuICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcbiAgICAgICAgICAgICAgICB9KSlcbiAgICAgICAgICAgIC5zZXREaXNhYmxlZCghdGhpcy5wbHVnaW4uc2V0dGluZ3MuZW5hYmxlTGl2ZVN1Z2dlc3Rpb25zKTtcblxuICAgICAgICAvLyBIZWxwZXIgbWV0aG9kIHRvIHNob3cvaGlkZSBzZXR0aW5ncyBiYXNlZCBvbiBmZWF0dXJlIGVuYWJsZW1lbnRcbiAgICAgICAgdGhpcy51cGRhdGVMaXZlRmVhdHVyZVNldHRpbmdzVmlzaWJpbGl0eSgpO1xuXG4gICAgICAgIC8vIFVzYWdlIEluc3RydWN0aW9uc1xuICAgICAgICBjb250YWluZXJFbC5jcmVhdGVFbCgnaDMnLCB7IHRleHQ6ICdVc2FnZSBJbnN0cnVjdGlvbnMnIH0pO1xuICAgICAgICBcbiAgICAgICAgY29uc3QgaW5zdHJ1Y3Rpb25zID0gY29udGFpbmVyRWwuY3JlYXRlRGl2KCk7XG4gICAgICAgIGluc3RydWN0aW9ucy5pbm5lckhUTUwgPSBgXG4gICAgICAgICAgICA8cD48c3Ryb25nPkNvbW1hbmRzIGF2YWlsYWJsZTo8L3N0cm9uZz48L3A+XG4gICAgICAgICAgICA8dWw+XG4gICAgICAgICAgICAgICAgPGxpPjxzdHJvbmc+RXhwbGFpbiAmIExpbms6PC9zdHJvbmc+IFNlbGVjdCB0ZXh0IGFuZCB1c2UgY29tbWFuZCBwYWxldHRlIG9yIHJpZ2h0LWNsaWNrIG1lbnU8L2xpPlxuICAgICAgICAgICAgICAgIDxsaT48c3Ryb25nPlN1bW1hcml6ZSBOb3RlOjwvc3Ryb25nPiBSdW4gY29tbWFuZCB0byBzdW1tYXJpemUgZW50aXJlIGN1cnJlbnQgbm90ZTwvbGk+XG4gICAgICAgICAgICAgICAgPGxpPjxzdHJvbmc+Q3JlYXRlIEZsYXNoY2FyZHM6PC9zdHJvbmc+IFNlbGVjdCB0ZXh0IHRvIGdlbmVyYXRlIHN0dWR5IGZsYXNoY2FyZHM8L2xpPlxuICAgICAgICAgICAgICAgIDxsaT48c3Ryb25nPlN0YXJ0IENoYXQgU2Vzc2lvbjo8L3N0cm9uZz4gQmVnaW4gYW4gaW50ZXJhY3RpdmUgY2hhdCB3aXRoIHRoZSBBSTwvbGk+XG4gICAgICAgICAgICAgICAgPGxpPjxzdHJvbmc+U2VuZCBDaGF0IE1lc3NhZ2U6PC9zdHJvbmc+IEluIGEgY2hhdCBub3RlLCBzZW5kIHRoZSBjdXJyZW50IGxpbmUgdG8gdGhlIEFJPC9saT5cbiAgICAgICAgICAgIDwvdWw+XG4gICAgICAgICAgICA8cD48c3Ryb25nPlJlcXVpcmVtZW50czo8L3N0cm9uZz4gTWFrZSBzdXJlIE9sbGFtYSBpcyBpbnN0YWxsZWQgYW5kIHJ1bm5pbmcgd2l0aCB5b3VyIHNlbGVjdGVkIG1vZGVsLjwvcD5cbiAgICAgICAgYDtcbiAgICB9XG5cbiAgICBwcml2YXRlIHVwZGF0ZUxpdmVGZWF0dXJlU2V0dGluZ3NWaXNpYmlsaXR5KCkge1xuICAgICAgICBjb25zdCBsaXZlU2V0dGluZ3NEaXYgPSB0aGlzLmNvbnRhaW5lckVsLnF1ZXJ5U2VsZWN0b3IoJy5zeW5hcHNlLWxpdmUtc2V0dGluZ3MnKTtcbiAgICAgICAgaWYgKGxpdmVTZXR0aW5nc0Rpdikge1xuICAgICAgICAgICAgbGl2ZVNldHRpbmdzRGl2LnN0eWxlLmRpc3BsYXkgPSB0aGlzLnBsdWdpbi5zZXR0aW5ncy5lbmFibGVMaXZlU3VnZ2VzdGlvbnMgPyAnYmxvY2snIDogJ25vbmUnO1xuICAgICAgICB9XG4gICAgfVxufSIsICJleHBvcnQgaW50ZXJmYWNlIE9sbGFtYVJlc3BvbnNlIHtcbiAgICByZXNwb25zZTogc3RyaW5nO1xuICAgIGRvbmU6IGJvb2xlYW47XG4gICAgY29udGV4dD86IG51bWJlcltdO1xufVxuXG5leHBvcnQgY2xhc3MgT2xsYW1hQ2xpZW50IHtcbiAgICBwcml2YXRlIGJhc2VVcmw6IHN0cmluZztcbiAgICBwcml2YXRlIG1vZGVsOiBzdHJpbmc7XG5cbiAgICBjb25zdHJ1Y3RvcihiYXNlVXJsOiBzdHJpbmcsIG1vZGVsOiBzdHJpbmcpIHtcbiAgICAgICAgdGhpcy5iYXNlVXJsID0gYmFzZVVybC5yZXBsYWNlKC9cXC8kLywgJycpOyAvLyBSZW1vdmUgdHJhaWxpbmcgc2xhc2hcbiAgICAgICAgdGhpcy5tb2RlbCA9IG1vZGVsO1xuICAgIH1cblxuICAgIGFzeW5jIGlzQXZhaWxhYmxlKCk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChgJHt0aGlzLmJhc2VVcmx9L2FwaS90YWdzYCk7XG4gICAgICAgICAgICByZXR1cm4gcmVzcG9uc2Uub2s7XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBhc3luYyBnZW5lcmF0ZShwcm9tcHQ6IHN0cmluZywgc3lzdGVtUHJvbXB0Pzogc3RyaW5nLCBjaGF0SGlzdG9yeT86IHN0cmluZyk6IFByb21pc2U8c3RyaW5nPiB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICAvLyBJZiBjaGF0IGhpc3RvcnkgaXMgcHJvdmlkZWQsIGZvcm1hdCBpdCBuaWNlbHlcbiAgICAgICAgICAgIGxldCBmdWxsUHJvbXB0ID0gcHJvbXB0O1xuICAgICAgICAgICAgaWYgKGNoYXRIaXN0b3J5ICYmIGNoYXRIaXN0b3J5LnRyaW0oKSkge1xuICAgICAgICAgICAgICAgIGZ1bGxQcm9tcHQgPSBgQ2hhdCBoaXN0b3J5OlxcbiR7Y2hhdEhpc3Rvcnl9XFxuXFxuQ3VycmVudCBtZXNzYWdlOiAke3Byb21wdH1gO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgXG4gICAgICAgICAgICBjb25zdCByZXF1ZXN0Qm9keSA9IHtcbiAgICAgICAgICAgICAgICBtb2RlbDogdGhpcy5tb2RlbCxcbiAgICAgICAgICAgICAgICBwcm9tcHQ6IGZ1bGxQcm9tcHQsXG4gICAgICAgICAgICAgICAgc3lzdGVtOiBzeXN0ZW1Qcm9tcHQgfHwgJycsXG4gICAgICAgICAgICAgICAgc3RyZWFtOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBvcHRpb25zOiB7XG4gICAgICAgICAgICAgICAgICAgIHRlbXBlcmF0dXJlOiAwLjcsXG4gICAgICAgICAgICAgICAgICAgIHRvcF9wOiAwLjksXG4gICAgICAgICAgICAgICAgICAgIHRvcF9rOiA0MCxcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKGAke3RoaXMuYmFzZVVybH0vYXBpL2dlbmVyYXRlYCwge1xuICAgICAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgICAgICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAgICAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHJlcXVlc3RCb2R5KSxcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBpZiAoIXJlc3BvbnNlLm9rKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBPbGxhbWEgQVBJIGVycm9yOiAke3Jlc3BvbnNlLnN0YXR1c31gKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgY29uc3QgZGF0YTogT2xsYW1hUmVzcG9uc2UgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7XG4gICAgICAgICAgICByZXR1cm4gZGF0YS5yZXNwb25zZS50cmltKCk7XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEZhaWxlZCB0byBnZW5lcmF0ZSByZXNwb25zZTogJHtlcnJvci5tZXNzYWdlfWApO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgYXN5bmMgZ2V0QXZhaWxhYmxlTW9kZWxzKCk6IFByb21pc2U8c3RyaW5nW10+IHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goYCR7dGhpcy5iYXNlVXJsfS9hcGkvdGFnc2ApO1xuICAgICAgICAgICAgaWYgKCFyZXNwb25zZS5vaykge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgRmFpbGVkIHRvIGZldGNoIG1vZGVsczogJHtyZXNwb25zZS5zdGF0dXN9YCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGNvbnN0IGRhdGEgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7XG4gICAgICAgICAgICByZXR1cm4gZGF0YS5tb2RlbHM/Lm1hcCgobW9kZWw6IGFueSkgPT4gbW9kZWwubmFtZSkgfHwgW107XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBmZXRjaGluZyBtb2RlbHM6JywgZXJyb3IpO1xuICAgICAgICAgICAgcmV0dXJuIFtdO1xuICAgICAgICB9XG4gICAgfVxufVxuIiwgImltcG9ydCB7IEVkaXRvciwgVEZpbGUsIE5vdGljZSwgQXBwLCBNYXJrZG93blZpZXcgfSBmcm9tICdvYnNpZGlhbic7XG5pbXBvcnQgeyBPbGxhbWFDbGllbnQgfSBmcm9tICcuL29sbGFtYSc7XG5pbXBvcnQgeyBTeW5hcHNlU2V0dGluZ3MgfSBmcm9tICcuL3NldHRpbmdzJztcblxuZXhwb3J0IGNsYXNzIFN5bmFwc2VDb21tYW5kcyB7XG4gICAgcHJpdmF0ZSBhcHA6IEFwcDtcbiAgICBwcml2YXRlIG9sbGFtYTogT2xsYW1hQ2xpZW50O1xuICAgIHByaXZhdGUgc2V0dGluZ3M6IFN5bmFwc2VTZXR0aW5ncztcblxuICAgIGNvbnN0cnVjdG9yKGFwcDogQXBwLCBvbGxhbWE6IE9sbGFtYUNsaWVudCwgc2V0dGluZ3M6IFN5bmFwc2VTZXR0aW5ncykge1xuICAgICAgICB0aGlzLmFwcCA9IGFwcDtcbiAgICAgICAgdGhpcy5vbGxhbWEgPSBvbGxhbWE7XG4gICAgICAgIHRoaXMuc2V0dGluZ3MgPSBzZXR0aW5ncztcbiAgICB9XG5cbiAgICB1cGRhdGVTZXR0aW5ncyhzZXR0aW5nczogU3luYXBzZVNldHRpbmdzKSB7XG4gICAgICAgIHRoaXMuc2V0dGluZ3MgPSBzZXR0aW5ncztcbiAgICAgICAgdGhpcy5vbGxhbWEgPSBuZXcgT2xsYW1hQ2xpZW50KHNldHRpbmdzLm9sbGFtYVVybCwgc2V0dGluZ3Mub2xsYW1hTW9kZWwpO1xuICAgIH1cblxuICAgIGFzeW5jIGV4cGxhaW5BbmRMaW5rKGVkaXRvcjogRWRpdG9yLCBzZWxlY3RlZFRleHQ6IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xuICAgICAgICBpZiAoIXNlbGVjdGVkVGV4dC50cmltKCkpIHtcbiAgICAgICAgICAgIG5ldyBOb3RpY2UoJ1BsZWFzZSBzZWxlY3QgdGV4dCB0byBleHBsYWluJyk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBub3RpY2VMb2FkaW5nID0gbmV3IE5vdGljZSgnR2VuZXJhdGluZyBleHBsYW5hdGlvbi4uLicsIDApO1xuICAgICAgICBcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIC8vIEdlbmVyYXRlIGV4cGxhbmF0aW9uXG4gICAgICAgICAgICBjb25zdCBzeXN0ZW1Qcm9tcHQgPSBgWW91IGFyZSBhIGhlbHBmdWwgZWR1Y2F0aW9uYWwgYXNzaXN0YW50LiBDcmVhdGUgYSBjbGVhciwgY29uY2lzZSBleHBsYW5hdGlvbiBvZiB0aGUgZ2l2ZW4gY29uY2VwdC4gXG4gICAgICAgICAgICBGb3JtYXQgeW91ciByZXNwb25zZSBhcyBhIHdlbGwtc3RydWN0dXJlZCBub3RlIHdpdGg6XG4gICAgICAgICAgICAxLiBBIGJyaWVmIGRlZmluaXRpb25cbiAgICAgICAgICAgIDIuIEtleSBjaGFyYWN0ZXJpc3RpY3Mgb3IgcHJvcGVydGllc1xuICAgICAgICAgICAgMy4gQSBzaW1wbGUgYW5hbG9neSBvciBleGFtcGxlIGlmIGhlbHBmdWxcbiAgICAgICAgICAgIDQuIFdoeSB0aGlzIGNvbmNlcHQgaXMgaW1wb3J0YW50XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIEtlZXAgdGhlIGV4cGxhbmF0aW9uIHVuZGVyICR7dGhpcy5zZXR0aW5ncy5tYXhSZXNwb25zZUxlbmd0aH0gY2hhcmFjdGVycyBhbmQgdXNlIGNsZWFyLCBlZHVjYXRpb25hbCBsYW5ndWFnZS5gO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBjb25zdCBwcm9tcHQgPSBgRXhwbGFpbiB0aGlzIGNvbmNlcHQ6IFwiJHtzZWxlY3RlZFRleHR9XCJgO1xuICAgICAgICAgICAgY29uc3QgZXhwbGFuYXRpb24gPSBhd2FpdCB0aGlzLm9sbGFtYS5nZW5lcmF0ZShwcm9tcHQsIHN5c3RlbVByb21wdCk7XG5cbiAgICAgICAgICAgIC8vIENyZWF0ZSBub3RlIGZpbGVuYW1lIChzYW5pdGl6ZSlcbiAgICAgICAgICAgIGNvbnN0IG5vdGVUaXRsZSA9IHRoaXMuc2FuaXRpemVGaWxlTmFtZShzZWxlY3RlZFRleHQpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICAvLyBDcmVhdGUgZm9sZGVyIGlmIGl0IGRvZXNuJ3QgZXhpc3RcbiAgICAgICAgICAgIGF3YWl0IHRoaXMuZW5zdXJlRm9sZGVyRXhpc3RzKHRoaXMuc2V0dGluZ3MuZXhwbGFuYXRpb25Gb2xkZXIpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICAvLyBDcmVhdGUgcGF0aCB3aXRoIGZvbGRlclxuICAgICAgICAgICAgY29uc3QgZmlsZVBhdGggPSBgJHt0aGlzLnNldHRpbmdzLmV4cGxhbmF0aW9uRm9sZGVyfS8ke25vdGVUaXRsZX0ubWRgO1xuXG4gICAgICAgICAgICAvLyBDaGVjayBpZiBub3RlIGFscmVhZHkgZXhpc3RzXG4gICAgICAgICAgICBjb25zdCBleGlzdGluZ0ZpbGUgPSB0aGlzLmFwcC52YXVsdC5nZXRBYnN0cmFjdEZpbGVCeVBhdGgoZmlsZVBhdGgpO1xuICAgICAgICAgICAgaWYgKGV4aXN0aW5nRmlsZSBpbnN0YW5jZW9mIFRGaWxlKSB7XG4gICAgICAgICAgICAgICAgbmV3IE5vdGljZShgTm90ZSBcIiR7bm90ZVRpdGxlfVwiIGFscmVhZHkgZXhpc3RzYCk7XG4gICAgICAgICAgICAgICAgbm90aWNlTG9hZGluZy5oaWRlKCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBDcmVhdGUgbmV3IG5vdGUgY29udGVudFxuICAgICAgICAgICAgY29uc3Qgbm90ZUNvbnRlbnQgPSBgIyAke25vdGVUaXRsZX1cblxuJHtleHBsYW5hdGlvbn1cblxuLS0tXG4qR2VuZXJhdGVkIGJ5IFN5bmFwc2UgQUkqXG4qQ3JlYXRlZDogJHtuZXcgRGF0ZSgpLnRvTG9jYWxlRGF0ZVN0cmluZygpfSpgO1xuXG4gICAgICAgICAgICAvLyBDcmVhdGUgdGhlIG5ldyBub3RlXG4gICAgICAgICAgICBjb25zdCBuZXdGaWxlID0gYXdhaXQgdGhpcy5hcHAudmF1bHQuY3JlYXRlKGZpbGVQYXRoLCBub3RlQ29udGVudCk7XG5cbiAgICAgICAgICAgIC8vIEluc2VydCBsaW5rIGluIGN1cnJlbnQgZWRpdG9yXG4gICAgICAgICAgICBjb25zdCBsaW5rID0gYFtbJHtmaWxlUGF0aC5yZXBsYWNlKCcubWQnLCAnJyl9fCR7bm90ZVRpdGxlfV1dYDtcbiAgICAgICAgICAgIGVkaXRvci5yZXBsYWNlU2VsZWN0aW9uKGxpbmspO1xuXG4gICAgICAgICAgICAvLyBPcGVuIHRoZSBuZXcgbm90ZVxuICAgICAgICAgICAgYXdhaXQgdGhpcy5hcHAud29ya3NwYWNlLmdldExlYWYoKS5vcGVuRmlsZShuZXdGaWxlKTtcblxuICAgICAgICAgICAgbm90aWNlTG9hZGluZy5oaWRlKCk7XG4gICAgICAgICAgICBuZXcgTm90aWNlKGBDcmVhdGVkIGFuZCBsaW5rZWQgbm90ZTogJHtub3RlVGl0bGV9YCk7XG5cbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIG5vdGljZUxvYWRpbmcuaGlkZSgpO1xuICAgICAgICAgICAgbmV3IE5vdGljZShgRXJyb3I6ICR7ZXJyb3IubWVzc2FnZX1gKTtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0V4cGxhaW4gYW5kIExpbmsgZXJyb3I6JywgZXJyb3IpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgYXN5bmMgc3VtbWFyaXplTm90ZShlZGl0b3I6IEVkaXRvciwgY29udGVudDogc3RyaW5nKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgICAgIGlmICghY29udGVudC50cmltKCkpIHtcbiAgICAgICAgICAgIG5ldyBOb3RpY2UoJ05vIGNvbnRlbnQgdG8gc3VtbWFyaXplJyk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBub3RpY2VMb2FkaW5nID0gbmV3IE5vdGljZSgnR2VuZXJhdGluZyBzdW1tYXJ5Li4uJywgMCk7XG5cbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IHN5c3RlbVByb21wdCA9IGBZb3UgYXJlIGEgaGVscGZ1bCBhc3Npc3RhbnQgdGhhdCBjcmVhdGVzIGNvbmNpc2Ugc3VtbWFyaWVzLiBcbiAgICAgICAgICAgIENyZWF0ZSBhIGJ1bGxldC1wb2ludCBzdW1tYXJ5ICgzLTUgcG9pbnRzKSBvZiB0aGUgbWFpbiBpZGVhcyBpbiB0aGUgZ2l2ZW4gdGV4dC4gXG4gICAgICAgICAgICBFYWNoIGJ1bGxldCBwb2ludCBzaG91bGQgYmUgY2xlYXIgYW5kIGNhcHR1cmUgYSBrZXkgY29uY2VwdC5cbiAgICAgICAgICAgIEZvcm1hdCBhcyBtYXJrZG93biBidWxsZXRzIHN0YXJ0aW5nIHdpdGggXCItIFwiLmA7XG5cbiAgICAgICAgICAgIGNvbnN0IHByb21wdCA9IGBTdW1tYXJpemUgdGhpcyBjb250ZW50OlxcblxcbiR7Y29udGVudH1gO1xuICAgICAgICAgICAgY29uc3Qgc3VtbWFyeSA9IGF3YWl0IHRoaXMub2xsYW1hLmdlbmVyYXRlKHByb21wdCwgc3lzdGVtUHJvbXB0KTtcblxuICAgICAgICAgICAgLy8gRm9ybWF0IHN1bW1hcnkgYmFzZWQgb24gc2V0dGluZ3NcbiAgICAgICAgICAgIGxldCBzdW1tYXJ5U2VjdGlvbjtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgaWYgKHRoaXMuc2V0dGluZ3MudXNlU3VtbWFyeVlhbWwpIHtcbiAgICAgICAgICAgICAgICAvLyBGb3JtYXQgYXMgWUFNTFxuICAgICAgICAgICAgICAgIHN1bW1hcnlTZWN0aW9uID0gYC0tLVxuc3VtbWFyeTpcbiR7c3VtbWFyeS5zcGxpdCgnXFxuJykubWFwKGxpbmUgPT4gYCAgJHtsaW5lfWApLmpvaW4oJ1xcbicpfVxuLS0tXG5cbmA7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIC8vIEZvcm1hdCBhcyByZWd1bGFyIG1hcmtkb3duXG4gICAgICAgICAgICAgICAgc3VtbWFyeVNlY3Rpb24gPSBgIyMgU3VtbWFyeVxuXG4ke3N1bW1hcnl9XG5cbi0tLVxuXG5gO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBJbnNlcnQgc3VtbWFyeSBhdCBzcGVjaWZpZWQgbG9jYXRpb25cbiAgICAgICAgICAgIGlmICh0aGlzLnNldHRpbmdzLnN1bW1hcnlMb2NhdGlvbiA9PT0gJ3RvcCcpIHtcbiAgICAgICAgICAgICAgICAvLyBGaW5kIGZpcnN0IGhlYWRpbmcgb3IgaW5zZXJ0IGF0IGJlZ2lubmluZ1xuICAgICAgICAgICAgICAgIGNvbnN0IGxpbmVzID0gY29udGVudC5zcGxpdCgnXFxuJyk7XG4gICAgICAgICAgICAgICAgbGV0IGluc2VydEluZGV4ID0gMDtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAvLyBTa2lwIGZyb250IG1hdHRlciBpZiBleGlzdHNcbiAgICAgICAgICAgICAgICBpZiAobGluZXNbMF0/LnN0YXJ0c1dpdGgoJy0tLScpKSB7XG4gICAgICAgICAgICAgICAgICAgIGxldCBlbmRGcm9udE1hdHRlciA9IGxpbmVzLmZpbmRJbmRleCgobGluZSwgaSkgPT4gaSA+IDAgJiYgbGluZS5zdGFydHNXaXRoKCctLS0nKSk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChlbmRGcm9udE1hdHRlciAhPT0gLTEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGluc2VydEluZGV4ID0gZW5kRnJvbnRNYXR0ZXIgKyAxO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy8gSWYgd2UncmUgdXNpbmcgWUFNTCBhbmQgdGhlcmUncyBhbHJlYWR5IGZyb250bWF0dGVyLCB3ZSBuZWVkIHRvIG1lcmdlIHRoZW1cbiAgICAgICAgICAgICAgICBpZiAodGhpcy5zZXR0aW5ncy51c2VTdW1tYXJ5WWFtbCAmJiBsaW5lc1swXT8uc3RhcnRzV2l0aCgnLS0tJykpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZW5kRnJvbnRNYXR0ZXIgPSBsaW5lcy5maW5kSW5kZXgoKGxpbmUsIGkpID0+IGkgPiAwICYmIGxpbmUuc3RhcnRzV2l0aCgnLS0tJykpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoZW5kRnJvbnRNYXR0ZXIgIT09IC0xKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBFeHRyYWN0IGV4aXN0aW5nIGZyb250bWF0dGVyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBleGlzdGluZ0Zyb250bWF0dGVyID0gbGluZXMuc2xpY2UoMCwgZW5kRnJvbnRNYXR0ZXIgKyAxKS5qb2luKCdcXG4nKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFJlbW92ZSBjbG9zaW5nIGRlbGltaXRlclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgb3BlbkZyb250bWF0dGVyID0gZXhpc3RpbmdGcm9udG1hdHRlci5yZXBsYWNlKC8tLS1cXHMqJC8sICcnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEFkZCBzdW1tYXJ5IHRvIGZyb250bWF0dGVyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzdW1tYXJ5WWFtbCA9IGBzdW1tYXJ5OlxuJHtzdW1tYXJ5LnNwbGl0KCdcXG4nKS5tYXAobGluZSA9PiBgICAke2xpbmV9YCkuam9pbignXFxuJyl9XG4tLS1gO1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gQ29tYmluZVxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbmV3Q29udGVudCA9IG9wZW5Gcm9udG1hdHRlciArIHN1bW1hcnlZYW1sICsgJ1xcblxcbicgKyBsaW5lcy5zbGljZShlbmRGcm9udE1hdHRlciArIDEpLmpvaW4oJ1xcbicpO1xuICAgICAgICAgICAgICAgICAgICAgICAgZWRpdG9yLnNldFZhbHVlKG5ld0NvbnRlbnQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgbm90aWNlTG9hZGluZy5oaWRlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBuZXcgTm90aWNlKCdTdW1tYXJ5IGFkZGVkIHRvIGZyb250bWF0dGVyJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBjb25zdCBuZXdDb250ZW50ID0gW1xuICAgICAgICAgICAgICAgICAgICAuLi5saW5lcy5zbGljZSgwLCBpbnNlcnRJbmRleCksXG4gICAgICAgICAgICAgICAgICAgICcnLFxuICAgICAgICAgICAgICAgICAgICBzdW1tYXJ5U2VjdGlvbixcbiAgICAgICAgICAgICAgICAgICAgLi4ubGluZXMuc2xpY2UoaW5zZXJ0SW5kZXgpXG4gICAgICAgICAgICAgICAgXS5qb2luKCdcXG4nKTtcblxuICAgICAgICAgICAgICAgIGVkaXRvci5zZXRWYWx1ZShuZXdDb250ZW50KTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgLy8gSW5zZXJ0IGF0IGJvdHRvbVxuICAgICAgICAgICAgICAgIGVkaXRvci5zZXRWYWx1ZShjb250ZW50ICsgJ1xcblxcbicgKyBzdW1tYXJ5U2VjdGlvbik7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIG5vdGljZUxvYWRpbmcuaGlkZSgpO1xuICAgICAgICAgICAgbmV3IE5vdGljZSgnU3VtbWFyeSBhZGRlZCB0byBub3RlJyk7XG5cbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIG5vdGljZUxvYWRpbmcuaGlkZSgpO1xuICAgICAgICAgICAgbmV3IE5vdGljZShgRXJyb3I6ICR7ZXJyb3IubWVzc2FnZX1gKTtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ1N1bW1hcml6ZSBlcnJvcjonLCBlcnJvcik7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBhc3luYyBjcmVhdGVGbGFzaGNhcmRzKGVkaXRvcjogRWRpdG9yLCBzZWxlY3RlZFRleHQ6IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xuICAgICAgICBpZiAoIXNlbGVjdGVkVGV4dC50cmltKCkpIHtcbiAgICAgICAgICAgIG5ldyBOb3RpY2UoJ1BsZWFzZSBzZWxlY3QgdGV4dCB0byBjcmVhdGUgZmxhc2hjYXJkcyBmcm9tJyk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBub3RpY2VMb2FkaW5nID0gbmV3IE5vdGljZSgnQ3JlYXRpbmcgZmxhc2hjYXJkcy4uLicsIDApO1xuXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCBzeXN0ZW1Qcm9tcHQgPSBgWW91IGFyZSBhIGhlbHBmdWwgYXNzaXN0YW50IHRoYXQgY3JlYXRlcyBzdHVkeSBmbGFzaGNhcmRzLiBcbiAgICAgICAgICAgIEZyb20gdGhlIGdpdmVuIHRleHQsIGlkZW50aWZ5IDMtNyBrZXkgY29uY2VwdHMgYW5kIGNyZWF0ZSBmbGFzaGNhcmRzIGluIHRoaXMgZXhhY3QgZm9ybWF0OlxuXG4gICAgICAgICAgICAqKlE6KiogUXVlc3Rpb24gaGVyZT9cbiAgICAgICAgICAgICoqQToqKiBBbnN3ZXIgaGVyZVxuXG4gICAgICAgICAgICBNYWtlIHF1ZXN0aW9ucyBjbGVhciBhbmQgc3BlY2lmaWMuIEFuc3dlcnMgc2hvdWxkIGJlIGNvbmNpc2UgYnV0IGNvbXBsZXRlLlxuICAgICAgICAgICAgRm9jdXMgb24gdGhlIG1vc3QgaW1wb3J0YW50IGNvbmNlcHRzIGZvciBsZWFybmluZyBhbmQgcmV0ZW50aW9uLmA7XG5cbiAgICAgICAgICAgIGNvbnN0IHByb21wdCA9IGBDcmVhdGUgZmxhc2hjYXJkcyBmcm9tIHRoaXMgY29udGVudDpcXG5cXG4ke3NlbGVjdGVkVGV4dH1gO1xuICAgICAgICAgICAgY29uc3QgZmxhc2hjYXJkcyA9IGF3YWl0IHRoaXMub2xsYW1hLmdlbmVyYXRlKHByb21wdCwgc3lzdGVtUHJvbXB0KTtcblxuICAgICAgICAgICAgLy8gRGVjaWRlIGlmIHdlIHNob3VsZCBjcmVhdGUgYSBuZXcgZmxhc2hjYXJkIG5vdGUgb3IgaW5zZXJ0IGludG8gY3VycmVudCBub3RlXG4gICAgICAgICAgICBjb25zdCBhY3RpdmVGaWxlID0gdGhpcy5hcHAud29ya3NwYWNlLmdldEFjdGl2ZUZpbGUoKTtcbiAgICAgICAgICAgIGNvbnN0IG5vdGVUaXRsZSA9IGFjdGl2ZUZpbGUgPyBhY3RpdmVGaWxlLmJhc2VuYW1lIDogXCJVbnRpdGxlZFwiO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICAvLyBDcmVhdGUgZmxhc2hjYXJkcyBub3RlIGluIGRlZGljYXRlZCBmb2xkZXJcbiAgICAgICAgICAgIGF3YWl0IHRoaXMuZW5zdXJlRm9sZGVyRXhpc3RzKHRoaXMuc2V0dGluZ3MuZmxhc2hjYXJkRm9sZGVyKTtcbiAgICAgICAgICAgIGNvbnN0IGZsYXNoY2FyZEZpbGVOYW1lID0gYCR7dGhpcy5zZXR0aW5ncy5mbGFzaGNhcmRGb2xkZXJ9LyR7bm90ZVRpdGxlfSAtIEZsYXNoY2FyZHMubWRgO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBjb25zdCBmbGFzaGNhcmRDb250ZW50ID0gYCMgRmxhc2hjYXJkcyBmb3IgJHtub3RlVGl0bGV9XG5cbiR7Zmxhc2hjYXJkc31cblxuLS0tXG4qR2VuZXJhdGVkIGZyb206IFtbJHthY3RpdmVGaWxlID8gYWN0aXZlRmlsZS5wYXRoLnJlcGxhY2UoJy5tZCcsICcnKSA6ICdVbmtub3duIHNvdXJjZSd9XV0qXG4qQ3JlYXRlZDogJHtuZXcgRGF0ZSgpLnRvTG9jYWxlRGF0ZVN0cmluZygpfSpcbmA7XG5cbiAgICAgICAgICAgIC8vIENoZWNrIGlmIGZsYXNoY2FyZCBmaWxlIGV4aXN0cyBhbmQgYXBwZW5kIG9yIGNyZWF0ZVxuICAgICAgICAgICAgY29uc3QgZXhpc3RpbmdGaWxlID0gdGhpcy5hcHAudmF1bHQuZ2V0QWJzdHJhY3RGaWxlQnlQYXRoKGZsYXNoY2FyZEZpbGVOYW1lKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgaWYgKGV4aXN0aW5nRmlsZSBpbnN0YW5jZW9mIFRGaWxlKSB7XG4gICAgICAgICAgICAgICAgLy8gQXBwZW5kIHRvIGV4aXN0aW5nIGZpbGVcbiAgICAgICAgICAgICAgICBjb25zdCBleGlzdGluZ0NvbnRlbnQgPSBhd2FpdCB0aGlzLmFwcC52YXVsdC5yZWFkKGV4aXN0aW5nRmlsZSk7XG4gICAgICAgICAgICAgICAgY29uc3QgbmV3Q29udGVudCA9IGV4aXN0aW5nQ29udGVudCArIFwiXFxuXFxuIyMgTmV3IEZsYXNoY2FyZHNcXG5cXG5cIiArIGZsYXNoY2FyZHM7XG4gICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5hcHAudmF1bHQubW9kaWZ5KGV4aXN0aW5nRmlsZSwgbmV3Q29udGVudCk7XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgLy8gT3BlbiB0aGUgZmlsZVxuICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMuYXBwLndvcmtzcGFjZS5nZXRMZWFmKCkub3BlbkZpbGUoZXhpc3RpbmdGaWxlKTtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICBub3RpY2VMb2FkaW5nLmhpZGUoKTtcbiAgICAgICAgICAgICAgICBuZXcgTm90aWNlKCdBZGRlZCBmbGFzaGNhcmRzIHRvIGV4aXN0aW5nIG5vdGUnKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgLy8gQ3JlYXRlIG5ldyBmaWxlXG4gICAgICAgICAgICAgICAgY29uc3QgbmV3RmlsZSA9IGF3YWl0IHRoaXMuYXBwLnZhdWx0LmNyZWF0ZShmbGFzaGNhcmRGaWxlTmFtZSwgZmxhc2hjYXJkQ29udGVudCk7XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgLy8gT3BlbiB0aGUgZmlsZVxuICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMuYXBwLndvcmtzcGFjZS5nZXRMZWFmKCkub3BlbkZpbGUobmV3RmlsZSk7XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgbm90aWNlTG9hZGluZy5oaWRlKCk7XG4gICAgICAgICAgICAgICAgbmV3IE5vdGljZSgnQ3JlYXRlZCBuZXcgZmxhc2hjYXJkcyBub3RlJyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIEFsc28gYWRkIGxpbmsgdG8gY3VycmVudCBub3RlXG4gICAgICAgICAgICBjb25zdCBsaW5rID0gYFxcblxcbltbJHtmbGFzaGNhcmRGaWxlTmFtZS5yZXBsYWNlKCcubWQnLCAnJyl9fEZsYXNoY2FyZHMgZm9yIHRoaXMgbm90ZV1dXFxuYDtcbiAgICAgICAgICAgIGNvbnN0IGN1cnNvciA9IGVkaXRvci5nZXRDdXJzb3IoKTtcbiAgICAgICAgICAgIGVkaXRvci5zZXRMaW5lKGN1cnNvci5saW5lLCBlZGl0b3IuZ2V0TGluZShjdXJzb3IubGluZSkgKyBsaW5rKTtcblxuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgbm90aWNlTG9hZGluZy5oaWRlKCk7XG4gICAgICAgICAgICBuZXcgTm90aWNlKGBFcnJvcjogJHtlcnJvci5tZXNzYWdlfWApO1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcignQ3JlYXRlIEZsYXNoY2FyZHMgZXJyb3I6JywgZXJyb3IpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgYXN5bmMgc3RhcnRDaGF0U2Vzc2lvbihlZGl0b3I6IEVkaXRvcik6IFByb21pc2U8dm9pZD4ge1xuICAgICAgICAvLyBDcmVhdGUgYSBuZXcgY2hhdCBub3RlIGluIHRoZSBjaGF0IGZvbGRlclxuICAgICAgICBhd2FpdCB0aGlzLmVuc3VyZUZvbGRlckV4aXN0cyh0aGlzLnNldHRpbmdzLmNoYXRGb2xkZXIpO1xuICAgICAgICBcbiAgICAgICAgY29uc3QgdGltZXN0YW1wID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpLnJlcGxhY2UoL1s6Ll0vZywgJy0nKTtcbiAgICAgICAgY29uc3QgY2hhdEZpbGVOYW1lID0gYCR7dGhpcy5zZXR0aW5ncy5jaGF0Rm9sZGVyfS9DaGF0LSR7dGltZXN0YW1wfS5tZGA7XG4gICAgICAgIFxuICAgICAgICBjb25zdCBjaGF0VGVtcGxhdGUgPSBgIyBDaGF0IFNlc3Npb24gJHtuZXcgRGF0ZSgpLnRvTG9jYWxlU3RyaW5nKCl9XG5cbiMjIENvbnRleHRcbipUaGlzIGlzIGEgY2hhdCBzZXNzaW9uIHdpdGggU3luYXBzZSBBSS4gVHlwZSB5b3VyIG1lc3NhZ2VzIGFmdGVyIHRoZSA+IHByb21wdC4qXG5cbiMjIENoYXRcblxuPiBcblxuYDtcbiAgICAgICAgXG4gICAgICAgIGNvbnN0IG5ld0ZpbGUgPSBhd2FpdCB0aGlzLmFwcC52YXVsdC5jcmVhdGUoY2hhdEZpbGVOYW1lLCBjaGF0VGVtcGxhdGUpO1xuICAgICAgICBcbiAgICAgICAgLy8gT3BlbiB0aGUgZmlsZVxuICAgICAgICBjb25zdCBsZWFmID0gdGhpcy5hcHAud29ya3NwYWNlLmdldExlYWYoKTtcbiAgICAgICAgYXdhaXQgbGVhZi5vcGVuRmlsZShuZXdGaWxlKTtcbiAgICAgICAgXG4gICAgICAgIC8vIFBvc2l0aW9uIGN1cnNvciBhdCB0aGUgcHJvbXB0XG4gICAgICAgIGNvbnN0IG5ld0VkaXRvciA9IHRoaXMuZ2V0QWN0aXZlRWRpdG9yKCk7XG4gICAgICAgIGlmIChuZXdFZGl0b3IpIHtcbiAgICAgICAgICAgIGNvbnN0IGxpbmVzID0gY2hhdFRlbXBsYXRlLnNwbGl0KCdcXG4nKTtcbiAgICAgICAgICAgIGNvbnN0IHByb21wdExpbmUgPSBsaW5lcy5maW5kSW5kZXgobGluZSA9PiBsaW5lID09PSAnPiAnKTtcbiAgICAgICAgICAgIGlmIChwcm9tcHRMaW5lICE9PSAtMSkge1xuICAgICAgICAgICAgICAgIG5ld0VkaXRvci5zZXRDdXJzb3IoeyBsaW5lOiBwcm9tcHRMaW5lLCBjaDogMiB9KTtcbiAgICAgICAgICAgICAgICBuZXdFZGl0b3IuZm9jdXMoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgbmV3IE5vdGljZSgnU3RhcnRlZCBuZXcgY2hhdCBzZXNzaW9uJyk7XG4gICAgfVxuXG4gICAgYXN5bmMgc2VuZENoYXRNZXNzYWdlKGVkaXRvcjogRWRpdG9yKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgICAgIC8vIEZpbmQgdGhlIGN1cnJlbnQgY2hhdCBtZXNzYWdlIChsaW5lIHN0YXJ0aW5nIHdpdGggJz4nKVxuICAgICAgICBjb25zdCBjb250ZW50ID0gZWRpdG9yLmdldFZhbHVlKCk7XG4gICAgICAgIGNvbnN0IGxpbmVzID0gY29udGVudC5zcGxpdCgnXFxuJyk7XG4gICAgICAgIGNvbnN0IGN1cnJlbnRMaW5lID0gZWRpdG9yLmdldEN1cnNvcigpLmxpbmU7XG4gICAgICAgIFxuICAgICAgICAvLyBMb2NhdGUgdGhlIHByb21wdFxuICAgICAgICBsZXQgcHJvbXB0TGluZSA9IGN1cnJlbnRMaW5lO1xuICAgICAgICB3aGlsZSAocHJvbXB0TGluZSA+PSAwICYmICFsaW5lc1twcm9tcHRMaW5lXS5zdGFydHNXaXRoKCc+JykpIHtcbiAgICAgICAgICAgIHByb21wdExpbmUtLTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgaWYgKHByb21wdExpbmUgPCAwKSB7XG4gICAgICAgICAgICBuZXcgTm90aWNlKCdObyBjaGF0IHByb21wdCBmb3VuZC4gUGxlYXNlIHN0YXJ0IG1lc3NhZ2Ugd2l0aCA+Jyk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIC8vIEV4dHJhY3QgbWVzc2FnZVxuICAgICAgICBjb25zdCB1c2VyTWVzc2FnZSA9IGxpbmVzW3Byb21wdExpbmVdLnN1YnN0cmluZygyKS50cmltKCk7XG4gICAgICAgIGlmICghdXNlck1lc3NhZ2UpIHtcbiAgICAgICAgICAgIG5ldyBOb3RpY2UoJ1BsZWFzZSB0eXBlIGEgbWVzc2FnZSBmaXJzdCcpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICAvLyBVcGRhdGUgdGhlIGNoYXQgd2l0aCB0aGUgdXNlciBtZXNzYWdlXG4gICAgICAgIGxpbmVzW3Byb21wdExpbmVdID0gYD4gJHt1c2VyTWVzc2FnZX1gO1xuICAgICAgICBcbiAgICAgICAgLy8gQWRkIGEgbG9hZGluZyBpbmRpY2F0b3JcbiAgICAgICAgbGluZXMuc3BsaWNlKHByb21wdExpbmUgKyAxLCAwLCAnXFxuX1N5bmFwc2UgaXMgdGhpbmtpbmcuLi5fJyk7XG4gICAgICAgIGVkaXRvci5zZXRWYWx1ZShsaW5lcy5qb2luKCdcXG4nKSk7XG4gICAgICAgIFxuICAgICAgICAvLyBHZXQgY2hhdCBoaXN0b3J5IGZvciBjb250ZXh0XG4gICAgICAgIGNvbnN0IGNoYXRIaXN0b3J5ID0gdGhpcy5leHRyYWN0Q2hhdEhpc3RvcnkobGluZXMsIHByb21wdExpbmUpO1xuICAgICAgICBcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIC8vIEdlbmVyYXRlIHJlc3BvbnNlXG4gICAgICAgICAgICBjb25zdCBzeXN0ZW1Qcm9tcHQgPSBgWW91IGFyZSBhIGhlbHBmdWwgQUkgYXNzaXN0YW50IGluIGEgY2hhdCBzZXNzaW9uLiBcbiAgICAgICAgICAgIFByb3ZpZGUgdGhvdWdodGZ1bCwgY29uY2lzZSByZXNwb25zZXMgdG8gdGhlIHVzZXIncyBxdWVzdGlvbnMuXG4gICAgICAgICAgICBVc2UgbWFya2Rvd24gZm9ybWF0dGluZyB3aGVuIGFwcHJvcHJpYXRlLlxuICAgICAgICAgICAgUmVmZXJlbmNlIHByaW9yIG1lc3NhZ2VzIGluIHRoZSBjb252ZXJzYXRpb24gd2hlbiByZWxldmFudC5gO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHRoaXMub2xsYW1hLmdlbmVyYXRlKHVzZXJNZXNzYWdlLCBzeXN0ZW1Qcm9tcHQsIGNoYXRIaXN0b3J5KTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgLy8gUmVtb3ZlIGxvYWRpbmcgaW5kaWNhdG9yXG4gICAgICAgICAgICBsaW5lcy5zcGxpY2UocHJvbXB0TGluZSArIDEsIDEpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICAvLyBBZGQgQUkgcmVzcG9uc2UgYW5kIG5ldyBwcm9tcHRcbiAgICAgICAgICAgIGxpbmVzLnNwbGljZShwcm9tcHRMaW5lICsgMSwgMCwgXG4gICAgICAgICAgICAgICAgYFxcbiR7cmVzcG9uc2V9XFxuYCxcbiAgICAgICAgICAgICAgICBgPiBgXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICAvLyBTYXZlIGN1cnJlbnQgc2Nyb2xsIHBvc2l0aW9uXG4gICAgICAgICAgICBjb25zdCBzY3JvbGxJbmZvID0gZWRpdG9yLmdldFNjcm9sbEluZm8gPyBlZGl0b3IuZ2V0U2Nyb2xsSW5mbygpIDogbnVsbDtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgZWRpdG9yLnNldFZhbHVlKGxpbmVzLmpvaW4oJ1xcbicpKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgLy8gSW1wcm92ZWQgY3Vyc29yIHBvc2l0aW9uaW5nIGFuZCB2aWV3IHNjcm9sbGluZyBsb2dpY1xuICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgLy8gR2V0IHVwZGF0ZWQgY29udGVudFxuICAgICAgICAgICAgICAgIGNvbnN0IHVwZGF0ZWRDb250ZW50ID0gZWRpdG9yLmdldFZhbHVlKCk7XG4gICAgICAgICAgICAgICAgY29uc3QgdXBkYXRlZExpbmVzID0gdXBkYXRlZENvbnRlbnQuc3BsaXQoJ1xcbicpO1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIC8vIEZpbmQgdGhlIG5ldyBwcm9tcHQgbGluZSBhZnRlciB0aGUgY3VycmVudCBvbmVcbiAgICAgICAgICAgICAgICBsZXQgbmV3UHJvbXB0TGluZSA9IC0xO1xuICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSBwcm9tcHRMaW5lICsgMTsgaSA8IHVwZGF0ZWRMaW5lcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICBpZiAodXBkYXRlZExpbmVzW2ldID09PSAnPiAnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBuZXdQcm9tcHRMaW5lID0gaTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIC8vIElmIHdlIGZvdW5kIHRoZSBuZXcgcHJvbXB0IGxpbmUsIHBvc2l0aW9uIGN1cnNvciBhZnRlciBcIj5cIlxuICAgICAgICAgICAgICAgIGlmIChuZXdQcm9tcHRMaW5lID49IDApIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gU2V0IGN1cnNvciBwb3NpdGlvblxuICAgICAgICAgICAgICAgICAgICBlZGl0b3Iuc2V0Q3Vyc29yKHsgbGluZTogbmV3UHJvbXB0TGluZSwgY2g6IDIgfSk7XG4gICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAvLyBTY3JvbGwgdG8gdGhlIG5ldyBjdXJzb3IgcG9zaXRpb25cbiAgICAgICAgICAgICAgICAgICAgY29uc3QgY21FZGl0b3IgPSAoZWRpdG9yIGFzIGFueSkuY207XG4gICAgICAgICAgICAgICAgICAgIGlmIChjbUVkaXRvcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gQ29kZU1pcnJvciA2XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoY21FZGl0b3Iuc2Nyb2xsSW50b1ZpZXcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbUVkaXRvci5zY3JvbGxJbnRvVmlldyh7IFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaW5lOiBuZXdQcm9tcHRMaW5lLCBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2g6IDIgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgMTAwKTsgLy8gMTAwcHggbWFyZ2luIGZyb20gYm90dG9tXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBVc2Ugc2Nyb2xsSW50b1ZpZXcgQVBJIChpZiBhdmFpbGFibGUpXG4gICAgICAgICAgICAgICAgICAgICAgICBlZGl0b3Iuc2Nyb2xsSW50b1ZpZXcoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZyb206IHsgbGluZTogbmV3UHJvbXB0TGluZSwgY2g6IDAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0bzogeyBsaW5lOiBuZXdQcm9tcHRMaW5lLCBjaDogMiB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9LCB0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgLy8gRW5zdXJlIHZpZXcgc3RheXMgYXQgYm90dG9tXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGVkaXRvckVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuY20tc2Nyb2xsZXInKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGVkaXRvckVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFNjcm9sbCB0byBib3R0b20gb2YgdGhlIGN1cnJlbnQgdmlld1xuICAgICAgICAgICAgICAgICAgICAgICAgZWRpdG9yRWxlbWVudC5zY3JvbGxUb3AgPSBlZGl0b3JFbGVtZW50LnNjcm9sbEhlaWdodDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgZWRpdG9yLmZvY3VzKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSwgMTAwKTsgLy8gSW5jcmVhc2VkIGRlbGF5IHRvIGVuc3VyZSBlZGl0b3IgY29udGVudCBhbmQgRE9NIGFyZSBmdWxseSB1cGRhdGVkXG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICBuZXcgTm90aWNlKGBFcnJvcjogJHtlcnJvci5tZXNzYWdlfWApO1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcignQ2hhdCBlcnJvcjonLCBlcnJvcik7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vIFJlbW92ZSBsb2FkaW5nIGluZGljYXRvciBhbmQgYWRkIGVycm9yIG1lc3NhZ2VcbiAgICAgICAgICAgIGxpbmVzLnNwbGljZShwcm9tcHRMaW5lICsgMSwgMSk7XG4gICAgICAgICAgICBsaW5lcy5zcGxpY2UocHJvbXB0TGluZSArIDEsIDAsICdfRXJyb3I6IENvdWxkIG5vdCBnZW5lcmF0ZSByZXNwb25zZV8nKTtcbiAgICAgICAgICAgIGVkaXRvci5zZXRWYWx1ZShsaW5lcy5qb2luKCdcXG4nKSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgYXN5bmMgZ2VuZXJhdGVMaXZlU3VnZ2VzdGlvbihlZGl0b3I6IEVkaXRvcik6IFByb21pc2U8dm9pZD4ge1xuICAgICAgICBpZiAoIXRoaXMuc2V0dGluZ3MuZW5hYmxlTGl2ZVN1Z2dlc3Rpb25zKSByZXR1cm47XG4gICAgICAgIFxuICAgICAgICAvLyBHZXQgY3VycmVudCBjb250ZXh0XG4gICAgICAgIGNvbnN0IGNvbnRlbnQgPSBlZGl0b3IuZ2V0VmFsdWUoKTtcbiAgICAgICAgY29uc3QgY3Vyc29yID0gZWRpdG9yLmdldEN1cnNvcigpO1xuICAgICAgICBjb25zdCBjdXJyZW50TGluZSA9IGN1cnNvci5saW5lO1xuICAgICAgICBcbiAgICAgICAgLy8gR2V0IGEgZmV3IGxpbmVzIGJlZm9yZSBjdXJyZW50IGxpbmUgZm9yIGNvbnRleHRcbiAgICAgICAgY29uc3QgY29udGV4dExpbmVzID0gY29udGVudC5zcGxpdCgnXFxuJykuc2xpY2UoTWF0aC5tYXgoMCwgY3VycmVudExpbmUgLSA1KSwgY3VycmVudExpbmUgKyAxKTtcbiAgICAgICAgY29uc3QgY29udGV4dCA9IGNvbnRleHRMaW5lcy5qb2luKCdcXG4nKTtcbiAgICAgICAgXG4gICAgICAgIGlmIChjb250ZXh0LnRyaW0oKS5sZW5ndGggPCAxMCkgcmV0dXJuOyAvLyBOb3QgZW5vdWdoIGNvbnRleHRcbiAgICAgICAgXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICAvLyBUcmFkaXRpb25hbCB0ZXh0IGNvbnRpbnVhdGlvblxuICAgICAgICAgICAgY29uc3Qgc3lzdGVtUHJvbXB0ID0gYFlvdSBhcmUgYW4gQUkgd3JpdGluZyBhc3Npc3RhbnQuIFxuICAgICAgICAgICAgQmFzZWQgb24gdGhlIGNvbnRleHQgcHJvdmlkZWQsIHN1Z2dlc3QgYSBicmllZiBjb250aW51YXRpb24gKDEtMyB3b3JkcyBtYXhpbXVtKS5cbiAgICAgICAgICAgIE1ha2UgeW91ciBzdWdnZXN0aW9uIGRpcmVjdGx5IHJlbGV2YW50IHRvIHdoYXQncyBiZWluZyB3cml0dGVuLlxuICAgICAgICAgICAgRG8gbm90IHJlcGVhdCB3aGF0J3MgYWxyZWFkeSB3cml0dGVuLmA7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgdGhpcy5vbGxhbWEuZ2VuZXJhdGUoYENvbnRpbnVlIHRoaXMgdGV4dDogJHtjb250ZXh0fWAsIHN5c3RlbVByb21wdCk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vIERpc3BsYXkgc3VnZ2VzdGlvbiBhcyBnaG9zdCB0ZXh0XG4gICAgICAgICAgICB0aGlzLmRpc3BsYXlHaG9zdFRleHQoZWRpdG9yLCByZXNwb25zZSk7XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCdTdWdnZXN0aW9uIGVycm9yOicsIGVycm9yKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgZGlzcGxheUdob3N0VGV4dChlZGl0b3I6IEVkaXRvciwgdGV4dDogc3RyaW5nKTogdm9pZCB7XG4gICAgICAgIC8vIERpc3BsYXkgZ2hvc3QgdGV4dCBzdWdnZXN0aW9uXG4gICAgICAgIGlmICghdGhpcy5zZXR0aW5ncy5zaG93R2hvc3RUZXh0KSByZXR1cm47XG4gICAgICAgIFxuICAgICAgICAvLyBDcmVhdGUgYSBub3RpY2Ugd2l0aCB0aGUgc3VnZ2VzdGlvblxuICAgICAgICBjb25zdCBub3RpY2UgPSBuZXcgTm90aWNlKGBTdWdnZXN0aW9uOiAke3RleHQuc3Vic3RyaW5nKDAsIDUwKX0ke3RleHQubGVuZ3RoID4gNTAgPyAnLi4uJyA6ICcnfWAsIDUwMDApO1xuICAgICAgICBcbiAgICAgICAgLy8gQWRkIGFuIGFjY2VwdCBidXR0b25cbiAgICAgICAgaWYgKHRoaXMuc2V0dGluZ3MuYWxsb3dRdWlja0FjY2VwdCkge1xuICAgICAgICAgICAgY29uc3Qgbm90aWNlRWwgPSBub3RpY2Uubm90aWNlRWw7XG4gICAgICAgICAgICBjb25zdCBidXR0b25Db250YWluZXIgPSBub3RpY2VFbC5jcmVhdGVEaXYoJ3N5bmFwc2Utc3VnZ2VzdGlvbi1hY3Rpb25zJyk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGNvbnN0IGFjY2VwdEJ1dHRvbiA9IGJ1dHRvbkNvbnRhaW5lci5jcmVhdGVFbCgnYnV0dG9uJywge1xuICAgICAgICAgICAgICAgIHRleHQ6ICdBY2NlcHQnLFxuICAgICAgICAgICAgICAgIGNsczogJ3N5bmFwc2UtYWNjZXB0LWJ1dHRvbidcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBhY2NlcHRCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgY3Vyc29yID0gZWRpdG9yLmdldEN1cnNvcigpO1xuICAgICAgICAgICAgICAgIGVkaXRvci5yZXBsYWNlUmFuZ2UodGV4dCwgY3Vyc29yKTtcbiAgICAgICAgICAgICAgICBub3RpY2UuaGlkZSgpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIHNhbml0aXplRmlsZU5hbWUodGV4dDogc3RyaW5nKTogc3RyaW5nIHtcbiAgICAgICAgLy8gUmVtb3ZlIG9yIHJlcGxhY2UgaW52YWxpZCBjaGFyYWN0ZXJzIGZvciBmaWxlIG5hbWVzXG4gICAgICAgIHJldHVybiB0ZXh0XG4gICAgICAgICAgICAucmVwbGFjZSgvW15cXHdcXHMtXS9nLCAnJykgLy8gUmVtb3ZlIHNwZWNpYWwgY2hhcmFjdGVycyBleGNlcHQgd29yZCBjaGFycywgc3BhY2VzLCBoeXBoZW5zXG4gICAgICAgICAgICAucmVwbGFjZSgvXFxzKy9nLCAnICcpIC8vIFJlcGxhY2UgbXVsdGlwbGUgc3BhY2VzIHdpdGggc2luZ2xlIHNwYWNlXG4gICAgICAgICAgICAudHJpbSgpXG4gICAgICAgICAgICAuc3Vic3RyaW5nKDAsIDUwKTsgLy8gTGltaXQgbGVuZ3RoXG4gICAgfVxuICAgIFxuICAgIHByaXZhdGUgYXN5bmMgZW5zdXJlRm9sZGVyRXhpc3RzKGZvbGRlclBhdGg6IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xuICAgICAgICBpZiAoIWZvbGRlclBhdGgpIHJldHVybjtcbiAgICAgICAgXG4gICAgICAgIGNvbnN0IGZvbGRlcnMgPSBmb2xkZXJQYXRoLnNwbGl0KCcvJykuZmlsdGVyKHAgPT4gcC50cmltKCkpO1xuICAgICAgICBsZXQgY3VycmVudFBhdGggPSAnJztcbiAgICAgICAgXG4gICAgICAgIGZvciAoY29uc3QgZm9sZGVyIG9mIGZvbGRlcnMpIHtcbiAgICAgICAgICAgIGN1cnJlbnRQYXRoID0gY3VycmVudFBhdGggPyBgJHtjdXJyZW50UGF0aH0vJHtmb2xkZXJ9YCA6IGZvbGRlcjtcbiAgICAgICAgICAgIGlmICghdGhpcy5hcHAudmF1bHQuZ2V0QWJzdHJhY3RGaWxlQnlQYXRoKGN1cnJlbnRQYXRoKSkge1xuICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMuYXBwLnZhdWx0LmNyZWF0ZUZvbGRlcihjdXJyZW50UGF0aCk7XG4gICAgICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihgRmFpbGVkIHRvIGNyZWF0ZSBmb2xkZXIgJHtjdXJyZW50UGF0aH06YCwgZXJyb3IpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICBcbiAgICBwcml2YXRlIGdldEFjdGl2ZUVkaXRvcigpOiBFZGl0b3IgfCBudWxsIHtcbiAgICAgICAgY29uc3QgdmlldyA9IHRoaXMuYXBwLndvcmtzcGFjZS5nZXRBY3RpdmVWaWV3T2ZUeXBlKE1hcmtkb3duVmlldyk7XG4gICAgICAgIHJldHVybiB2aWV3Py5lZGl0b3IgfHwgbnVsbDtcbiAgICB9XG4gICAgXG4gICAgcHJpdmF0ZSBleHRyYWN0Q2hhdEhpc3RvcnkobGluZXM6IHN0cmluZ1tdLCBjdXJyZW50UHJvbXB0TGluZTogbnVtYmVyKTogc3RyaW5nIHtcbiAgICAgICAgLy8gRXh0cmFjdCBhbGwgcHJldmlvdXMgZXhjaGFuZ2VzIHRvIGdpdmUgY29udGV4dCB0byB0aGUgQUlcbiAgICAgICAgbGV0IGNoYXRIaXN0b3J5ID0gJyc7XG4gICAgICAgIGxldCBpbkNoYXQgPSBmYWxzZTtcbiAgICAgICAgXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY3VycmVudFByb21wdExpbmU7IGkrKykge1xuICAgICAgICAgICAgY29uc3QgbGluZSA9IGxpbmVzW2ldO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICAvLyBDaGVjayBpZiB3ZSd2ZSByZWFjaGVkIHRoZSBjaGF0IHNlY3Rpb25cbiAgICAgICAgICAgIGlmIChsaW5lID09PSAnIyMgQ2hhdCcpIHtcbiAgICAgICAgICAgICAgICBpbkNoYXQgPSB0cnVlO1xuICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgXG4gICAgICAgICAgICBpZiAoaW5DaGF0KSB7XG4gICAgICAgICAgICAgICAgaWYgKGxpbmUuc3RhcnRzV2l0aCgnPiAnKSkge1xuICAgICAgICAgICAgICAgICAgICBjaGF0SGlzdG9yeSArPSBgVXNlcjogJHtsaW5lLnN1YnN0cmluZygyKX1cXG5gO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAobGluZS50cmltKCkgJiYgIWxpbmUuc3RhcnRzV2l0aCgnXycpICYmIGxpbmUgIT09ICcnKSB7XG4gICAgICAgICAgICAgICAgICAgIGNoYXRIaXN0b3J5ICs9IGBBSTogJHtsaW5lfVxcbmA7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICByZXR1cm4gY2hhdEhpc3Rvcnk7XG4gICAgfVxufSJdLAogICJtYXBwaW5ncyI6ICI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQSxJQUFBQSxtQkFBcUU7OztBQ21COUQsSUFBTSxtQkFBb0M7QUFBQSxFQUM3QyxXQUFXO0FBQUEsRUFDWCxhQUFhO0FBQUEsRUFDYixpQkFBaUI7QUFBQSxFQUNqQixpQkFBaUI7QUFBQSxFQUNqQixpQkFBaUI7QUFBQSxFQUNqQixtQkFBbUI7QUFBQSxFQUNuQixtQkFBbUI7QUFBQSxFQUNuQixpQkFBaUI7QUFBQSxFQUNqQixnQkFBZ0I7QUFBQSxFQUNoQixZQUFZO0FBQUEsRUFDWixnQkFBZ0I7QUFBQSxFQUNoQix1QkFBdUI7QUFBQSxFQUN2QixpQkFBaUI7QUFBQTtBQUFBLEVBRWpCLGVBQWU7QUFBQSxFQUNmLGtCQUFrQjtBQUN0Qjs7O0FDcENBLHNCQUErQzs7O0FDTXhDLElBQU0sZUFB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
