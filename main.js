/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var __defProp = Object.defineProperty;
var __getOwnPropDesc = Object.getOwnPropertyDescriptor;
var __getOwnPropNames = Object.getOwnPropertyNames;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __export = (target, all) => {
  for (var name in all)
    __defProp(target, name, { get: all[name], enumerable: true });
};
var __copyProps = (to, from, except, desc) => {
  if (from && typeof from === "object" || typeof from === "function") {
    for (let key of __getOwnPropNames(from))
      if (!__hasOwnProp.call(to, key) && key !== except)
        __defProp(to, key, { get: () => from[key], enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable });
  }
  return to;
};
var __toCommonJS = (mod) => __copyProps(__defProp({}, "__esModule", { value: true }), mod);

// src/main.ts
var main_exports = {};
__export(main_exports, {
  default: () => SynapsePlugin
});
module.exports = __toCommonJS(main_exports);
var import_obsidian3 = require("obsidian");

// src/settings.ts
var DEFAULT_SETTINGS = {
  ollamaUrl: "http://localhost:11434",
  ollamaModel: "gemma3n:e2b",
  autoLinkEnabled: true,
  summaryLocation: "top",
  flashcardFormat: "simple",
  maxResponseLength: 1e3,
  explanationFolder: "Explanations",
  flashcardFolder: "Flashcards",
  useSummaryYaml: true,
  chatFolder: "Chats",
  enableLiveChat: true,
  enableLiveSuggestions: false,
  suggestionDelay: 3e3,
  // Simplified settings with defaults
  showGhostText: true,
  allowQuickAccept: true,
  // New default settings
  templatePath: "",
  useTemplateForExplanations: false,
  globalSystemPrompt: "You are a helpful educational assistant providing concise, accurate information.",
  chatSystemPrompt: "You are a helpful AI assistant in a chat session. Provide thoughtful, concise responses to the user's questions. Use markdown formatting when appropriate. Reference prior messages in the conversation when relevant.",
  explanationSystemPrompt: "You are a helpful educational assistant. Create a clear, concise explanation of the given concept. Format your response as a well-structured note with:\n1. A brief definition\n2. Key characteristics or properties\n3. A simple analogy or example if helpful\n4. Why this concept is important\n\nKeep the explanation under {{maxResponseLength}} characters and use clear, educational language.",
  summarySystemPrompt: 'You are a helpful assistant that creates concise summaries. Create a bullet-point summary (3-5 points) of the main ideas in the given text. Each bullet point should be clear and capture a key concept. Format as markdown bullets starting with "- ".',
  flashcardSystemPrompt: "You are a helpful assistant that creates study flashcards. From the given text, identify 3-7 key concepts and create flashcards in this exact format:\n\n**Q:** Question here?\n**A:** Answer here\n\nMake questions clear and specific. Answers should be concise but complete. Focus on the most important concepts for learning and retention.",
  customTemplateVariables: {}
};

// src/ui/SettingsTab.ts
var import_obsidian = require("obsidian");

// src/ollama.ts
var OllamaClient = class {
  constructor(baseUrl, model) {
    this.baseUrl = baseUrl.replace(/\/$/, "");
    this.model = model;
  }
  async isAvailable() {
    try {
      const response = await fetch(`${this.baseUrl}/api/tags`);
      return response.ok;
    } catch (error) {
      return false;
    }
  }
  async generate(prompt, systemPrompt, chatHistory) {
    try {
      let fullPrompt = prompt;
      if (chatHistory && chatHistory.trim()) {
        fullPrompt = `Chat history:
${chatHistory}

Current message: ${prompt}`;
      }
      const requestBody = {
        model: this.model,
        prompt: fullPrompt,
        system: systemPrompt || "",
        stream: false,
        options: {
          temperature: 0.7,
          top_p: 0.9,
          top_k: 40
        }
      };
      const response = await fetch(`${this.baseUrl}/api/generate`, {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify(requestBody)
      });
      if (!response.ok) {
        throw new Error(`Ollama API error: ${response.status}`);
      }
      const data = await response.json();
      return data.response.trim();
    } catch (error) {
      throw new Error(`Failed to generate response: ${error.message}`);
    }
  }
  async getAvailableModels() {
    var _a;
    try {
      const response = await fetch(`${this.baseUrl}/api/tags`);
      if (!response.ok) {
        throw new Error(`Failed to fetch models: ${response.status}`);
      }
      const data = await response.json();
      return ((_a = data.models) == null ? void 0 : _a.map((model) => model.name)) || [];
    } catch (error) {
      console.error("Error fetching models:", error);
      return [];
    }
  }
};

// src/ui/SettingsTab.ts
var SynapseSettingsTab = class extends import_obsidian.PluginSettingTab {
  constructor(app, plugin) {
    super(app, plugin);
    this.plugin = plugin;
  }
  display() {
    const { containerEl } = this;
    containerEl.empty();
    containerEl.addClass("synapse-settings");
    const tabContainer = containerEl.createDiv("synapse-settings-tabs");
    const tabContent = containerEl.createDiv("synapse-settings-content");
    const generalTab = tabContainer.createDiv("synapse-tab");
    generalTab.setText("General");
    generalTab.addClass("active");
    const promptsTab = tabContainer.createDiv("synapse-tab");
    promptsTab.setText("AI Prompts");
    const templatesTab = tabContainer.createDiv("synapse-tab");
    templatesTab.setText("Templates");
    const advancedTab = tabContainer.createDiv("synapse-tab");
    advancedTab.setText("Advanced");
    const generalContent = tabContent.createDiv("synapse-tab-content");
    generalContent.addClass("active");
    const promptsContent = tabContent.createDiv("synapse-tab-content");
    promptsContent.style.display = "none";
    const templatesContent = tabContent.createDiv("synapse-tab-content");
    templatesContent.style.display = "none";
    const advancedContent = tabContent.createDiv("synapse-tab-content");
    advancedContent.style.display = "none";
    const tabs = [generalTab, promptsTab, templatesTab, advancedTab];
    const contents = [generalContent, promptsContent, templatesContent, advancedContent];
    tabs.forEach((tab, index) => {
      tab.addEventListener("click", () => {
        tabs.forEach((t) => t.removeClass("active"));
        contents.forEach((c) => c.style.display = "none");
        tab.addClass("active");
        contents[index].style.display = "block";
      });
    });
    generalContent.createEl("h2", { text: "Synapse Settings" });
    generalContent.createEl("h3", { text: "Ollama Configuration" });
    new import_obsidian.Setting(generalContent).setName("Ollama URL").setDesc("URL where Ollama is running (default: http://localhost:11434)").addText((text) => text.setPlaceholder("http://localhost:11434").setValue(this.plugin.settings.ollamaUrl).onChange(async (value) => {
      this.plugin.settings.ollamaUrl = value;
      await this.plugin.saveSettings();
    }));
    new import_obsidian.Setting(generalContent).setName("Model").setDesc("Ollama model to use (e.g., phi3:mini, llama2, mistral)").addText((text) => text.setPlaceholder("phi3:mini").setValue(this.plugin.settings.ollamaModel).onChange(async (value) => {
      this.plugin.settings.ollamaModel = value;
      await this.plugin.saveSettings();
    }));
    const modelContainer = generalContent.createDiv("synapse-model-selector");
    const modelSetting = new import_obsidian.Setting(modelContainer).setName("Select Available Model").setDesc("Choose from models available in your Ollama installation");
    let modelDropdown;
    modelSetting.addDropdown((dropdown) => {
      modelDropdown = dropdown;
      dropdown.addOption("", "Loading models...");
      dropdown.setValue("");
      dropdown.onChange(async (value) => {
        if (value) {
          this.plugin.settings.ollamaModel = value;
          await this.plugin.saveSettings();
        }
      });
    });
    this.loadAvailableModels(modelDropdown);
    new import_obsidian.Setting(generalContent).setName("Test Connection").setDesc("Test connection to Ollama").addButton((button) => {
      button.setButtonText("Test");
      button.setCta();
      button.buttonEl.addClass("synapse-test-button");
      button.onClick(async () => {
        const client = new OllamaClient(this.plugin.settings.ollamaUrl, this.plugin.settings.ollamaModel);
        const isAvailable = await client.isAvailable();
        if (isAvailable) {
          button.setButtonText("\u2713 Connected");
          button.buttonEl.style.backgroundColor = "#4caf50";
          setTimeout(() => {
            button.setButtonText("Test");
            button.buttonEl.style.backgroundColor = "";
          }, 2e3);
        } else {
          button.setButtonText("\u2717 Failed");
          button.buttonEl.style.backgroundColor = "#f44336";
          setTimeout(() => {
            button.setButtonText("Test");
            button.buttonEl.style.backgroundColor = "";
          }, 2e3);
        }
      });
    });
    generalContent.createEl("h3", { text: "Feature Settings" });
    new import_obsidian.Setting(generalContent).setName("Auto-linking").setDesc('Automatically create links when using "Explain & Link"').addToggle((toggle) => toggle.setValue(this.plugin.settings.autoLinkEnabled).onChange(async (value) => {
      this.plugin.settings.autoLinkEnabled = value;
      await this.plugin.saveSettings();
    }));
    new import_obsidian.Setting(generalContent).setName("Summary Location").setDesc("Where to place summaries in notes").addDropdown((dropdown) => dropdown.addOption("top", "Top of note").addOption("bottom", "Bottom of note").setValue(this.plugin.settings.summaryLocation).onChange(async (value) => {
      this.plugin.settings.summaryLocation = value;
      await this.plugin.saveSettings();
    }));
    new import_obsidian.Setting(generalContent).setName("Use YAML for Summaries").setDesc("Add summaries to note frontmatter as YAML").addToggle((toggle) => toggle.setValue(this.plugin.settings.useSummaryYaml).onChange(async (value) => {
      this.plugin.settings.useSummaryYaml = value;
      await this.plugin.saveSettings();
    }));
    new import_obsidian.Setting(generalContent).setName("Max Response Length").setDesc("Maximum length for AI responses (characters)").addSlider((slider) => slider.setLimits(500, 3e3, 100).setValue(this.plugin.settings.maxResponseLength).setDynamicTooltip().onChange(async (value) => {
      this.plugin.settings.maxResponseLength = value;
      await this.plugin.saveSettings();
    }));
    generalContent.createEl("h3", { text: "Folder Organization" });
    new import_obsidian.Setting(generalContent).setName("Explanations Folder").setDesc("Folder for explanation notes (empty for vault root)").addText((text) => text.setPlaceholder("Explanations").setValue(this.plugin.settings.explanationFolder).onChange(async (value) => {
      this.plugin.settings.explanationFolder = value;
      await this.plugin.saveSettings();
    }));
    new import_obsidian.Setting(generalContent).setName("Flashcards Folder").setDesc("Folder for flashcard notes (empty for vault root)").addText((text) => text.setPlaceholder("Flashcards").setValue(this.plugin.settings.flashcardFolder).onChange(async (value) => {
      this.plugin.settings.flashcardFolder = value;
      await this.plugin.saveSettings();
    }));
    new import_obsidian.Setting(generalContent).setName("Chat Folder").setDesc("Folder for chat session notes (empty for vault root)").addText((text) => text.setPlaceholder("Chats").setValue(this.plugin.settings.chatFolder).onChange(async (value) => {
      this.plugin.settings.chatFolder = value;
      await this.plugin.saveSettings();
    }));
    promptsContent.createEl("h2", { text: "AI Prompts Configuration" });
    promptsContent.createEl("p", {
      text: "Customize the system prompts used for different features. You can use variables like {{maxResponseLength}}, {{date}}, and {{model}}."
    });
    promptsContent.createEl("h3", { text: "Global System Prompt" });
    const globalPromptSetting = new import_obsidian.Setting(promptsContent).setName("Global System Prompt").setDesc("Default system prompt used when no specific prompt is provided");
    let globalPromptArea;
    globalPromptSetting.addTextArea((textarea) => {
      globalPromptArea = textarea;
      textarea.setValue(this.plugin.settings.globalSystemPrompt).setPlaceholder("You are a helpful assistant...").onChange(async (value) => {
        this.plugin.settings.globalSystemPrompt = value;
        await this.plugin.saveSettings();
      });
      textarea.inputEl.rows = 4;
      textarea.inputEl.cols = 50;
    });
    promptsContent.createEl("h3", { text: "Explanation Prompt" });
    const explanationPromptSetting = new import_obsidian.Setting(promptsContent).setName("Explanation System Prompt").setDesc("System prompt used for generating explanations");
    let explanationPromptArea;
    explanationPromptSetting.addTextArea((textarea) => {
      explanationPromptArea = textarea;
      textarea.setValue(this.plugin.settings.explanationSystemPrompt).setPlaceholder("Create a clear, concise explanation...").onChange(async (value) => {
        this.plugin.settings.explanationSystemPrompt = value;
        await this.plugin.saveSettings();
      });
      textarea.inputEl.rows = 6;
      textarea.inputEl.cols = 50;
    });
    promptsContent.createEl("h3", { text: "Summary Prompt" });
    const summaryPromptSetting = new import_obsidian.Setting(promptsContent).setName("Summary System Prompt").setDesc("System prompt used for generating summaries");
    let summaryPromptArea;
    summaryPromptSetting.addTextArea((textarea) => {
      summaryPromptArea = textarea;
      textarea.setValue(this.plugin.settings.summarySystemPrompt).setPlaceholder("Create a bullet-point summary...").onChange(async (value) => {
        this.plugin.settings.summarySystemPrompt = value;
        await this.plugin.saveSettings();
      });
      textarea.inputEl.rows = 4;
      textarea.inputEl.cols = 50;
    });
    promptsContent.createEl("h3", { text: "Flashcard Prompt" });
    const flashcardPromptSetting = new import_obsidian.Setting(promptsContent).setName("Flashcard System Prompt").setDesc("System prompt used for generating flashcards");
    let flashcardPromptArea;
    flashcardPromptSetting.addTextArea((textarea) => {
      flashcardPromptArea = textarea;
      textarea.setValue(this.plugin.settings.flashcardSystemPrompt).setPlaceholder("Create flashcards in this format...").onChange(async (value) => {
        this.plugin.settings.flashcardSystemPrompt = value;
        await this.plugin.saveSettings();
      });
      textarea.inputEl.rows = 6;
      textarea.inputEl.cols = 50;
    });
    promptsContent.createEl("h3", { text: "Chat Prompt" });
    const chatPromptSetting = new import_obsidian.Setting(promptsContent).setName("Chat System Prompt").setDesc("System prompt used for chat sessions");
    let chatPromptArea;
    chatPromptSetting.addTextArea((textarea) => {
      chatPromptArea = textarea;
      textarea.setValue(this.plugin.settings.chatSystemPrompt).setPlaceholder("You are a helpful AI assistant...").onChange(async (value) => {
        this.plugin.settings.chatSystemPrompt = value;
        await this.plugin.saveSettings();
      });
      textarea.inputEl.rows = 4;
      textarea.inputEl.cols = 50;
    });
    new import_obsidian.Setting(promptsContent).setName("Reset Prompts").setDesc("Reset all prompts to default values").addButton((button) => {
      button.setButtonText("Reset to Defaults");
      button.onClick(async () => {
        if (confirm("Are you sure you want to reset all prompts to default values?")) {
          this.plugin.settings.globalSystemPrompt = this.plugin.DEFAULT_SETTINGS.globalSystemPrompt;
          this.plugin.settings.explanationSystemPrompt = this.plugin.DEFAULT_SETTINGS.explanationSystemPrompt;
          this.plugin.settings.summarySystemPrompt = this.plugin.DEFAULT_SETTINGS.summarySystemPrompt;
          this.plugin.settings.flashcardSystemPrompt = this.plugin.DEFAULT_SETTINGS.flashcardSystemPrompt;
          this.plugin.settings.chatSystemPrompt = this.plugin.DEFAULT_SETTINGS.chatSystemPrompt;
          globalPromptArea.setValue(this.plugin.settings.globalSystemPrompt);
          explanationPromptArea.setValue(this.plugin.settings.explanationSystemPrompt);
          summaryPromptArea.setValue(this.plugin.settings.summarySystemPrompt);
          flashcardPromptArea.setValue(this.plugin.settings.flashcardSystemPrompt);
          chatPromptArea.setValue(this.plugin.settings.chatSystemPrompt);
          await this.plugin.saveSettings();
          new Notice("All prompts reset to defaults");
        }
      });
    });
    templatesContent.createEl("h2", { text: "Templates Configuration" });
    templatesContent.createEl("p", {
      text: "Configure templates for generated notes. Templates support variables like {{title}}, {{content}}, {{date}}, and custom variables."
    });
    new import_obsidian.Setting(templatesContent).setName("Template File").setDesc("Select a template file for explanation notes").addText((text) => text.setPlaceholder("path/to/template.md").setValue(this.plugin.settings.templatePath).onChange(async (value) => {
      this.plugin.settings.templatePath = value;
      await this.plugin.saveSettings();
    })).addButton((button) => {
      button.setButtonText("Browse");
      button.onClick(async () => {
        const modal = this.createFileSelectionModal((file) => {
          var _a;
          if (file) {
            this.plugin.settings.templatePath = file.path;
            const textInput = (_a = button.buttonEl.parentElement) == null ? void 0 : _a.querySelector("input");
            if (textInput) {
              textInput.value = file.path;
            }
            this.plugin.saveSettings();
          }
        });
        modal.open();
      });
    });
    new import_obsidian.Setting(templatesContent).setName("Use Template for Explanations").setDesc("Use the selected template file for explanation notes").addToggle((toggle) => toggle.setValue(this.plugin.settings.useTemplateForExplanations).onChange(async (value) => {
      this.plugin.settings.useTemplateForExplanations = value;
      await this.plugin.saveSettings();
    }));
    templatesContent.createEl("h3", { text: "Template Variables" });
    templatesContent.createEl("p", {
      text: "Built-in variables: {{title}} - note title, {{content}} - AI generated content, {{date}} - current date, {{query}} - original selected text"
    });
    templatesContent.createEl("h3", { text: "Custom Template Variables" });
    const customVarsContainer = templatesContent.createDiv("synapse-custom-vars");
    const refreshCustomVariables = () => {
      customVarsContainer.empty();
      for (const [key, value] of Object.entries(this.plugin.settings.customTemplateVariables)) {
        this.addCustomVariableRow(customVarsContainer, key, value);
      }
      const addVarButton = customVarsContainer.createEl("button", {
        text: "Add Custom Variable",
        cls: "synapse-add-var-button"
      });
      addVarButton.addEventListener("click", () => {
        const newKey = `variable${Object.keys(this.plugin.settings.customTemplateVariables).length + 1}`;
        this.plugin.settings.customTemplateVariables[newKey] = "";
        this.plugin.saveSettings();
        refreshCustomVariables();
      });
    };
    refreshCustomVariables();
    advancedContent.createEl("h2", { text: "Advanced Settings" });
    advancedContent.createEl("h3", { text: "Live Features" });
    new import_obsidian.Setting(advancedContent).setName("Enable Live Chat").setDesc("Enable interactive chat sessions in notes").addToggle((toggle) => toggle.setValue(this.plugin.settings.enableLiveChat).onChange(async (value) => {
      this.plugin.settings.enableLiveChat = value;
      await this.plugin.saveSettings();
    }));
    new import_obsidian.Setting(advancedContent).setName("Enable Live Suggestions").setDesc("Provide suggestions as you type (experimental)").addToggle((toggle) => toggle.setValue(this.plugin.settings.enableLiveSuggestions).onChange(async (value) => {
      this.plugin.settings.enableLiveSuggestions = value;
      await this.plugin.saveSettings();
      this.updateLiveFeatureSettingsVisibility();
    }));
    const liveSuggestionsContainer = advancedContent.createDiv("synapse-live-settings");
    new import_obsidian.Setting(liveSuggestionsContainer).setName("Show Ghost Text").setDesc("Show suggested text completions as you type").addToggle((toggle) => toggle.setValue(this.plugin.settings.showGhostText).onChange(async (value) => {
      this.plugin.settings.showGhostText = value;
      await this.plugin.saveSettings();
    })).setDisabled(!this.plugin.settings.enableLiveSuggestions);
    new import_obsidian.Setting(liveSuggestionsContainer).setName("Allow Quick Accept").setDesc("Show accept button for suggestions").addToggle((toggle) => toggle.setValue(this.plugin.settings.allowQuickAccept).onChange(async (value) => {
      this.plugin.settings.allowQuickAccept = value;
      await this.plugin.saveSettings();
    })).setDisabled(!this.plugin.settings.enableLiveSuggestions);
    new import_obsidian.Setting(liveSuggestionsContainer).setName("Suggestion Delay").setDesc("Delay before showing suggestions (milliseconds)").addSlider((slider) => slider.setLimits(500, 5e3, 100).setValue(this.plugin.settings.suggestionDelay).setDynamicTooltip().onChange(async (value) => {
      this.plugin.settings.suggestionDelay = value;
      await this.plugin.saveSettings();
    })).setDisabled(!this.plugin.settings.enableLiveSuggestions);
    this.updateLiveFeatureSettingsVisibility();
  }
  updateLiveFeatureSettingsVisibility() {
    const liveSettingsDiv = this.containerEl.querySelector(".synapse-live-settings");
    if (liveSettingsDiv) {
      liveSettingsDiv.style.display = this.plugin.settings.enableLiveSuggestions ? "block" : "none";
    }
  }
  async loadAvailableModels(dropdown) {
    try {
      dropdown.selectEl.empty();
      dropdown.addOption("", "Loading models...");
      const client = new OllamaClient(this.plugin.settings.ollamaUrl, "");
      const models = await client.getAvailableModels();
      dropdown.selectEl.empty();
      if (models.length === 0) {
        dropdown.addOption("", "No models found");
      } else {
        models.forEach((model) => {
          dropdown.addOption(model, model);
        });
        if (models.includes(this.plugin.settings.ollamaModel)) {
          dropdown.setValue(this.plugin.settings.ollamaModel);
        }
      }
    } catch (error) {
      console.error("Error loading models:", error);
      dropdown.selectEl.empty();
      dropdown.addOption("", "Error loading models");
    }
  }
  addCustomVariableRow(container, key, value) {
    const row = container.createDiv("synapse-custom-var-row");
    const keyInput = row.createEl("input", {
      type: "text",
      value: key,
      placeholder: "Variable name"
    });
    const valueInput = row.createEl("input", {
      type: "text",
      value,
      placeholder: "Value"
    });
    const deleteButton = row.createEl("button", {
      text: "\u2715",
      cls: "synapse-delete-var-button"
    });
    keyInput.addEventListener("change", () => {
      delete this.plugin.settings.customTemplateVariables[key];
      this.plugin.settings.customTemplateVariables[keyInput.value] = valueInput.value;
      this.plugin.saveSettings();
    });
    valueInput.addEventListener("change", () => {
      this.plugin.settings.customTemplateVariables[key] = valueInput.value;
      this.plugin.saveSettings();
    });
    deleteButton.addEventListener("click", () => {
      delete this.plugin.settings.customTemplateVariables[key];
      this.plugin.saveSettings();
      row.remove();
    });
  }
  createFileSelectionModal(callback) {
    const { modal, contentEl } = this.createModal("Select Template File");
    const searchEl = contentEl.createEl("input", {
      type: "text",
      placeholder: "Search files..."
    });
    const fileListEl = contentEl.createDiv("synapse-file-list");
    const markdownFiles = this.app.vault.getMarkdownFiles();
    const displayFiles = (files) => {
      fileListEl.empty();
      if (files.length === 0) {
        fileListEl.createEl("div", { text: "No files found" });
        return;
      }
      for (const file of files) {
        const fileItem = fileListEl.createDiv("synapse-file-item");
        fileItem.setText(file.path);
        fileItem.addEventListener("click", () => {
          callback(file);
          modal.close();
        });
      }
    };
    displayFiles(markdownFiles);
    searchEl.addEventListener("input", () => {
      const searchTerm = searchEl.value.toLowerCase();
      const filteredFiles = markdownFiles.filter(
        (file) => file.path.toLowerCase().includes(searchTerm)
      );
      displayFiles(filteredFiles);
    });
    const footerEl = contentEl.createDiv("synapse-modal-footer");
    const cancelButton = footerEl.createEl("button", { text: "Cancel" });
    cancelButton.addEventListener("click", () => {
      callback(null);
      modal.close();
    });
    return modal;
  }
  createModal(title) {
    const modal = new (require("obsidian")).Modal(this.app);
    modal.titleEl.setText(title);
    modal.contentEl.addClass("synapse-modal");
    return { modal, contentEl: modal.contentEl };
  }
};

// src/commands.ts
var import_obsidian2 = require("obsidian");
var SynapseCommands = class {
  constructor(app, ollama, settings) {
    this.app = app;
    this.ollama = ollama;
    this.settings = settings;
  }
  updateSettings(settings) {
    this.settings = settings;
    this.ollama = new OllamaClient(settings.ollamaUrl, settings.ollamaModel);
  }
  async explainAndLink(editor, selectedText) {
    if (!selectedText.trim()) {
      new import_obsidian2.Notice("Please select text to explain");
      return;
    }
    const noticeLoading = new import_obsidian2.Notice("Generating explanation...", 0);
    try {
      const systemPrompt = this.processTemplateVariables(this.settings.explanationSystemPrompt);
      const prompt = `Explain this concept: "${selectedText}"`;
      const explanation = await this.ollama.generate(prompt, systemPrompt);
      const noteTitle = this.sanitizeFileName(selectedText);
      await this.ensureFolderExists(this.settings.explanationFolder);
      const filePath = `${this.settings.explanationFolder}/${noteTitle}.md`;
      const existingFile = this.app.vault.getAbstractFileByPath(filePath);
      if (existingFile instanceof import_obsidian2.TFile) {
        new import_obsidian2.Notice(`Note "${noteTitle}" already exists`);
        noticeLoading.hide();
        return;
      }
      let noteContent;
      if (this.settings.useTemplateForExplanations && this.settings.templatePath) {
        noteContent = await this.generateFromTemplate(
          this.settings.templatePath,
          {
            title: noteTitle,
            content: explanation,
            date: new Date().toLocaleDateString(),
            query: selectedText,
            ...this.settings.customTemplateVariables
          }
        );
      } else {
        noteContent = `# ${noteTitle}

${explanation}

---
*Generated by Synapse AI*
*Created: ${new Date().toLocaleDateString()}*`;
      }
      const newFile = await this.app.vault.create(filePath, noteContent);
      const link = `[[${filePath.replace(".md", "")}|${noteTitle}]]`;
      editor.replaceSelection(link);
      await this.app.workspace.getLeaf().openFile(newFile);
      noticeLoading.hide();
      new import_obsidian2.Notice(`Created and linked note: ${noteTitle}`);
    } catch (error) {
      noticeLoading.hide();
      new import_obsidian2.Notice(`Error: ${error.message}`);
      console.error("Explain and Link error:", error);
    }
  }
  async summarizeNote(editor, content) {
    var _a, _b;
    if (!content.trim()) {
      new import_obsidian2.Notice("No content to summarize");
      return;
    }
    const noticeLoading = new import_obsidian2.Notice("Generating summary...", 0);
    try {
      const systemPrompt = this.processTemplateVariables(this.settings.summarySystemPrompt);
      const prompt = `Summarize this content:

${content}`;
      const summary = await this.ollama.generate(prompt, systemPrompt);
      let summarySection;
      if (this.settings.useSummaryYaml) {
        summarySection = `---
summary:
${summary.split("\n").map((line) => `  ${line}`).join("\n")}
---

`;
      } else {
        summarySection = `## Summary

${summary}

---

`;
      }
      if (this.settings.summaryLocation === "top") {
        const lines = content.split("\n");
        let insertIndex = 0;
        if ((_a = lines[0]) == null ? void 0 : _a.startsWith("---")) {
          let endFrontMatter = lines.findIndex((line, i) => i > 0 && line.startsWith("---"));
          if (endFrontMatter !== -1) {
            insertIndex = endFrontMatter + 1;
          }
        }
        if (this.settings.useSummaryYaml && ((_b = lines[0]) == null ? void 0 : _b.startsWith("---"))) {
          const endFrontMatter = lines.findIndex((line, i) => i > 0 && line.startsWith("---"));
          if (endFrontMatter !== -1) {
            const existingFrontmatter = lines.slice(0, endFrontMatter + 1).join("\n");
            const openFrontmatter = existingFrontmatter.replace(/---\s*$/, "");
            const summaryYaml = `summary:
${summary.split("\n").map((line) => `  ${line}`).join("\n")}
---`;
            const newContent2 = openFrontmatter + summaryYaml + "\n\n" + lines.slice(endFrontMatter + 1).join("\n");
            editor.setValue(newContent2);
            noticeLoading.hide();
            new import_obsidian2.Notice("Summary added to frontmatter");
            return;
          }
        }
        const newContent = [
          ...lines.slice(0, insertIndex),
          "",
          summarySection,
          ...lines.slice(insertIndex)
        ].join("\n");
        editor.setValue(newContent);
      } else {
        editor.setValue(content + "\n\n" + summarySection);
      }
      noticeLoading.hide();
      new import_obsidian2.Notice("Summary added to note");
    } catch (error) {
      noticeLoading.hide();
      new import_obsidian2.Notice(`Error: ${error.message}`);
      console.error("Summarize error:", error);
    }
  }
  async createFlashcards(editor, selectedText) {
    if (!selectedText.trim()) {
      new import_obsidian2.Notice("Please select text to create flashcards from");
      return;
    }
    const noticeLoading = new import_obsidian2.Notice("Creating flashcards...", 0);
    try {
      const systemPrompt = this.processTemplateVariables(this.settings.flashcardSystemPrompt);
      const prompt = `Create flashcards from this content:

${selectedText}`;
      const flashcards = await this.ollama.generate(prompt, systemPrompt);
      const activeFile = this.app.workspace.getActiveFile();
      const noteTitle = activeFile ? activeFile.basename : "Untitled";
      await this.ensureFolderExists(this.settings.flashcardFolder);
      const flashcardFileName = `${this.settings.flashcardFolder}/${noteTitle} - Flashcards.md`;
      const flashcardContent = `# Flashcards for ${noteTitle}

${flashcards}

---
*Generated from: [[${activeFile ? activeFile.path.replace(".md", "") : "Unknown source"}]]*
*Created: ${new Date().toLocaleDateString()}*
`;
      const existingFile = this.app.vault.getAbstractFileByPath(flashcardFileName);
      if (existingFile instanceof import_obsidian2.TFile) {
        const existingContent = await this.app.vault.read(existingFile);
        const newContent = existingContent + "\n\n## New Flashcards\n\n" + flashcards;
        await this.app.vault.modify(existingFile, newContent);
        await this.app.workspace.getLeaf().openFile(existingFile);
        noticeLoading.hide();
        new import_obsidian2.Notice("Added flashcards to existing note");
      } else {
        const newFile = await this.app.vault.create(flashcardFileName, flashcardContent);
        await this.app.workspace.getLeaf().openFile(newFile);
        noticeLoading.hide();
        new import_obsidian2.Notice("Created new flashcards note");
      }
      const link = `

[[${flashcardFileName.replace(".md", "")}|Flashcards for this note]]
`;
      const cursor = editor.getCursor();
      editor.setLine(cursor.line, editor.getLine(cursor.line) + link);
    } catch (error) {
      noticeLoading.hide();
      new import_obsidian2.Notice(`Error: ${error.message}`);
      console.error("Create Flashcards error:", error);
    }
  }
  async startChatSession(editor) {
    await this.ensureFolderExists(this.settings.chatFolder);
    const timestamp = new Date().toISOString().replace(/[:.]/g, "-");
    const chatFileName = `${this.settings.chatFolder}/Chat-${timestamp}.md`;
    const chatTemplate = `# Chat Session ${new Date().toLocaleString()}

## Context
*This is a chat session with Synapse AI. Type your messages after the > prompt.*

## Chat

> 

`;
    const newFile = await this.app.vault.create(chatFileName, chatTemplate);
    const leaf = this.app.workspace.getLeaf();
    await leaf.openFile(newFile);
    const newEditor = this.getActiveEditor();
    if (newEditor) {
      const lines = chatTemplate.split("\n");
      const promptLine = lines.findIndex((line) => line === "> ");
      if (promptLine !== -1) {
        newEditor.setCursor({ line: promptLine, ch: 2 });
        newEditor.focus();
      }
    }
    new import_obsidian2.Notice("Started new chat session");
  }
  async sendChatMessage(editor) {
    const content = editor.getValue();
    const lines = content.split("\n");
    const currentLine = editor.getCursor().line;
    let promptLine = currentLine;
    while (promptLine >= 0 && !lines[promptLine].startsWith(">")) {
      promptLine--;
    }
    if (promptLine < 0) {
      new import_obsidian2.Notice("No chat prompt found. Please start message with >");
      return;
    }
    const userMessage = lines[promptLine].substring(2).trim();
    if (!userMessage) {
      new import_obsidian2.Notice("Please type a message first");
      return;
    }
    lines[promptLine] = `> ${userMessage}`;
    lines.splice(promptLine + 1, 0, "\n_Synapse is thinking..._");
    editor.setValue(lines.join("\n"));
    const chatHistory = this.extractChatHistory(lines, promptLine);
    try {
      const systemPrompt = this.processTemplateVariables(this.settings.chatSystemPrompt);
      const response = await this.ollama.generate(userMessage, systemPrompt, chatHistory);
      lines.splice(promptLine + 1, 1);
      lines.splice(
        promptLine + 1,
        0,
        `
${response}
`,
        `> `
      );
      const scrollInfo = editor.getScrollInfo ? editor.getScrollInfo() : null;
      editor.setValue(lines.join("\n"));
      setTimeout(() => {
        const updatedContent = editor.getValue();
        const updatedLines = updatedContent.split("\n");
        let newPromptLine = -1;
        for (let i = promptLine + 1; i < updatedLines.length; i++) {
          if (updatedLines[i] === "> ") {
            newPromptLine = i;
            break;
          }
        }
        if (newPromptLine >= 0) {
          editor.setCursor({ line: newPromptLine, ch: 2 });
          const cmEditor = editor.cm;
          if (cmEditor) {
            if (cmEditor.scrollIntoView) {
              cmEditor.scrollIntoView({
                line: newPromptLine,
                ch: 2
              }, 100);
            }
          } else {
            editor.scrollIntoView({
              from: { line: newPromptLine, ch: 0 },
              to: { line: newPromptLine, ch: 2 }
            }, true);
          }
          const editorElement = document.querySelector(".cm-scroller");
          if (editorElement) {
            editorElement.scrollTop = editorElement.scrollHeight;
          }
          editor.focus();
        }
      }, 100);
    } catch (error) {
      new import_obsidian2.Notice(`Error: ${error.message}`);
      console.error("Chat error:", error);
      lines.splice(promptLine + 1, 1);
      lines.splice(promptLine + 1, 0, "_Error: Could not generate response_");
      editor.setValue(lines.join("\n"));
    }
  }
  async generateLiveSuggestion(editor) {
    if (!this.settings.enableLiveSuggestions)
      return;
    const content = editor.getValue();
    const cursor = editor.getCursor();
    const currentLine = cursor.line;
    const contextLines = content.split("\n").slice(Math.max(0, currentLine - 5), currentLine + 3);
    const context = contextLines.join("\n");
    if (context.trim().length < 3)
      return;
    try {
      const systemPrompt = `You are an AI writing assistant. 
            Based on the context provided, suggest a brief continuation (1-3 words maximum).
            Make your suggestion directly relevant to what's being written.
            Do not repeat what's already written. 
            Only return the continuation text. Do not include any additional text or formatting.`;
      const response = await this.ollama.generate(`Continue this text: ${context}`, systemPrompt);
      this.displayGhostText(editor, response);
    } catch (error) {
      console.error("Suggestion error:", error);
    }
  }
  displayGhostText(editor, text) {
    if (!this.settings.showGhostText)
      return;
    const notice = new import_obsidian2.Notice(`Suggestion: ${text.substring(0, 50)}${text.length > 50 ? "..." : ""}`, 5e3);
    if (this.settings.allowQuickAccept) {
      const noticeEl = notice.noticeEl;
      const buttonContainer = noticeEl.createDiv("synapse-suggestion-actions");
      const acceptButton = buttonContainer.createEl("button", {
        text: "Accept",
        cls: "synapse-accept-button"
      });
      acceptButton.addEventListener("click", () => {
        const cursor = editor.getCursor();
        editor.replaceRange(" " + text, cursor);
        notice.hide();
      });
    }
  }
  // New method to process template variables in prompts
  processTemplateVariables(text) {
    let processed = text;
    processed = processed.replace(/{{maxResponseLength}}/g, this.settings.maxResponseLength.toString());
    processed = processed.replace(/{{model}}/g, this.settings.ollamaModel);
    processed = processed.replace(/{{date}}/g, new Date().toLocaleDateString());
    for (const [key, value] of Object.entries(this.settings.customTemplateVariables)) {
      processed = processed.replace(new RegExp(`{{${key}}}`, "g"), value);
    }
    return processed;
  }
  // New method to generate note content from template
  async generateFromTemplate(templatePath, variables) {
    try {
      const templateFile = this.app.vault.getAbstractFileByPath(templatePath);
      if (!(templateFile instanceof import_obsidian2.TFile)) {
        throw new Error(`Template file not found: ${templatePath}`);
      }
      let templateContent = await this.app.vault.read(templateFile);
      for (const [key, value] of Object.entries(variables)) {
        templateContent = templateContent.replace(new RegExp(`{{${key}}}`, "g"), value);
      }
      return templateContent;
    } catch (error) {
      console.error("Template error:", error);
      throw new Error(`Failed to process template: ${error.message}`);
    }
  }
  sanitizeFileName(text) {
    return text.replace(/[^\w\s-]/g, "").replace(/\s+/g, " ").trim().substring(0, 50);
  }
  async ensureFolderExists(folderPath) {
    if (!folderPath)
      return;
    const folders = folderPath.split("/").filter((p) => p.trim());
    let currentPath = "";
    for (const folder of folders) {
      currentPath = currentPath ? `${currentPath}/${folder}` : folder;
      if (!this.app.vault.getAbstractFileByPath(currentPath)) {
        try {
          await this.app.vault.createFolder(currentPath);
        } catch (error) {
          console.error(`Failed to create folder ${currentPath}:`, error);
        }
      }
    }
  }
  getActiveEditor() {
    const view = this.app.workspace.getActiveViewOfType(import_obsidian2.MarkdownView);
    return (view == null ? void 0 : view.editor) || null;
  }
  extractChatHistory(lines, currentPromptLine) {
    let chatHistory = "";
    let inChat = false;
    for (let i = 0; i < currentPromptLine; i++) {
      const line = lines[i];
      if (line === "## Chat") {
        inChat = true;
        continue;
      }
      if (inChat) {
        if (line.startsWith("> ")) {
          chatHistory += `User: ${line.substring(2)}
`;
        } else if (line.trim() && !line.startsWith("_") && line !== "") {
          chatHistory += `AI: ${line}
`;
        }
      }
    }
    return chatHistory;
  }
};

// src/main.ts
var SynapsePlugin = class extends import_obsidian3.Plugin {
  constructor() {
    super(...arguments);
    this.DEFAULT_SETTINGS = DEFAULT_SETTINGS;
  }
  async onload() {
    await this.loadSettings();
    this.ollama = new OllamaClient(this.settings.ollamaUrl, this.settings.ollamaModel);
    this.commands = new SynapseCommands(this.app, this.ollama, this.settings);
    this.debouncedSuggestion = (0, import_obsidian3.debounce)(
      (editor) => this.commands.generateLiveSuggestion(editor),
      this.settings.suggestionDelay
    );
    this.addSettingTab(new SynapseSettingsTab(this.app, this));
    this.addCommand({
      id: "explain-and-link",
      name: "Explain & Link Selected Text",
      editorCallback: (editor) => {
        const selectedText = editor.getSelection();
        this.commands.explainAndLink(editor, selectedText);
      }
    });
    this.addCommand({
      id: "summarize-note",
      name: "Summarize Current Note",
      editorCallback: (editor) => {
        const content = editor.getValue();
        this.commands.summarizeNote(editor, content);
      }
    });
    this.addCommand({
      id: "create-flashcards",
      name: "Create Flashcards from Selection",
      editorCallback: (editor) => {
        const selectedText = editor.getSelection();
        this.commands.createFlashcards(editor, selectedText);
      }
    });
    this.addCommand({
      id: "start-chat",
      name: "Start New Chat Session",
      editorCallback: (editor) => {
        this.commands.startChatSession(editor);
      }
    });
    this.addCommand({
      id: "send-chat-message",
      name: "Send Chat Message",
      editorCallback: (editor) => {
        this.commands.sendChatMessage(editor);
      }
    });
    this.addCommand({
      id: "toggle-live-suggestions",
      name: "Toggle Live Suggestions",
      callback: () => {
        this.settings.enableLiveSuggestions = !this.settings.enableLiveSuggestions;
        this.saveSettings();
        new import_obsidian3.Notice(`Live suggestions ${this.settings.enableLiveSuggestions ? "enabled" : "disabled"}`);
      }
    });
    this.registerEvent(
      this.app.workspace.on("editor-menu", (menu, editor) => {
        var _a;
        const selectedText = editor.getSelection();
        if (selectedText) {
          menu.addItem((item) => {
            item.setTitle("\u{1F9E0} Explain & Link").setIcon("brain-circuit").onClick(async () => {
              await this.commands.explainAndLink(editor, selectedText);
            });
          });
          menu.addItem((item) => {
            item.setTitle("\u{1F3B4} Create Flashcards").setIcon("card-stack").onClick(async () => {
              await this.commands.createFlashcards(editor, selectedText);
            });
          });
        }
        menu.addItem((item) => {
          item.setTitle("\u{1F4DD} Summarize Note").setIcon("list-checks").onClick(async () => {
            const content = editor.getValue();
            await this.commands.summarizeNote(editor, content);
          });
        });
        const fileName = ((_a = this.app.workspace.getActiveFile()) == null ? void 0 : _a.basename) || "";
        if (fileName.startsWith("Chat-")) {
          menu.addItem((item) => {
            item.setTitle("\u{1F4AC} Send Chat Message").setIcon("message-square").onClick(async () => {
              await this.commands.sendChatMessage(editor);
            });
          });
        } else {
          menu.addItem((item) => {
            item.setTitle("\u{1F4AC} Start Chat Session").setIcon("message-circle").onClick(async () => {
              await this.commands.startChatSession(editor);
            });
          });
        }
      })
    );
    this.registerLiveSuggestionEvents();
    this.checkOllamaConnection();
    console.log("Synapse plugin loaded");
  }
  onunload() {
    console.log("Synapse plugin unloaded");
  }
  async loadSettings() {
    this.settings = Object.assign({}, DEFAULT_SETTINGS, await this.loadData());
  }
  async saveSettings() {
    await this.saveData(this.settings);
    this.commands.updateSettings(this.settings);
    this.debouncedSuggestion = (0, import_obsidian3.debounce)(
      (editor) => this.commands.generateLiveSuggestion(editor),
      this.settings.suggestionDelay
    );
    this.registerLiveSuggestionEvents();
  }
  registerLiveSuggestionEvents() {
    if (this.liveSuggestionEvent) {
      this.app.workspace.off("editor-change", this.liveSuggestionEvent);
    }
    if (this.settings.enableLiveSuggestions) {
      this.liveSuggestionEvent = this.app.workspace.on("editor-change", (editor) => {
        this.debouncedSuggestion(editor);
      });
      this.registerEvent(this.liveSuggestionEvent);
    }
  }
  async checkOllamaConnection() {
    const isAvailable = await this.ollama.isAvailable();
    if (!isAvailable) {
      new import_obsidian3.Notice(
        "Synapse: Cannot connect to Ollama. Please make sure Ollama is running on " + this.settings.ollamaUrl,
        8e3
      );
    } else {
      new import_obsidian3.Notice("Synapse: Connected to Ollama successfully", 3e3);
    }
  }
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsic3JjL21haW4udHMiLCAic3JjL3NldHRpbmdzLnRzIiwgInNyYy91aS9TZXR0aW5nc1RhYi50cyIsICJzcmMvb2xsYW1hLnRzIiwgInNyYy9jb21tYW5kcy50cyJdLAogICJzb3VyY2VzQ29udGVudCI6IFsiaW1wb3J0IHsgUGx1Z2luLCBFZGl0b3IsIE1hcmtkb3duVmlldywgTWVudSwgTm90aWNlLCBkZWJvdW5jZSB9IGZyb20gJ29ic2lkaWFuJztcbmltcG9ydCB7IFN5bmFwc2VTZXR0aW5ncywgREVGQVVMVF9TRVRUSU5HUyB9IGZyb20gJy4vc2V0dGluZ3MnO1xuaW1wb3J0IHsgU3luYXBzZVNldHRpbmdzVGFiIH0gZnJvbSAnLi91aS9TZXR0aW5nc1RhYic7XG5pbXBvcnQgeyBPbGxhbWFDbGllbnQgfSBmcm9tICcuL29sbGFtYSc7XG5pbXBvcnQgeyBTeW5hcHNlQ29tbWFuZHMgfSBmcm9tICcuL2NvbW1hbmRzJztcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgU3luYXBzZVBsdWdpbiBleHRlbmRzIFBsdWdpbiB7XG4gICAgc2V0dGluZ3M6IFN5bmFwc2VTZXR0aW5ncztcbiAgICBvbGxhbWE6IE9sbGFtYUNsaWVudDtcbiAgICBjb21tYW5kczogU3luYXBzZUNvbW1hbmRzO1xuICAgIGRlYm91bmNlZFN1Z2dlc3Rpb246IGFueTtcbiAgICBsaXZlU3VnZ2VzdGlvbkV2ZW50OiBhbnk7XG4gICAgREVGQVVMVF9TRVRUSU5HUyA9IERFRkFVTFRfU0VUVElOR1M7XG5cbiAgICBhc3luYyBvbmxvYWQoKSB7XG4gICAgICAgIGF3YWl0IHRoaXMubG9hZFNldHRpbmdzKCk7XG5cbiAgICAgICAgLy8gSW5pdGlhbGl6ZSBPbGxhbWEgY2xpZW50IGFuZCBjb21tYW5kc1xuICAgICAgICB0aGlzLm9sbGFtYSA9IG5ldyBPbGxhbWFDbGllbnQodGhpcy5zZXR0aW5ncy5vbGxhbWFVcmwsIHRoaXMuc2V0dGluZ3Mub2xsYW1hTW9kZWwpO1xuICAgICAgICB0aGlzLmNvbW1hbmRzID0gbmV3IFN5bmFwc2VDb21tYW5kcyh0aGlzLmFwcCwgdGhpcy5vbGxhbWEsIHRoaXMuc2V0dGluZ3MpO1xuXG4gICAgICAgIC8vIFNldCB1cCBkZWJvdW5jZWQgc3VnZ2VzdGlvbiB3aXRoIG1vcmUgYWR2YW5jZWQgZmVhdHVyZXNcbiAgICAgICAgdGhpcy5kZWJvdW5jZWRTdWdnZXN0aW9uID0gZGVib3VuY2UoXG4gICAgICAgICAgICAoZWRpdG9yOiBFZGl0b3IpID0+IHRoaXMuY29tbWFuZHMuZ2VuZXJhdGVMaXZlU3VnZ2VzdGlvbihlZGl0b3IpLFxuICAgICAgICAgICAgdGhpcy5zZXR0aW5ncy5zdWdnZXN0aW9uRGVsYXlcbiAgICAgICAgKTtcblxuICAgICAgICAvLyBBZGQgc2V0dGluZ3MgdGFiXG4gICAgICAgIHRoaXMuYWRkU2V0dGluZ1RhYihuZXcgU3luYXBzZVNldHRpbmdzVGFiKHRoaXMuYXBwLCB0aGlzKSk7XG5cbiAgICAgICAgLy8gUmVnaXN0ZXIgY29tbWFuZHNcbiAgICAgICAgdGhpcy5hZGRDb21tYW5kKHtcbiAgICAgICAgICAgIGlkOiAnZXhwbGFpbi1hbmQtbGluaycsXG4gICAgICAgICAgICBuYW1lOiAnRXhwbGFpbiAmIExpbmsgU2VsZWN0ZWQgVGV4dCcsXG4gICAgICAgICAgICBlZGl0b3JDYWxsYmFjazogKGVkaXRvcjogRWRpdG9yKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3Qgc2VsZWN0ZWRUZXh0ID0gZWRpdG9yLmdldFNlbGVjdGlvbigpO1xuICAgICAgICAgICAgICAgIHRoaXMuY29tbWFuZHMuZXhwbGFpbkFuZExpbmsoZWRpdG9yLCBzZWxlY3RlZFRleHQpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGhpcy5hZGRDb21tYW5kKHtcbiAgICAgICAgICAgIGlkOiAnc3VtbWFyaXplLW5vdGUnLFxuICAgICAgICAgICAgbmFtZTogJ1N1bW1hcml6ZSBDdXJyZW50IE5vdGUnLFxuICAgICAgICAgICAgZWRpdG9yQ2FsbGJhY2s6IChlZGl0b3I6IEVkaXRvcikgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IGNvbnRlbnQgPSBlZGl0b3IuZ2V0VmFsdWUoKTtcbiAgICAgICAgICAgICAgICB0aGlzLmNvbW1hbmRzLnN1bW1hcml6ZU5vdGUoZWRpdG9yLCBjb250ZW50KTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRoaXMuYWRkQ29tbWFuZCh7XG4gICAgICAgICAgICBpZDogJ2NyZWF0ZS1mbGFzaGNhcmRzJyxcbiAgICAgICAgICAgIG5hbWU6ICdDcmVhdGUgRmxhc2hjYXJkcyBmcm9tIFNlbGVjdGlvbicsXG4gICAgICAgICAgICBlZGl0b3JDYWxsYmFjazogKGVkaXRvcjogRWRpdG9yKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3Qgc2VsZWN0ZWRUZXh0ID0gZWRpdG9yLmdldFNlbGVjdGlvbigpO1xuICAgICAgICAgICAgICAgIHRoaXMuY29tbWFuZHMuY3JlYXRlRmxhc2hjYXJkcyhlZGl0b3IsIHNlbGVjdGVkVGV4dCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9KTtcbiAgICAgICAgXG4gICAgICAgIC8vIEFkZCBuZXcgY2hhdCBjb21tYW5kc1xuICAgICAgICB0aGlzLmFkZENvbW1hbmQoe1xuICAgICAgICAgICAgaWQ6ICdzdGFydC1jaGF0JyxcbiAgICAgICAgICAgIG5hbWU6ICdTdGFydCBOZXcgQ2hhdCBTZXNzaW9uJyxcbiAgICAgICAgICAgIGVkaXRvckNhbGxiYWNrOiAoZWRpdG9yOiBFZGl0b3IpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmNvbW1hbmRzLnN0YXJ0Q2hhdFNlc3Npb24oZWRpdG9yKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0pO1xuICAgICAgICBcbiAgICAgICAgdGhpcy5hZGRDb21tYW5kKHtcbiAgICAgICAgICAgIGlkOiAnc2VuZC1jaGF0LW1lc3NhZ2UnLFxuICAgICAgICAgICAgbmFtZTogJ1NlbmQgQ2hhdCBNZXNzYWdlJyxcbiAgICAgICAgICAgIGVkaXRvckNhbGxiYWNrOiAoZWRpdG9yOiBFZGl0b3IpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmNvbW1hbmRzLnNlbmRDaGF0TWVzc2FnZShlZGl0b3IpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gQWRkIG5ldyBjb21tYW5kIGZvciBMaXZlIENvcGlsb3RcbiAgICAgICAgdGhpcy5hZGRDb21tYW5kKHtcbiAgICAgICAgICAgIGlkOiAndG9nZ2xlLWxpdmUtc3VnZ2VzdGlvbnMnLFxuICAgICAgICAgICAgbmFtZTogJ1RvZ2dsZSBMaXZlIFN1Z2dlc3Rpb25zJyxcbiAgICAgICAgICAgIGNhbGxiYWNrOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5zZXR0aW5ncy5lbmFibGVMaXZlU3VnZ2VzdGlvbnMgPSAhdGhpcy5zZXR0aW5ncy5lbmFibGVMaXZlU3VnZ2VzdGlvbnM7XG4gICAgICAgICAgICAgICAgdGhpcy5zYXZlU2V0dGluZ3MoKTtcbiAgICAgICAgICAgICAgICBuZXcgTm90aWNlKGBMaXZlIHN1Z2dlc3Rpb25zICR7dGhpcy5zZXR0aW5ncy5lbmFibGVMaXZlU3VnZ2VzdGlvbnMgPyAnZW5hYmxlZCcgOiAnZGlzYWJsZWQnfWApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICAvLyBBZGQgY29udGV4dCBtZW51IGl0ZW1zXG4gICAgICAgIHRoaXMucmVnaXN0ZXJFdmVudChcbiAgICAgICAgICAgIHRoaXMuYXBwLndvcmtzcGFjZS5vbignZWRpdG9yLW1lbnUnLCAobWVudTogTWVudSwgZWRpdG9yOiBFZGl0b3IpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBzZWxlY3RlZFRleHQgPSBlZGl0b3IuZ2V0U2VsZWN0aW9uKCk7XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgaWYgKHNlbGVjdGVkVGV4dCkge1xuICAgICAgICAgICAgICAgICAgICBtZW51LmFkZEl0ZW0oKGl0ZW0pID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuc2V0VGl0bGUoJ1x1RDgzRVx1RERFMCBFeHBsYWluICYgTGluaycpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLnNldEljb24oJ2JyYWluLWNpcmN1aXQnKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5vbkNsaWNrKGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5jb21tYW5kcy5leHBsYWluQW5kTGluayhlZGl0b3IsIHNlbGVjdGVkVGV4dCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgIG1lbnUuYWRkSXRlbSgoaXRlbSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgaXRlbVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5zZXRUaXRsZSgnXHVEODNDXHVERkI0IENyZWF0ZSBGbGFzaGNhcmRzJylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuc2V0SWNvbignY2FyZC1zdGFjaycpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLm9uQ2xpY2soYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLmNvbW1hbmRzLmNyZWF0ZUZsYXNoY2FyZHMoZWRpdG9yLCBzZWxlY3RlZFRleHQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBtZW51LmFkZEl0ZW0oKGl0ZW0pID0+IHtcbiAgICAgICAgICAgICAgICAgICAgaXRlbVxuICAgICAgICAgICAgICAgICAgICAgICAgLnNldFRpdGxlKCdcdUQ4M0RcdURDREQgU3VtbWFyaXplIE5vdGUnKVxuICAgICAgICAgICAgICAgICAgICAgICAgLnNldEljb24oJ2xpc3QtY2hlY2tzJylcbiAgICAgICAgICAgICAgICAgICAgICAgIC5vbkNsaWNrKGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjb250ZW50ID0gZWRpdG9yLmdldFZhbHVlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5jb21tYW5kcy5zdW1tYXJpemVOb3RlKGVkaXRvciwgY29udGVudCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAvLyBBZGQgY2hhdCBvcHRpb25cbiAgICAgICAgICAgICAgICBjb25zdCBmaWxlTmFtZSA9IHRoaXMuYXBwLndvcmtzcGFjZS5nZXRBY3RpdmVGaWxlKCk/LmJhc2VuYW1lIHx8ICcnO1xuICAgICAgICAgICAgICAgIGlmIChmaWxlTmFtZS5zdGFydHNXaXRoKCdDaGF0LScpKSB7XG4gICAgICAgICAgICAgICAgICAgIG1lbnUuYWRkSXRlbSgoaXRlbSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgaXRlbVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5zZXRUaXRsZSgnXHVEODNEXHVEQ0FDIFNlbmQgQ2hhdCBNZXNzYWdlJylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuc2V0SWNvbignbWVzc2FnZS1zcXVhcmUnKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5vbkNsaWNrKGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5jb21tYW5kcy5zZW5kQ2hhdE1lc3NhZ2UoZWRpdG9yKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgbWVudS5hZGRJdGVtKChpdGVtKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpdGVtXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLnNldFRpdGxlKCdcdUQ4M0RcdURDQUMgU3RhcnQgQ2hhdCBTZXNzaW9uJylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuc2V0SWNvbignbWVzc2FnZS1jaXJjbGUnKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5vbkNsaWNrKGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5jb21tYW5kcy5zdGFydENoYXRTZXNzaW9uKGVkaXRvcik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pXG4gICAgICAgICk7XG4gICAgICAgIFxuICAgICAgICAvLyBSZWdpc3RlciBlZGl0b3IgZXZlbnQgZm9yIGxpdmUgc3VnZ2VzdGlvbnNcbiAgICAgICAgdGhpcy5yZWdpc3RlckxpdmVTdWdnZXN0aW9uRXZlbnRzKCk7XG5cbiAgICAgICAgLy8gQ2hlY2sgT2xsYW1hIGF2YWlsYWJpbGl0eSBvbiBzdGFydHVwXG4gICAgICAgIHRoaXMuY2hlY2tPbGxhbWFDb25uZWN0aW9uKCk7XG5cbiAgICAgICAgY29uc29sZS5sb2coJ1N5bmFwc2UgcGx1Z2luIGxvYWRlZCcpO1xuICAgIH1cblxuICAgIG9udW5sb2FkKCkge1xuICAgICAgICBjb25zb2xlLmxvZygnU3luYXBzZSBwbHVnaW4gdW5sb2FkZWQnKTtcbiAgICB9XG5cbiAgICBhc3luYyBsb2FkU2V0dGluZ3MoKSB7XG4gICAgICAgIHRoaXMuc2V0dGluZ3MgPSBPYmplY3QuYXNzaWduKHt9LCBERUZBVUxUX1NFVFRJTkdTLCBhd2FpdCB0aGlzLmxvYWREYXRhKCkpO1xuICAgIH1cblxuICAgIGFzeW5jIHNhdmVTZXR0aW5ncygpIHtcbiAgICAgICAgYXdhaXQgdGhpcy5zYXZlRGF0YSh0aGlzLnNldHRpbmdzKTtcbiAgICAgICAgLy8gVXBkYXRlIGNvbW1hbmRzIHdpdGggbmV3IHNldHRpbmdzXG4gICAgICAgIHRoaXMuY29tbWFuZHMudXBkYXRlU2V0dGluZ3ModGhpcy5zZXR0aW5ncyk7XG4gICAgICAgIFxuICAgICAgICAvLyBSZS1pbml0aWFsaXplIGRlYm91bmNlZCBzdWdnZXN0aW9uIHdpdGggbmV3IGRlbGF5XG4gICAgICAgIHRoaXMuZGVib3VuY2VkU3VnZ2VzdGlvbiA9IGRlYm91bmNlKFxuICAgICAgICAgICAgKGVkaXRvcjogRWRpdG9yKSA9PiB0aGlzLmNvbW1hbmRzLmdlbmVyYXRlTGl2ZVN1Z2dlc3Rpb24oZWRpdG9yKSxcbiAgICAgICAgICAgIHRoaXMuc2V0dGluZ3Muc3VnZ2VzdGlvbkRlbGF5XG4gICAgICAgICk7XG4gICAgICAgIFxuICAgICAgICAvLyBVcGRhdGUgZXZlbnQgbGlzdGVuZXJzIGZvciBsaXZlIHN1Z2dlc3Rpb25zXG4gICAgICAgIHRoaXMucmVnaXN0ZXJMaXZlU3VnZ2VzdGlvbkV2ZW50cygpO1xuICAgIH1cblxuICAgIHByaXZhdGUgcmVnaXN0ZXJMaXZlU3VnZ2VzdGlvbkV2ZW50cygpIHtcbiAgICAgICAgLy8gVW5yZWdpc3RlciBleGlzdGluZyBldmVudCBpZiBuZWVkZWRcbiAgICAgICAgaWYgKHRoaXMubGl2ZVN1Z2dlc3Rpb25FdmVudCkge1xuICAgICAgICAgICAgdGhpcy5hcHAud29ya3NwYWNlLm9mZignZWRpdG9yLWNoYW5nZScsIHRoaXMubGl2ZVN1Z2dlc3Rpb25FdmVudCk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBPbmx5IHJlZ2lzdGVyIGlmIGZlYXR1cmUgaXMgZW5hYmxlZFxuICAgICAgICBpZiAodGhpcy5zZXR0aW5ncy5lbmFibGVMaXZlU3VnZ2VzdGlvbnMpIHtcbiAgICAgICAgICAgIHRoaXMubGl2ZVN1Z2dlc3Rpb25FdmVudCA9IHRoaXMuYXBwLndvcmtzcGFjZS5vbignZWRpdG9yLWNoYW5nZScsIChlZGl0b3I6IEVkaXRvcikgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuZGVib3VuY2VkU3VnZ2VzdGlvbihlZGl0b3IpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB0aGlzLnJlZ2lzdGVyRXZlbnQodGhpcy5saXZlU3VnZ2VzdGlvbkV2ZW50KTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgYXN5bmMgY2hlY2tPbGxhbWFDb25uZWN0aW9uKCkge1xuICAgICAgICBjb25zdCBpc0F2YWlsYWJsZSA9IGF3YWl0IHRoaXMub2xsYW1hLmlzQXZhaWxhYmxlKCk7XG4gICAgICAgIFxuICAgICAgICBpZiAoIWlzQXZhaWxhYmxlKSB7XG4gICAgICAgICAgICBuZXcgTm90aWNlKFxuICAgICAgICAgICAgICAgICdTeW5hcHNlOiBDYW5ub3QgY29ubmVjdCB0byBPbGxhbWEuIFBsZWFzZSBtYWtlIHN1cmUgT2xsYW1hIGlzIHJ1bm5pbmcgb24gJyArIFxuICAgICAgICAgICAgICAgIHRoaXMuc2V0dGluZ3Mub2xsYW1hVXJsLCBcbiAgICAgICAgICAgICAgICA4MDAwXG4gICAgICAgICAgICApO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgbmV3IE5vdGljZSgnU3luYXBzZTogQ29ubmVjdGVkIHRvIE9sbGFtYSBzdWNjZXNzZnVsbHknLCAzMDAwKTtcbiAgICAgICAgfVxuICAgIH1cbn0iLCAiZXhwb3J0IGludGVyZmFjZSBTeW5hcHNlU2V0dGluZ3Mge1xuICAgIG9sbGFtYVVybDogc3RyaW5nO1xuICAgIG9sbGFtYU1vZGVsOiBzdHJpbmc7XG4gICAgYXV0b0xpbmtFbmFibGVkOiBib29sZWFuO1xuICAgIHN1bW1hcnlMb2NhdGlvbjogJ3RvcCcgfCAnYm90dG9tJztcbiAgICBmbGFzaGNhcmRGb3JtYXQ6ICdzaW1wbGUnIHwgJ3NwYWNlZCc7XG4gICAgbWF4UmVzcG9uc2VMZW5ndGg6IG51bWJlcjtcbiAgICBleHBsYW5hdGlvbkZvbGRlcjogc3RyaW5nO1xuICAgIGZsYXNoY2FyZEZvbGRlcjogc3RyaW5nO1xuICAgIHVzZVN1bW1hcnlZYW1sOiBib29sZWFuO1xuICAgIGNoYXRGb2xkZXI6IHN0cmluZztcbiAgICBlbmFibGVMaXZlQ2hhdDogYm9vbGVhbjtcbiAgICBlbmFibGVMaXZlU3VnZ2VzdGlvbnM6IGJvb2xlYW47XG4gICAgc3VnZ2VzdGlvbkRlbGF5OiBudW1iZXI7XG4gICAgLy8gU2ltcGxpZmllZCBMaXZlIENvcGlsb3Qgc2V0dGluZ3NcbiAgICBzaG93R2hvc3RUZXh0OiBib29sZWFuO1xuICAgIGFsbG93UXVpY2tBY2NlcHQ6IGJvb2xlYW47XG4gICAgLy8gTmV3IHNldHRpbmdzXG4gICAgdGVtcGxhdGVQYXRoOiBzdHJpbmc7XG4gICAgdXNlVGVtcGxhdGVGb3JFeHBsYW5hdGlvbnM6IGJvb2xlYW47XG4gICAgZ2xvYmFsU3lzdGVtUHJvbXB0OiBzdHJpbmc7XG4gICAgY2hhdFN5c3RlbVByb21wdDogc3RyaW5nO1xuICAgIGV4cGxhbmF0aW9uU3lzdGVtUHJvbXB0OiBzdHJpbmc7XG4gICAgc3VtbWFyeVN5c3RlbVByb21wdDogc3RyaW5nO1xuICAgIGZsYXNoY2FyZFN5c3RlbVByb21wdDogc3RyaW5nO1xuICAgIGN1c3RvbVRlbXBsYXRlVmFyaWFibGVzOiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+O1xufVxuXG5leHBvcnQgY29uc3QgREVGQVVMVF9TRVRUSU5HUzogU3luYXBzZVNldHRpbmdzID0ge1xuICAgIG9sbGFtYVVybDogJ2h0dHA6Ly9sb2NhbGhvc3Q6MTE0MzQnLFxuICAgIG9sbGFtYU1vZGVsOiAnZ2VtbWEzbjplMmInLFxuICAgIGF1dG9MaW5rRW5hYmxlZDogdHJ1ZSxcbiAgICBzdW1tYXJ5TG9jYXRpb246ICd0b3AnLFxuICAgIGZsYXNoY2FyZEZvcm1hdDogJ3NpbXBsZScsXG4gICAgbWF4UmVzcG9uc2VMZW5ndGg6IDEwMDAsXG4gICAgZXhwbGFuYXRpb25Gb2xkZXI6ICdFeHBsYW5hdGlvbnMnLFxuICAgIGZsYXNoY2FyZEZvbGRlcjogJ0ZsYXNoY2FyZHMnLFxuICAgIHVzZVN1bW1hcnlZYW1sOiB0cnVlLFxuICAgIGNoYXRGb2xkZXI6ICdDaGF0cycsXG4gICAgZW5hYmxlTGl2ZUNoYXQ6IHRydWUsXG4gICAgZW5hYmxlTGl2ZVN1Z2dlc3Rpb25zOiBmYWxzZSxcbiAgICBzdWdnZXN0aW9uRGVsYXk6IDMwMDAsXG4gICAgLy8gU2ltcGxpZmllZCBzZXR0aW5ncyB3aXRoIGRlZmF1bHRzXG4gICAgc2hvd0dob3N0VGV4dDogdHJ1ZSxcbiAgICBhbGxvd1F1aWNrQWNjZXB0OiB0cnVlLFxuICAgIC8vIE5ldyBkZWZhdWx0IHNldHRpbmdzXG4gICAgdGVtcGxhdGVQYXRoOiAnJyxcbiAgICB1c2VUZW1wbGF0ZUZvckV4cGxhbmF0aW9uczogZmFsc2UsXG4gICAgZ2xvYmFsU3lzdGVtUHJvbXB0OiAnWW91IGFyZSBhIGhlbHBmdWwgZWR1Y2F0aW9uYWwgYXNzaXN0YW50IHByb3ZpZGluZyBjb25jaXNlLCBhY2N1cmF0ZSBpbmZvcm1hdGlvbi4nLFxuICAgIGNoYXRTeXN0ZW1Qcm9tcHQ6ICdZb3UgYXJlIGEgaGVscGZ1bCBBSSBhc3Npc3RhbnQgaW4gYSBjaGF0IHNlc3Npb24uIFByb3ZpZGUgdGhvdWdodGZ1bCwgY29uY2lzZSByZXNwb25zZXMgdG8gdGhlIHVzZXJcXCdzIHF1ZXN0aW9ucy4gVXNlIG1hcmtkb3duIGZvcm1hdHRpbmcgd2hlbiBhcHByb3ByaWF0ZS4gUmVmZXJlbmNlIHByaW9yIG1lc3NhZ2VzIGluIHRoZSBjb252ZXJzYXRpb24gd2hlbiByZWxldmFudC4nLFxuICAgIGV4cGxhbmF0aW9uU3lzdGVtUHJvbXB0OiAnWW91IGFyZSBhIGhlbHBmdWwgZWR1Y2F0aW9uYWwgYXNzaXN0YW50LiBDcmVhdGUgYSBjbGVhciwgY29uY2lzZSBleHBsYW5hdGlvbiBvZiB0aGUgZ2l2ZW4gY29uY2VwdC4gRm9ybWF0IHlvdXIgcmVzcG9uc2UgYXMgYSB3ZWxsLXN0cnVjdHVyZWQgbm90ZSB3aXRoOlxcbjEuIEEgYnJpZWYgZGVmaW5pdGlvblxcbjIuIEtleSBjaGFyYWN0ZXJpc3RpY3Mgb3IgcHJvcGVydGllc1xcbjMuIEEgc2ltcGxlIGFuYWxvZ3kgb3IgZXhhbXBsZSBpZiBoZWxwZnVsXFxuNC4gV2h5IHRoaXMgY29uY2VwdCBpcyBpbXBvcnRhbnRcXG5cXG5LZWVwIHRoZSBleHBsYW5hdGlvbiB1bmRlciB7e21heFJlc3BvbnNlTGVuZ3RofX0gY2hhcmFjdGVycyBhbmQgdXNlIGNsZWFyLCBlZHVjYXRpb25hbCBsYW5ndWFnZS4nLFxuICAgIHN1bW1hcnlTeXN0ZW1Qcm9tcHQ6ICdZb3UgYXJlIGEgaGVscGZ1bCBhc3Npc3RhbnQgdGhhdCBjcmVhdGVzIGNvbmNpc2Ugc3VtbWFyaWVzLiBDcmVhdGUgYSBidWxsZXQtcG9pbnQgc3VtbWFyeSAoMy01IHBvaW50cykgb2YgdGhlIG1haW4gaWRlYXMgaW4gdGhlIGdpdmVuIHRleHQuIEVhY2ggYnVsbGV0IHBvaW50IHNob3VsZCBiZSBjbGVhciBhbmQgY2FwdHVyZSBhIGtleSBjb25jZXB0LiBGb3JtYXQgYXMgbWFya2Rvd24gYnVsbGV0cyBzdGFydGluZyB3aXRoIFwiLSBcIi4nLFxuICAgIGZsYXNoY2FyZFN5c3RlbVByb21wdDogJ1lvdSBhcmUgYSBoZWxwZnVsIGFzc2lzdGFudCB0aGF0IGNyZWF0ZXMgc3R1ZHkgZmxhc2hjYXJkcy4gRnJvbSB0aGUgZ2l2ZW4gdGV4dCwgaWRlbnRpZnkgMy03IGtleSBjb25jZXB0cyBhbmQgY3JlYXRlIGZsYXNoY2FyZHMgaW4gdGhpcyBleGFjdCBmb3JtYXQ6XFxuXFxuKipROioqIFF1ZXN0aW9uIGhlcmU/XFxuKipBOioqIEFuc3dlciBoZXJlXFxuXFxuTWFrZSBxdWVzdGlvbnMgY2xlYXIgYW5kIHNwZWNpZmljLiBBbnN3ZXJzIHNob3VsZCBiZSBjb25jaXNlIGJ1dCBjb21wbGV0ZS4gRm9jdXMgb24gdGhlIG1vc3QgaW1wb3J0YW50IGNvbmNlcHRzIGZvciBsZWFybmluZyBhbmQgcmV0ZW50aW9uLicsXG4gICAgY3VzdG9tVGVtcGxhdGVWYXJpYWJsZXM6IHt9XG59O1xuIiwgImltcG9ydCB7IEFwcCwgUGx1Z2luU2V0dGluZ1RhYiwgU2V0dGluZywgVGV4dEFyZWFDb21wb25lbnQsIERyb3Bkb3duQ29tcG9uZW50LCBURmlsZSwgQnV0dG9uQ29tcG9uZW50IH0gZnJvbSAnb2JzaWRpYW4nO1xuaW1wb3J0IFN5bmFwc2VQbHVnaW4gZnJvbSAnLi4vbWFpbic7XG5pbXBvcnQgeyBPbGxhbWFDbGllbnQgfSBmcm9tICcuLi9vbGxhbWEnO1xuXG5leHBvcnQgY2xhc3MgU3luYXBzZVNldHRpbmdzVGFiIGV4dGVuZHMgUGx1Z2luU2V0dGluZ1RhYiB7XG4gICAgcGx1Z2luOiBTeW5hcHNlUGx1Z2luO1xuXG4gICAgY29uc3RydWN0b3IoYXBwOiBBcHAsIHBsdWdpbjogU3luYXBzZVBsdWdpbikge1xuICAgICAgICBzdXBlcihhcHAsIHBsdWdpbik7XG4gICAgICAgIHRoaXMucGx1Z2luID0gcGx1Z2luO1xuICAgIH1cblxuICAgIGRpc3BsYXkoKTogdm9pZCB7XG4gICAgICAgIGNvbnN0IHsgY29udGFpbmVyRWwgfSA9IHRoaXM7XG4gICAgICAgIGNvbnRhaW5lckVsLmVtcHR5KCk7XG4gICAgICAgIGNvbnRhaW5lckVsLmFkZENsYXNzKCdzeW5hcHNlLXNldHRpbmdzJyk7XG5cbiAgICAgICAgLy8gQ3JlYXRlIHRhYnMgZm9yIGJldHRlciBvcmdhbml6YXRpb25cbiAgICAgICAgY29uc3QgdGFiQ29udGFpbmVyID0gY29udGFpbmVyRWwuY3JlYXRlRGl2KCdzeW5hcHNlLXNldHRpbmdzLXRhYnMnKTtcbiAgICAgICAgY29uc3QgdGFiQ29udGVudCA9IGNvbnRhaW5lckVsLmNyZWF0ZURpdignc3luYXBzZS1zZXR0aW5ncy1jb250ZW50Jyk7XG4gICAgICAgIFxuICAgICAgICAvLyBDcmVhdGUgdGFiIGJ1dHRvbnNcbiAgICAgICAgY29uc3QgZ2VuZXJhbFRhYiA9IHRhYkNvbnRhaW5lci5jcmVhdGVEaXYoJ3N5bmFwc2UtdGFiJyk7XG4gICAgICAgIGdlbmVyYWxUYWIuc2V0VGV4dCgnR2VuZXJhbCcpO1xuICAgICAgICBnZW5lcmFsVGFiLmFkZENsYXNzKCdhY3RpdmUnKTtcbiAgICAgICAgXG4gICAgICAgIGNvbnN0IHByb21wdHNUYWIgPSB0YWJDb250YWluZXIuY3JlYXRlRGl2KCdzeW5hcHNlLXRhYicpO1xuICAgICAgICBwcm9tcHRzVGFiLnNldFRleHQoJ0FJIFByb21wdHMnKTtcbiAgICAgICAgXG4gICAgICAgIGNvbnN0IHRlbXBsYXRlc1RhYiA9IHRhYkNvbnRhaW5lci5jcmVhdGVEaXYoJ3N5bmFwc2UtdGFiJyk7XG4gICAgICAgIHRlbXBsYXRlc1RhYi5zZXRUZXh0KCdUZW1wbGF0ZXMnKTtcbiAgICAgICAgXG4gICAgICAgIGNvbnN0IGFkdmFuY2VkVGFiID0gdGFiQ29udGFpbmVyLmNyZWF0ZURpdignc3luYXBzZS10YWInKTtcbiAgICAgICAgYWR2YW5jZWRUYWIuc2V0VGV4dCgnQWR2YW5jZWQnKTtcbiAgICAgICAgXG4gICAgICAgIC8vIENyZWF0ZSBjb250ZW50IHNlY3Rpb25zXG4gICAgICAgIGNvbnN0IGdlbmVyYWxDb250ZW50ID0gdGFiQ29udGVudC5jcmVhdGVEaXYoJ3N5bmFwc2UtdGFiLWNvbnRlbnQnKTtcbiAgICAgICAgZ2VuZXJhbENvbnRlbnQuYWRkQ2xhc3MoJ2FjdGl2ZScpO1xuICAgICAgICBcbiAgICAgICAgY29uc3QgcHJvbXB0c0NvbnRlbnQgPSB0YWJDb250ZW50LmNyZWF0ZURpdignc3luYXBzZS10YWItY29udGVudCcpO1xuICAgICAgICBwcm9tcHRzQ29udGVudC5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xuICAgICAgICBcbiAgICAgICAgY29uc3QgdGVtcGxhdGVzQ29udGVudCA9IHRhYkNvbnRlbnQuY3JlYXRlRGl2KCdzeW5hcHNlLXRhYi1jb250ZW50Jyk7XG4gICAgICAgIHRlbXBsYXRlc0NvbnRlbnQuc3R5bGUuZGlzcGxheSA9ICdub25lJztcbiAgICAgICAgXG4gICAgICAgIGNvbnN0IGFkdmFuY2VkQ29udGVudCA9IHRhYkNvbnRlbnQuY3JlYXRlRGl2KCdzeW5hcHNlLXRhYi1jb250ZW50Jyk7XG4gICAgICAgIGFkdmFuY2VkQ29udGVudC5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xuICAgICAgICBcbiAgICAgICAgLy8gU2V0IHVwIHRhYiBzd2l0Y2hpbmdcbiAgICAgICAgY29uc3QgdGFicyA9IFtnZW5lcmFsVGFiLCBwcm9tcHRzVGFiLCB0ZW1wbGF0ZXNUYWIsIGFkdmFuY2VkVGFiXTtcbiAgICAgICAgY29uc3QgY29udGVudHMgPSBbZ2VuZXJhbENvbnRlbnQsIHByb21wdHNDb250ZW50LCB0ZW1wbGF0ZXNDb250ZW50LCBhZHZhbmNlZENvbnRlbnRdO1xuICAgICAgICBcbiAgICAgICAgdGFicy5mb3JFYWNoKCh0YWIsIGluZGV4KSA9PiB7XG4gICAgICAgICAgICB0YWIuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGFicy5mb3JFYWNoKHQgPT4gdC5yZW1vdmVDbGFzcygnYWN0aXZlJykpO1xuICAgICAgICAgICAgICAgIGNvbnRlbnRzLmZvckVhY2goYyA9PiBjLnN0eWxlLmRpc3BsYXkgPSAnbm9uZScpO1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIHRhYi5hZGRDbGFzcygnYWN0aXZlJyk7XG4gICAgICAgICAgICAgICAgY29udGVudHNbaW5kZXhdLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIEdFTkVSQUwgU0VUVElOR1NcbiAgICAgICAgZ2VuZXJhbENvbnRlbnQuY3JlYXRlRWwoJ2gyJywgeyB0ZXh0OiAnU3luYXBzZSBTZXR0aW5ncycgfSk7XG5cbiAgICAgICAgLy8gT2xsYW1hIENvbmZpZ3VyYXRpb25cbiAgICAgICAgZ2VuZXJhbENvbnRlbnQuY3JlYXRlRWwoJ2gzJywgeyB0ZXh0OiAnT2xsYW1hIENvbmZpZ3VyYXRpb24nIH0pO1xuXG4gICAgICAgIG5ldyBTZXR0aW5nKGdlbmVyYWxDb250ZW50KVxuICAgICAgICAgICAgLnNldE5hbWUoJ09sbGFtYSBVUkwnKVxuICAgICAgICAgICAgLnNldERlc2MoJ1VSTCB3aGVyZSBPbGxhbWEgaXMgcnVubmluZyAoZGVmYXVsdDogaHR0cDovL2xvY2FsaG9zdDoxMTQzNCknKVxuICAgICAgICAgICAgLmFkZFRleHQodGV4dCA9PiB0ZXh0XG4gICAgICAgICAgICAgICAgLnNldFBsYWNlaG9sZGVyKCdodHRwOi8vbG9jYWxob3N0OjExNDM0JylcbiAgICAgICAgICAgICAgICAuc2V0VmFsdWUodGhpcy5wbHVnaW4uc2V0dGluZ3Mub2xsYW1hVXJsKVxuICAgICAgICAgICAgICAgIC5vbkNoYW5nZShhc3luYyAodmFsdWUpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3Mub2xsYW1hVXJsID0gdmFsdWU7XG4gICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuICAgICAgICAgICAgICAgIH0pKTtcblxuICAgICAgICBuZXcgU2V0dGluZyhnZW5lcmFsQ29udGVudClcbiAgICAgICAgICAgIC5zZXROYW1lKCdNb2RlbCcpXG4gICAgICAgICAgICAuc2V0RGVzYygnT2xsYW1hIG1vZGVsIHRvIHVzZSAoZS5nLiwgcGhpMzptaW5pLCBsbGFtYTIsIG1pc3RyYWwpJylcbiAgICAgICAgICAgIC5hZGRUZXh0KHRleHQgPT4gdGV4dFxuICAgICAgICAgICAgICAgIC5zZXRQbGFjZWhvbGRlcigncGhpMzptaW5pJylcbiAgICAgICAgICAgICAgICAuc2V0VmFsdWUodGhpcy5wbHVnaW4uc2V0dGluZ3Mub2xsYW1hTW9kZWwpXG4gICAgICAgICAgICAgICAgLm9uQ2hhbmdlKGFzeW5jICh2YWx1ZSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5vbGxhbWFNb2RlbCA9IHZhbHVlO1xuICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcbiAgICAgICAgICAgICAgICB9KSk7XG5cbiAgICAgICAgLy8gQXZhaWxhYmxlIG1vZGVscyBkcm9wZG93blxuICAgICAgICBjb25zdCBtb2RlbENvbnRhaW5lciA9IGdlbmVyYWxDb250ZW50LmNyZWF0ZURpdignc3luYXBzZS1tb2RlbC1zZWxlY3RvcicpO1xuICAgICAgICBjb25zdCBtb2RlbFNldHRpbmcgPSBuZXcgU2V0dGluZyhtb2RlbENvbnRhaW5lcilcbiAgICAgICAgICAgIC5zZXROYW1lKCdTZWxlY3QgQXZhaWxhYmxlIE1vZGVsJylcbiAgICAgICAgICAgIC5zZXREZXNjKCdDaG9vc2UgZnJvbSBtb2RlbHMgYXZhaWxhYmxlIGluIHlvdXIgT2xsYW1hIGluc3RhbGxhdGlvbicpO1xuICAgICAgICBcbiAgICAgICAgbGV0IG1vZGVsRHJvcGRvd246IERyb3Bkb3duQ29tcG9uZW50O1xuICAgICAgICBtb2RlbFNldHRpbmcuYWRkRHJvcGRvd24oZHJvcGRvd24gPT4ge1xuICAgICAgICAgICAgbW9kZWxEcm9wZG93biA9IGRyb3Bkb3duO1xuICAgICAgICAgICAgZHJvcGRvd24uYWRkT3B0aW9uKCcnLCAnTG9hZGluZyBtb2RlbHMuLi4nKTtcbiAgICAgICAgICAgIGRyb3Bkb3duLnNldFZhbHVlKCcnKTtcbiAgICAgICAgICAgIGRyb3Bkb3duLm9uQ2hhbmdlKGFzeW5jICh2YWx1ZSkgPT4ge1xuICAgICAgICAgICAgICAgIGlmICh2YWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5vbGxhbWFNb2RlbCA9IHZhbHVlO1xuICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICAgIFxuICAgICAgICAvLyBMb2FkIGF2YWlsYWJsZSBtb2RlbHNcbiAgICAgICAgdGhpcy5sb2FkQXZhaWxhYmxlTW9kZWxzKG1vZGVsRHJvcGRvd24pO1xuXG4gICAgICAgIC8vIFRlc3QgY29ubmVjdGlvbiBidXR0b25cbiAgICAgICAgbmV3IFNldHRpbmcoZ2VuZXJhbENvbnRlbnQpXG4gICAgICAgICAgICAuc2V0TmFtZSgnVGVzdCBDb25uZWN0aW9uJylcbiAgICAgICAgICAgIC5zZXREZXNjKCdUZXN0IGNvbm5lY3Rpb24gdG8gT2xsYW1hJylcbiAgICAgICAgICAgIC5hZGRCdXR0b24oYnV0dG9uID0+IHtcbiAgICAgICAgICAgICAgICBidXR0b24uc2V0QnV0dG9uVGV4dCgnVGVzdCcpO1xuICAgICAgICAgICAgICAgIGJ1dHRvbi5zZXRDdGEoKTtcbiAgICAgICAgICAgICAgICAvLyBcdTRGRUVcdTU5MERcdUZGMUFcdTUyMDZcdTVGMDBcdThDMDNcdTc1MjhcdTY1QjlcdTZDRDVcdTgwMENcdTRFMERcdTY2MkZcdTk0RkVcdTVGMEZcdThDMDNcdTc1MjhcbiAgICAgICAgICAgICAgICBidXR0b24uYnV0dG9uRWwuYWRkQ2xhc3MoJ3N5bmFwc2UtdGVzdC1idXR0b24nKTtcbiAgICAgICAgICAgICAgICBidXR0b24ub25DbGljayhhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGNsaWVudCA9IG5ldyBPbGxhbWFDbGllbnQodGhpcy5wbHVnaW4uc2V0dGluZ3Mub2xsYW1hVXJsLCB0aGlzLnBsdWdpbi5zZXR0aW5ncy5vbGxhbWFNb2RlbCk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGlzQXZhaWxhYmxlID0gYXdhaXQgY2xpZW50LmlzQXZhaWxhYmxlKCk7XG4gICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICBpZiAoaXNBdmFpbGFibGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJ1dHRvbi5zZXRCdXR0b25UZXh0KCdcdTI3MTMgQ29ubmVjdGVkJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICBidXR0b24uYnV0dG9uRWwuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gJyM0Y2FmNTAnO1xuICAgICAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnV0dG9uLnNldEJ1dHRvblRleHQoJ1Rlc3QnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBidXR0b24uYnV0dG9uRWwuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gJyc7XG4gICAgICAgICAgICAgICAgICAgICAgICB9LCAyMDAwKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJ1dHRvbi5zZXRCdXR0b25UZXh0KCdcdTI3MTcgRmFpbGVkJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICBidXR0b24uYnV0dG9uRWwuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gJyNmNDQzMzYnO1xuICAgICAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnV0dG9uLnNldEJ1dHRvblRleHQoJ1Rlc3QnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBidXR0b24uYnV0dG9uRWwuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gJyc7XG4gICAgICAgICAgICAgICAgICAgICAgICB9LCAyMDAwKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gRmVhdHVyZSBTZXR0aW5nc1xuICAgICAgICBnZW5lcmFsQ29udGVudC5jcmVhdGVFbCgnaDMnLCB7IHRleHQ6ICdGZWF0dXJlIFNldHRpbmdzJyB9KTtcblxuICAgICAgICBuZXcgU2V0dGluZyhnZW5lcmFsQ29udGVudClcbiAgICAgICAgICAgIC5zZXROYW1lKCdBdXRvLWxpbmtpbmcnKVxuICAgICAgICAgICAgLnNldERlc2MoJ0F1dG9tYXRpY2FsbHkgY3JlYXRlIGxpbmtzIHdoZW4gdXNpbmcgXCJFeHBsYWluICYgTGlua1wiJylcbiAgICAgICAgICAgIC5hZGRUb2dnbGUodG9nZ2xlID0+IHRvZ2dsZVxuICAgICAgICAgICAgICAgIC5zZXRWYWx1ZSh0aGlzLnBsdWdpbi5zZXR0aW5ncy5hdXRvTGlua0VuYWJsZWQpXG4gICAgICAgICAgICAgICAgLm9uQ2hhbmdlKGFzeW5jICh2YWx1ZSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5hdXRvTGlua0VuYWJsZWQgPSB2YWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG4gICAgICAgICAgICAgICAgfSkpO1xuXG4gICAgICAgIG5ldyBTZXR0aW5nKGdlbmVyYWxDb250ZW50KVxuICAgICAgICAgICAgLnNldE5hbWUoJ1N1bW1hcnkgTG9jYXRpb24nKVxuICAgICAgICAgICAgLnNldERlc2MoJ1doZXJlIHRvIHBsYWNlIHN1bW1hcmllcyBpbiBub3RlcycpXG4gICAgICAgICAgICAuYWRkRHJvcGRvd24oZHJvcGRvd24gPT4gZHJvcGRvd25cbiAgICAgICAgICAgICAgICAuYWRkT3B0aW9uKCd0b3AnLCAnVG9wIG9mIG5vdGUnKVxuICAgICAgICAgICAgICAgIC5hZGRPcHRpb24oJ2JvdHRvbScsICdCb3R0b20gb2Ygbm90ZScpXG4gICAgICAgICAgICAgICAgLnNldFZhbHVlKHRoaXMucGx1Z2luLnNldHRpbmdzLnN1bW1hcnlMb2NhdGlvbilcbiAgICAgICAgICAgICAgICAub25DaGFuZ2UoYXN5bmMgKHZhbHVlOiAndG9wJyB8ICdib3R0b20nKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLnN1bW1hcnlMb2NhdGlvbiA9IHZhbHVlO1xuICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcbiAgICAgICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICAgICAgXG4gICAgICAgIG5ldyBTZXR0aW5nKGdlbmVyYWxDb250ZW50KVxuICAgICAgICAgICAgLnNldE5hbWUoJ1VzZSBZQU1MIGZvciBTdW1tYXJpZXMnKVxuICAgICAgICAgICAgLnNldERlc2MoJ0FkZCBzdW1tYXJpZXMgdG8gbm90ZSBmcm9udG1hdHRlciBhcyBZQU1MJylcbiAgICAgICAgICAgIC5hZGRUb2dnbGUodG9nZ2xlID0+IHRvZ2dsZVxuICAgICAgICAgICAgICAgIC5zZXRWYWx1ZSh0aGlzLnBsdWdpbi5zZXR0aW5ncy51c2VTdW1tYXJ5WWFtbClcbiAgICAgICAgICAgICAgICAub25DaGFuZ2UoYXN5bmMgKHZhbHVlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLnVzZVN1bW1hcnlZYW1sID0gdmFsdWU7XG4gICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuICAgICAgICAgICAgICAgIH0pKTtcblxuICAgICAgICBuZXcgU2V0dGluZyhnZW5lcmFsQ29udGVudClcbiAgICAgICAgICAgIC5zZXROYW1lKCdNYXggUmVzcG9uc2UgTGVuZ3RoJylcbiAgICAgICAgICAgIC5zZXREZXNjKCdNYXhpbXVtIGxlbmd0aCBmb3IgQUkgcmVzcG9uc2VzIChjaGFyYWN0ZXJzKScpXG4gICAgICAgICAgICAuYWRkU2xpZGVyKHNsaWRlciA9PiBzbGlkZXJcbiAgICAgICAgICAgICAgICAuc2V0TGltaXRzKDUwMCwgMzAwMCwgMTAwKVxuICAgICAgICAgICAgICAgIC5zZXRWYWx1ZSh0aGlzLnBsdWdpbi5zZXR0aW5ncy5tYXhSZXNwb25zZUxlbmd0aClcbiAgICAgICAgICAgICAgICAuc2V0RHluYW1pY1Rvb2x0aXAoKVxuICAgICAgICAgICAgICAgIC5vbkNoYW5nZShhc3luYyAodmFsdWUpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MubWF4UmVzcG9uc2VMZW5ndGggPSB2YWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG4gICAgICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAvLyBGb2xkZXIgb3JnYW5pemF0aW9uXG4gICAgICAgIGdlbmVyYWxDb250ZW50LmNyZWF0ZUVsKCdoMycsIHsgdGV4dDogJ0ZvbGRlciBPcmdhbml6YXRpb24nIH0pO1xuICAgICAgICBcbiAgICAgICAgbmV3IFNldHRpbmcoZ2VuZXJhbENvbnRlbnQpXG4gICAgICAgICAgICAuc2V0TmFtZSgnRXhwbGFuYXRpb25zIEZvbGRlcicpXG4gICAgICAgICAgICAuc2V0RGVzYygnRm9sZGVyIGZvciBleHBsYW5hdGlvbiBub3RlcyAoZW1wdHkgZm9yIHZhdWx0IHJvb3QpJylcbiAgICAgICAgICAgIC5hZGRUZXh0KHRleHQgPT4gdGV4dFxuICAgICAgICAgICAgICAgIC5zZXRQbGFjZWhvbGRlcignRXhwbGFuYXRpb25zJylcbiAgICAgICAgICAgICAgICAuc2V0VmFsdWUodGhpcy5wbHVnaW4uc2V0dGluZ3MuZXhwbGFuYXRpb25Gb2xkZXIpXG4gICAgICAgICAgICAgICAgLm9uQ2hhbmdlKGFzeW5jICh2YWx1ZSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5leHBsYW5hdGlvbkZvbGRlciA9IHZhbHVlO1xuICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcbiAgICAgICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICAgICAgXG4gICAgICAgIG5ldyBTZXR0aW5nKGdlbmVyYWxDb250ZW50KVxuICAgICAgICAgICAgLnNldE5hbWUoJ0ZsYXNoY2FyZHMgRm9sZGVyJylcbiAgICAgICAgICAgIC5zZXREZXNjKCdGb2xkZXIgZm9yIGZsYXNoY2FyZCBub3RlcyAoZW1wdHkgZm9yIHZhdWx0IHJvb3QpJylcbiAgICAgICAgICAgIC5hZGRUZXh0KHRleHQgPT4gdGV4dFxuICAgICAgICAgICAgICAgIC5zZXRQbGFjZWhvbGRlcignRmxhc2hjYXJkcycpXG4gICAgICAgICAgICAgICAgLnNldFZhbHVlKHRoaXMucGx1Z2luLnNldHRpbmdzLmZsYXNoY2FyZEZvbGRlcilcbiAgICAgICAgICAgICAgICAub25DaGFuZ2UoYXN5bmMgKHZhbHVlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmZsYXNoY2FyZEZvbGRlciA9IHZhbHVlO1xuICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcbiAgICAgICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICAgICAgXG4gICAgICAgIG5ldyBTZXR0aW5nKGdlbmVyYWxDb250ZW50KVxuICAgICAgICAgICAgLnNldE5hbWUoJ0NoYXQgRm9sZGVyJylcbiAgICAgICAgICAgIC5zZXREZXNjKCdGb2xkZXIgZm9yIGNoYXQgc2Vzc2lvbiBub3RlcyAoZW1wdHkgZm9yIHZhdWx0IHJvb3QpJylcbiAgICAgICAgICAgIC5hZGRUZXh0KHRleHQgPT4gdGV4dFxuICAgICAgICAgICAgICAgIC5zZXRQbGFjZWhvbGRlcignQ2hhdHMnKVxuICAgICAgICAgICAgICAgIC5zZXRWYWx1ZSh0aGlzLnBsdWdpbi5zZXR0aW5ncy5jaGF0Rm9sZGVyKVxuICAgICAgICAgICAgICAgIC5vbkNoYW5nZShhc3luYyAodmFsdWUpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MuY2hhdEZvbGRlciA9IHZhbHVlO1xuICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcbiAgICAgICAgICAgICAgICB9KSk7XG4gICAgICAgIFxuICAgICAgICAvLyBQUk9NUFRTIFNFVFRJTkdTXG4gICAgICAgIHByb21wdHNDb250ZW50LmNyZWF0ZUVsKCdoMicsIHsgdGV4dDogJ0FJIFByb21wdHMgQ29uZmlndXJhdGlvbicgfSk7XG4gICAgICAgIHByb21wdHNDb250ZW50LmNyZWF0ZUVsKCdwJywgeyBcbiAgICAgICAgICAgIHRleHQ6ICdDdXN0b21pemUgdGhlIHN5c3RlbSBwcm9tcHRzIHVzZWQgZm9yIGRpZmZlcmVudCBmZWF0dXJlcy4gWW91IGNhbiB1c2UgdmFyaWFibGVzIGxpa2Uge3ttYXhSZXNwb25zZUxlbmd0aH19LCB7e2RhdGV9fSwgYW5kIHt7bW9kZWx9fS4nXG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIEdsb2JhbCBzeXN0ZW0gcHJvbXB0XG4gICAgICAgIHByb21wdHNDb250ZW50LmNyZWF0ZUVsKCdoMycsIHsgdGV4dDogJ0dsb2JhbCBTeXN0ZW0gUHJvbXB0JyB9KTtcbiAgICAgICAgXG4gICAgICAgIGNvbnN0IGdsb2JhbFByb21wdFNldHRpbmcgPSBuZXcgU2V0dGluZyhwcm9tcHRzQ29udGVudClcbiAgICAgICAgICAgIC5zZXROYW1lKCdHbG9iYWwgU3lzdGVtIFByb21wdCcpXG4gICAgICAgICAgICAuc2V0RGVzYygnRGVmYXVsdCBzeXN0ZW0gcHJvbXB0IHVzZWQgd2hlbiBubyBzcGVjaWZpYyBwcm9tcHQgaXMgcHJvdmlkZWQnKTtcbiAgICAgICAgXG4gICAgICAgIGxldCBnbG9iYWxQcm9tcHRBcmVhOiBUZXh0QXJlYUNvbXBvbmVudDtcbiAgICAgICAgZ2xvYmFsUHJvbXB0U2V0dGluZy5hZGRUZXh0QXJlYSh0ZXh0YXJlYSA9PiB7XG4gICAgICAgICAgICBnbG9iYWxQcm9tcHRBcmVhID0gdGV4dGFyZWE7XG4gICAgICAgICAgICB0ZXh0YXJlYVxuICAgICAgICAgICAgICAgIC5zZXRWYWx1ZSh0aGlzLnBsdWdpbi5zZXR0aW5ncy5nbG9iYWxTeXN0ZW1Qcm9tcHQpXG4gICAgICAgICAgICAgICAgLnNldFBsYWNlaG9sZGVyKCdZb3UgYXJlIGEgaGVscGZ1bCBhc3Npc3RhbnQuLi4nKVxuICAgICAgICAgICAgICAgIC5vbkNoYW5nZShhc3luYyAodmFsdWUpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MuZ2xvYmFsU3lzdGVtUHJvbXB0ID0gdmFsdWU7XG4gICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICB0ZXh0YXJlYS5pbnB1dEVsLnJvd3MgPSA0O1xuICAgICAgICAgICAgdGV4dGFyZWEuaW5wdXRFbC5jb2xzID0gNTA7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIEV4cGxhbmF0aW9uIHN5c3RlbSBwcm9tcHRcbiAgICAgICAgcHJvbXB0c0NvbnRlbnQuY3JlYXRlRWwoJ2gzJywgeyB0ZXh0OiAnRXhwbGFuYXRpb24gUHJvbXB0JyB9KTtcbiAgICAgICAgXG4gICAgICAgIGNvbnN0IGV4cGxhbmF0aW9uUHJvbXB0U2V0dGluZyA9IG5ldyBTZXR0aW5nKHByb21wdHNDb250ZW50KVxuICAgICAgICAgICAgLnNldE5hbWUoJ0V4cGxhbmF0aW9uIFN5c3RlbSBQcm9tcHQnKVxuICAgICAgICAgICAgLnNldERlc2MoJ1N5c3RlbSBwcm9tcHQgdXNlZCBmb3IgZ2VuZXJhdGluZyBleHBsYW5hdGlvbnMnKTtcbiAgICAgICAgXG4gICAgICAgIGxldCBleHBsYW5hdGlvblByb21wdEFyZWE6IFRleHRBcmVhQ29tcG9uZW50O1xuICAgICAgICBleHBsYW5hdGlvblByb21wdFNldHRpbmcuYWRkVGV4dEFyZWEodGV4dGFyZWEgPT4ge1xuICAgICAgICAgICAgZXhwbGFuYXRpb25Qcm9tcHRBcmVhID0gdGV4dGFyZWE7XG4gICAgICAgICAgICB0ZXh0YXJlYVxuICAgICAgICAgICAgICAgIC5zZXRWYWx1ZSh0aGlzLnBsdWdpbi5zZXR0aW5ncy5leHBsYW5hdGlvblN5c3RlbVByb21wdClcbiAgICAgICAgICAgICAgICAuc2V0UGxhY2Vob2xkZXIoJ0NyZWF0ZSBhIGNsZWFyLCBjb25jaXNlIGV4cGxhbmF0aW9uLi4uJylcbiAgICAgICAgICAgICAgICAub25DaGFuZ2UoYXN5bmMgKHZhbHVlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmV4cGxhbmF0aW9uU3lzdGVtUHJvbXB0ID0gdmFsdWU7XG4gICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICB0ZXh0YXJlYS5pbnB1dEVsLnJvd3MgPSA2O1xuICAgICAgICAgICAgdGV4dGFyZWEuaW5wdXRFbC5jb2xzID0gNTA7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIFN1bW1hcnkgc3lzdGVtIHByb21wdFxuICAgICAgICBwcm9tcHRzQ29udGVudC5jcmVhdGVFbCgnaDMnLCB7IHRleHQ6ICdTdW1tYXJ5IFByb21wdCcgfSk7XG4gICAgICAgIFxuICAgICAgICBjb25zdCBzdW1tYXJ5UHJvbXB0U2V0dGluZyA9IG5ldyBTZXR0aW5nKHByb21wdHNDb250ZW50KVxuICAgICAgICAgICAgLnNldE5hbWUoJ1N1bW1hcnkgU3lzdGVtIFByb21wdCcpXG4gICAgICAgICAgICAuc2V0RGVzYygnU3lzdGVtIHByb21wdCB1c2VkIGZvciBnZW5lcmF0aW5nIHN1bW1hcmllcycpO1xuICAgICAgICBcbiAgICAgICAgbGV0IHN1bW1hcnlQcm9tcHRBcmVhOiBUZXh0QXJlYUNvbXBvbmVudDtcbiAgICAgICAgc3VtbWFyeVByb21wdFNldHRpbmcuYWRkVGV4dEFyZWEodGV4dGFyZWEgPT4ge1xuICAgICAgICAgICAgc3VtbWFyeVByb21wdEFyZWEgPSB0ZXh0YXJlYTtcbiAgICAgICAgICAgIHRleHRhcmVhXG4gICAgICAgICAgICAgICAgLnNldFZhbHVlKHRoaXMucGx1Z2luLnNldHRpbmdzLnN1bW1hcnlTeXN0ZW1Qcm9tcHQpXG4gICAgICAgICAgICAgICAgLnNldFBsYWNlaG9sZGVyKCdDcmVhdGUgYSBidWxsZXQtcG9pbnQgc3VtbWFyeS4uLicpXG4gICAgICAgICAgICAgICAgLm9uQ2hhbmdlKGFzeW5jICh2YWx1ZSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5zdW1tYXJ5U3lzdGVtUHJvbXB0ID0gdmFsdWU7XG4gICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICB0ZXh0YXJlYS5pbnB1dEVsLnJvd3MgPSA0O1xuICAgICAgICAgICAgdGV4dGFyZWEuaW5wdXRFbC5jb2xzID0gNTA7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIEZsYXNoY2FyZCBzeXN0ZW0gcHJvbXB0XG4gICAgICAgIHByb21wdHNDb250ZW50LmNyZWF0ZUVsKCdoMycsIHsgdGV4dDogJ0ZsYXNoY2FyZCBQcm9tcHQnIH0pO1xuICAgICAgICBcbiAgICAgICAgY29uc3QgZmxhc2hjYXJkUHJvbXB0U2V0dGluZyA9IG5ldyBTZXR0aW5nKHByb21wdHNDb250ZW50KVxuICAgICAgICAgICAgLnNldE5hbWUoJ0ZsYXNoY2FyZCBTeXN0ZW0gUHJvbXB0JylcbiAgICAgICAgICAgIC5zZXREZXNjKCdTeXN0ZW0gcHJvbXB0IHVzZWQgZm9yIGdlbmVyYXRpbmcgZmxhc2hjYXJkcycpO1xuICAgICAgICBcbiAgICAgICAgbGV0IGZsYXNoY2FyZFByb21wdEFyZWE6IFRleHRBcmVhQ29tcG9uZW50O1xuICAgICAgICBmbGFzaGNhcmRQcm9tcHRTZXR0aW5nLmFkZFRleHRBcmVhKHRleHRhcmVhID0+IHtcbiAgICAgICAgICAgIGZsYXNoY2FyZFByb21wdEFyZWEgPSB0ZXh0YXJlYTtcbiAgICAgICAgICAgIHRleHRhcmVhXG4gICAgICAgICAgICAgICAgLnNldFZhbHVlKHRoaXMucGx1Z2luLnNldHRpbmdzLmZsYXNoY2FyZFN5c3RlbVByb21wdClcbiAgICAgICAgICAgICAgICAuc2V0UGxhY2Vob2xkZXIoJ0NyZWF0ZSBmbGFzaGNhcmRzIGluIHRoaXMgZm9ybWF0Li4uJylcbiAgICAgICAgICAgICAgICAub25DaGFuZ2UoYXN5bmMgKHZhbHVlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmZsYXNoY2FyZFN5c3RlbVByb21wdCA9IHZhbHVlO1xuICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgdGV4dGFyZWEuaW5wdXRFbC5yb3dzID0gNjtcbiAgICAgICAgICAgIHRleHRhcmVhLmlucHV0RWwuY29scyA9IDUwO1xuICAgICAgICB9KTtcblxuICAgICAgICAvLyBDaGF0IHN5c3RlbSBwcm9tcHRcbiAgICAgICAgcHJvbXB0c0NvbnRlbnQuY3JlYXRlRWwoJ2gzJywgeyB0ZXh0OiAnQ2hhdCBQcm9tcHQnIH0pO1xuICAgICAgICBcbiAgICAgICAgY29uc3QgY2hhdFByb21wdFNldHRpbmcgPSBuZXcgU2V0dGluZyhwcm9tcHRzQ29udGVudClcbiAgICAgICAgICAgIC5zZXROYW1lKCdDaGF0IFN5c3RlbSBQcm9tcHQnKVxuICAgICAgICAgICAgLnNldERlc2MoJ1N5c3RlbSBwcm9tcHQgdXNlZCBmb3IgY2hhdCBzZXNzaW9ucycpO1xuICAgICAgICBcbiAgICAgICAgbGV0IGNoYXRQcm9tcHRBcmVhOiBUZXh0QXJlYUNvbXBvbmVudDtcbiAgICAgICAgY2hhdFByb21wdFNldHRpbmcuYWRkVGV4dEFyZWEodGV4dGFyZWEgPT4ge1xuICAgICAgICAgICAgY2hhdFByb21wdEFyZWEgPSB0ZXh0YXJlYTtcbiAgICAgICAgICAgIHRleHRhcmVhXG4gICAgICAgICAgICAgICAgLnNldFZhbHVlKHRoaXMucGx1Z2luLnNldHRpbmdzLmNoYXRTeXN0ZW1Qcm9tcHQpXG4gICAgICAgICAgICAgICAgLnNldFBsYWNlaG9sZGVyKCdZb3UgYXJlIGEgaGVscGZ1bCBBSSBhc3Npc3RhbnQuLi4nKVxuICAgICAgICAgICAgICAgIC5vbkNoYW5nZShhc3luYyAodmFsdWUpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MuY2hhdFN5c3RlbVByb21wdCA9IHZhbHVlO1xuICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgdGV4dGFyZWEuaW5wdXRFbC5yb3dzID0gNDtcbiAgICAgICAgICAgIHRleHRhcmVhLmlucHV0RWwuY29scyA9IDUwO1xuICAgICAgICB9KTtcblxuICAgICAgICAvLyBSZXNldCBwcm9tcHRzIGJ1dHRvblxuICAgICAgICBuZXcgU2V0dGluZyhwcm9tcHRzQ29udGVudClcbiAgICAgICAgICAgIC5zZXROYW1lKCdSZXNldCBQcm9tcHRzJylcbiAgICAgICAgICAgIC5zZXREZXNjKCdSZXNldCBhbGwgcHJvbXB0cyB0byBkZWZhdWx0IHZhbHVlcycpXG4gICAgICAgICAgICAuYWRkQnV0dG9uKGJ1dHRvbiA9PiB7XG4gICAgICAgICAgICAgICAgYnV0dG9uLnNldEJ1dHRvblRleHQoJ1Jlc2V0IHRvIERlZmF1bHRzJyk7XG4gICAgICAgICAgICAgICAgLy8gXHU0RkVFXHU1OTBEXHVGRjFBXHU0RTBEXHU4OTgxXHU5NEZFXHU1RjBGXHU4QzAzXHU3NTI4XG4gICAgICAgICAgICAgICAgYnV0dG9uLm9uQ2xpY2soYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAvLyBDb25maXJtIGJlZm9yZSByZXNldHRpbmdcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNvbmZpcm0oJ0FyZSB5b3Ugc3VyZSB5b3Ugd2FudCB0byByZXNldCBhbGwgcHJvbXB0cyB0byBkZWZhdWx0IHZhbHVlcz8nKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MuZ2xvYmFsU3lzdGVtUHJvbXB0ID0gdGhpcy5wbHVnaW4uREVGQVVMVF9TRVRUSU5HUy5nbG9iYWxTeXN0ZW1Qcm9tcHQ7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5leHBsYW5hdGlvblN5c3RlbVByb21wdCA9IHRoaXMucGx1Z2luLkRFRkFVTFRfU0VUVElOR1MuZXhwbGFuYXRpb25TeXN0ZW1Qcm9tcHQ7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5zdW1tYXJ5U3lzdGVtUHJvbXB0ID0gdGhpcy5wbHVnaW4uREVGQVVMVF9TRVRUSU5HUy5zdW1tYXJ5U3lzdGVtUHJvbXB0O1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MuZmxhc2hjYXJkU3lzdGVtUHJvbXB0ID0gdGhpcy5wbHVnaW4uREVGQVVMVF9TRVRUSU5HUy5mbGFzaGNhcmRTeXN0ZW1Qcm9tcHQ7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5jaGF0U3lzdGVtUHJvbXB0ID0gdGhpcy5wbHVnaW4uREVGQVVMVF9TRVRUSU5HUy5jaGF0U3lzdGVtUHJvbXB0O1xuICAgICAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBVcGRhdGUgdGV4dCBhcmVhc1xuICAgICAgICAgICAgICAgICAgICAgICAgZ2xvYmFsUHJvbXB0QXJlYS5zZXRWYWx1ZSh0aGlzLnBsdWdpbi5zZXR0aW5ncy5nbG9iYWxTeXN0ZW1Qcm9tcHQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgZXhwbGFuYXRpb25Qcm9tcHRBcmVhLnNldFZhbHVlKHRoaXMucGx1Z2luLnNldHRpbmdzLmV4cGxhbmF0aW9uU3lzdGVtUHJvbXB0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN1bW1hcnlQcm9tcHRBcmVhLnNldFZhbHVlKHRoaXMucGx1Z2luLnNldHRpbmdzLnN1bW1hcnlTeXN0ZW1Qcm9tcHQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgZmxhc2hjYXJkUHJvbXB0QXJlYS5zZXRWYWx1ZSh0aGlzLnBsdWdpbi5zZXR0aW5ncy5mbGFzaGNhcmRTeXN0ZW1Qcm9tcHQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2hhdFByb21wdEFyZWEuc2V0VmFsdWUodGhpcy5wbHVnaW4uc2V0dGluZ3MuY2hhdFN5c3RlbVByb21wdCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuICAgICAgICAgICAgICAgICAgICAgICAgbmV3IE5vdGljZSgnQWxsIHByb21wdHMgcmVzZXQgdG8gZGVmYXVsdHMnKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gVEVNUExBVEVTIFNFVFRJTkdTXG4gICAgICAgIHRlbXBsYXRlc0NvbnRlbnQuY3JlYXRlRWwoJ2gyJywgeyB0ZXh0OiAnVGVtcGxhdGVzIENvbmZpZ3VyYXRpb24nIH0pO1xuICAgICAgICB0ZW1wbGF0ZXNDb250ZW50LmNyZWF0ZUVsKCdwJywgeyBcbiAgICAgICAgICAgIHRleHQ6ICdDb25maWd1cmUgdGVtcGxhdGVzIGZvciBnZW5lcmF0ZWQgbm90ZXMuIFRlbXBsYXRlcyBzdXBwb3J0IHZhcmlhYmxlcyBsaWtlIHt7dGl0bGV9fSwge3tjb250ZW50fX0sIHt7ZGF0ZX19LCBhbmQgY3VzdG9tIHZhcmlhYmxlcy4nXG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIFRlbXBsYXRlIGZpbGUgc2VsZWN0b3JcbiAgICAgICAgbmV3IFNldHRpbmcodGVtcGxhdGVzQ29udGVudClcbiAgICAgICAgICAgIC5zZXROYW1lKCdUZW1wbGF0ZSBGaWxlJylcbiAgICAgICAgICAgIC5zZXREZXNjKCdTZWxlY3QgYSB0ZW1wbGF0ZSBmaWxlIGZvciBleHBsYW5hdGlvbiBub3RlcycpXG4gICAgICAgICAgICAuYWRkVGV4dCh0ZXh0ID0+IHRleHRcbiAgICAgICAgICAgICAgICAuc2V0UGxhY2Vob2xkZXIoJ3BhdGgvdG8vdGVtcGxhdGUubWQnKVxuICAgICAgICAgICAgICAgIC5zZXRWYWx1ZSh0aGlzLnBsdWdpbi5zZXR0aW5ncy50ZW1wbGF0ZVBhdGgpXG4gICAgICAgICAgICAgICAgLm9uQ2hhbmdlKGFzeW5jICh2YWx1ZSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy50ZW1wbGF0ZVBhdGggPSB2YWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG4gICAgICAgICAgICAgICAgfSkpXG4gICAgICAgICAgICAuYWRkQnV0dG9uKChidXR0b246IEJ1dHRvbkNvbXBvbmVudCkgPT4ge1xuICAgICAgICAgICAgICAgIGJ1dHRvbi5zZXRCdXR0b25UZXh0KCdCcm93c2UnKTtcbiAgICAgICAgICAgICAgICAvLyBcdTRGRUVcdTU5MERcdUZGMUFcdTRFMERcdTg5ODFcdTk0RkVcdTVGMEZcdThDMDNcdTc1MjhcbiAgICAgICAgICAgICAgICBidXR0b24ub25DbGljayhhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG1vZGFsID0gdGhpcy5jcmVhdGVGaWxlU2VsZWN0aW9uTW9kYWwoKGZpbGUpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmaWxlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MudGVtcGxhdGVQYXRoID0gZmlsZS5wYXRoO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHRleHRJbnB1dCA9IGJ1dHRvbi5idXR0b25FbC5wYXJlbnRFbGVtZW50Py5xdWVyeVNlbGVjdG9yKCdpbnB1dCcpIGFzIEhUTUxJbnB1dEVsZW1lbnQ7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRleHRJbnB1dCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZXh0SW5wdXQudmFsdWUgPSBmaWxlLnBhdGg7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgbW9kYWwub3BlbigpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gRW5hYmxlIHRlbXBsYXRlIHVzYWdlXG4gICAgICAgIG5ldyBTZXR0aW5nKHRlbXBsYXRlc0NvbnRlbnQpXG4gICAgICAgICAgICAuc2V0TmFtZSgnVXNlIFRlbXBsYXRlIGZvciBFeHBsYW5hdGlvbnMnKVxuICAgICAgICAgICAgLnNldERlc2MoJ1VzZSB0aGUgc2VsZWN0ZWQgdGVtcGxhdGUgZmlsZSBmb3IgZXhwbGFuYXRpb24gbm90ZXMnKVxuICAgICAgICAgICAgLmFkZFRvZ2dsZSh0b2dnbGUgPT4gdG9nZ2xlXG4gICAgICAgICAgICAgICAgLnNldFZhbHVlKHRoaXMucGx1Z2luLnNldHRpbmdzLnVzZVRlbXBsYXRlRm9yRXhwbGFuYXRpb25zKVxuICAgICAgICAgICAgICAgIC5vbkNoYW5nZShhc3luYyAodmFsdWUpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MudXNlVGVtcGxhdGVGb3JFeHBsYW5hdGlvbnMgPSB2YWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG4gICAgICAgICAgICAgICAgfSkpO1xuXG4gICAgICAgIC8vIFRlbXBsYXRlIHByZXZpZXdcbiAgICAgICAgdGVtcGxhdGVzQ29udGVudC5jcmVhdGVFbCgnaDMnLCB7IHRleHQ6ICdUZW1wbGF0ZSBWYXJpYWJsZXMnIH0pO1xuICAgICAgICBcbiAgICAgICAgdGVtcGxhdGVzQ29udGVudC5jcmVhdGVFbCgncCcsIHsgXG4gICAgICAgICAgICB0ZXh0OiAnQnVpbHQtaW4gdmFyaWFibGVzOiB7e3RpdGxlfX0gLSBub3RlIHRpdGxlLCB7e2NvbnRlbnR9fSAtIEFJIGdlbmVyYXRlZCBjb250ZW50LCB7e2RhdGV9fSAtIGN1cnJlbnQgZGF0ZSwge3txdWVyeX19IC0gb3JpZ2luYWwgc2VsZWN0ZWQgdGV4dCcgXG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIEN1c3RvbSB0ZW1wbGF0ZSB2YXJpYWJsZXNcbiAgICAgICAgdGVtcGxhdGVzQ29udGVudC5jcmVhdGVFbCgnaDMnLCB7IHRleHQ6ICdDdXN0b20gVGVtcGxhdGUgVmFyaWFibGVzJyB9KTtcbiAgICAgICAgXG4gICAgICAgIC8vIENvbnRhaW5lciBmb3IgY3VzdG9tIHZhcmlhYmxlc1xuICAgICAgICBjb25zdCBjdXN0b21WYXJzQ29udGFpbmVyID0gdGVtcGxhdGVzQ29udGVudC5jcmVhdGVEaXYoJ3N5bmFwc2UtY3VzdG9tLXZhcnMnKTtcbiAgICAgICAgXG4gICAgICAgIC8vIEZ1bmN0aW9uIHRvIHJlZnJlc2ggY3VzdG9tIHZhcmlhYmxlcyBkaXNwbGF5XG4gICAgICAgIGNvbnN0IHJlZnJlc2hDdXN0b21WYXJpYWJsZXMgPSAoKSA9PiB7XG4gICAgICAgICAgICBjdXN0b21WYXJzQ29udGFpbmVyLmVtcHR5KCk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vIEFkZCBleGlzdGluZyB2YXJpYWJsZXNcbiAgICAgICAgICAgIGZvciAoY29uc3QgW2tleSwgdmFsdWVdIG9mIE9iamVjdC5lbnRyaWVzKHRoaXMucGx1Z2luLnNldHRpbmdzLmN1c3RvbVRlbXBsYXRlVmFyaWFibGVzKSkge1xuICAgICAgICAgICAgICAgIHRoaXMuYWRkQ3VzdG9tVmFyaWFibGVSb3coY3VzdG9tVmFyc0NvbnRhaW5lciwga2V5LCB2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vIEFkZCBidXR0b24gdG8gYWRkIG5ldyB2YXJpYWJsZVxuICAgICAgICAgICAgY29uc3QgYWRkVmFyQnV0dG9uID0gY3VzdG9tVmFyc0NvbnRhaW5lci5jcmVhdGVFbCgnYnV0dG9uJywge1xuICAgICAgICAgICAgICAgIHRleHQ6ICdBZGQgQ3VzdG9tIFZhcmlhYmxlJyxcbiAgICAgICAgICAgICAgICBjbHM6ICdzeW5hcHNlLWFkZC12YXItYnV0dG9uJ1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGFkZFZhckJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBuZXdLZXkgPSBgdmFyaWFibGUke09iamVjdC5rZXlzKHRoaXMucGx1Z2luLnNldHRpbmdzLmN1c3RvbVRlbXBsYXRlVmFyaWFibGVzKS5sZW5ndGggKyAxfWA7XG4gICAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MuY3VzdG9tVGVtcGxhdGVWYXJpYWJsZXNbbmV3S2V5XSA9ICcnO1xuICAgICAgICAgICAgICAgIHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuICAgICAgICAgICAgICAgIHJlZnJlc2hDdXN0b21WYXJpYWJsZXMoKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuICAgICAgICBcbiAgICAgICAgLy8gSW5pdGlhbCBkaXNwbGF5IG9mIGN1c3RvbSB2YXJpYWJsZXNcbiAgICAgICAgcmVmcmVzaEN1c3RvbVZhcmlhYmxlcygpO1xuXG4gICAgICAgIC8vIEFEVkFOQ0VEIFNFVFRJTkdTXG4gICAgICAgIGFkdmFuY2VkQ29udGVudC5jcmVhdGVFbCgnaDInLCB7IHRleHQ6ICdBZHZhbmNlZCBTZXR0aW5ncycgfSk7XG5cbiAgICAgICAgLy8gTGl2ZSBmZWF0dXJlc1xuICAgICAgICBhZHZhbmNlZENvbnRlbnQuY3JlYXRlRWwoJ2gzJywgeyB0ZXh0OiAnTGl2ZSBGZWF0dXJlcycgfSk7XG5cbiAgICAgICAgbmV3IFNldHRpbmcoYWR2YW5jZWRDb250ZW50KVxuICAgICAgICAgICAgLnNldE5hbWUoJ0VuYWJsZSBMaXZlIENoYXQnKVxuICAgICAgICAgICAgLnNldERlc2MoJ0VuYWJsZSBpbnRlcmFjdGl2ZSBjaGF0IHNlc3Npb25zIGluIG5vdGVzJylcbiAgICAgICAgICAgIC5hZGRUb2dnbGUodG9nZ2xlID0+IHRvZ2dsZVxuICAgICAgICAgICAgICAgIC5zZXRWYWx1ZSh0aGlzLnBsdWdpbi5zZXR0aW5ncy5lbmFibGVMaXZlQ2hhdClcbiAgICAgICAgICAgICAgICAub25DaGFuZ2UoYXN5bmMgKHZhbHVlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmVuYWJsZUxpdmVDaGF0ID0gdmFsdWU7XG4gICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuICAgICAgICAgICAgICAgIH0pKTtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgbmV3IFNldHRpbmcoYWR2YW5jZWRDb250ZW50KVxuICAgICAgICAgICAgLnNldE5hbWUoJ0VuYWJsZSBMaXZlIFN1Z2dlc3Rpb25zJylcbiAgICAgICAgICAgIC5zZXREZXNjKCdQcm92aWRlIHN1Z2dlc3Rpb25zIGFzIHlvdSB0eXBlIChleHBlcmltZW50YWwpJylcbiAgICAgICAgICAgIC5hZGRUb2dnbGUodG9nZ2xlID0+IHRvZ2dsZVxuICAgICAgICAgICAgICAgIC5zZXRWYWx1ZSh0aGlzLnBsdWdpbi5zZXR0aW5ncy5lbmFibGVMaXZlU3VnZ2VzdGlvbnMpXG4gICAgICAgICAgICAgICAgLm9uQ2hhbmdlKGFzeW5jICh2YWx1ZSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5lbmFibGVMaXZlU3VnZ2VzdGlvbnMgPSB2YWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG4gICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAvLyBVcGRhdGUgdmlzaWJpbGl0eSBvZiByZWxhdGVkIHNldHRpbmdzXG4gICAgICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlTGl2ZUZlYXR1cmVTZXR0aW5nc1Zpc2liaWxpdHkoKTtcbiAgICAgICAgICAgICAgICB9KSk7XG5cbiAgICAgICAgLy8gQWRkIHNpbXBsaWZpZWQgTGl2ZSBDb3BpbG90IHNldHRpbmdzXG4gICAgICAgIGNvbnN0IGxpdmVTdWdnZXN0aW9uc0NvbnRhaW5lciA9IGFkdmFuY2VkQ29udGVudC5jcmVhdGVEaXYoJ3N5bmFwc2UtbGl2ZS1zZXR0aW5ncycpO1xuICAgICAgICAgICAgICAgIFxuICAgICAgICBuZXcgU2V0dGluZyhsaXZlU3VnZ2VzdGlvbnNDb250YWluZXIpXG4gICAgICAgICAgICAuc2V0TmFtZSgnU2hvdyBHaG9zdCBUZXh0JylcbiAgICAgICAgICAgIC5zZXREZXNjKCdTaG93IHN1Z2dlc3RlZCB0ZXh0IGNvbXBsZXRpb25zIGFzIHlvdSB0eXBlJylcbiAgICAgICAgICAgIC5hZGRUb2dnbGUodG9nZ2xlID0+IHRvZ2dsZVxuICAgICAgICAgICAgICAgIC5zZXRWYWx1ZSh0aGlzLnBsdWdpbi5zZXR0aW5ncy5zaG93R2hvc3RUZXh0KVxuICAgICAgICAgICAgICAgIC5vbkNoYW5nZShhc3luYyAodmFsdWUpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3Muc2hvd0dob3N0VGV4dCA9IHZhbHVlO1xuICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcbiAgICAgICAgICAgICAgICB9KSlcbiAgICAgICAgICAgIC5zZXREaXNhYmxlZCghdGhpcy5wbHVnaW4uc2V0dGluZ3MuZW5hYmxlTGl2ZVN1Z2dlc3Rpb25zKTtcblxuICAgICAgICBuZXcgU2V0dGluZyhsaXZlU3VnZ2VzdGlvbnNDb250YWluZXIpXG4gICAgICAgICAgICAuc2V0TmFtZSgnQWxsb3cgUXVpY2sgQWNjZXB0JylcbiAgICAgICAgICAgIC5zZXREZXNjKCdTaG93IGFjY2VwdCBidXR0b24gZm9yIHN1Z2dlc3Rpb25zJylcbiAgICAgICAgICAgIC5hZGRUb2dnbGUodG9nZ2xlID0+IHRvZ2dsZVxuICAgICAgICAgICAgICAgIC5zZXRWYWx1ZSh0aGlzLnBsdWdpbi5zZXR0aW5ncy5hbGxvd1F1aWNrQWNjZXB0KVxuICAgICAgICAgICAgICAgIC5vbkNoYW5nZShhc3luYyAodmFsdWUpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MuYWxsb3dRdWlja0FjY2VwdCA9IHZhbHVlO1xuICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcbiAgICAgICAgICAgICAgICB9KSlcbiAgICAgICAgICAgIC5zZXREaXNhYmxlZCghdGhpcy5wbHVnaW4uc2V0dGluZ3MuZW5hYmxlTGl2ZVN1Z2dlc3Rpb25zKTtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgbmV3IFNldHRpbmcobGl2ZVN1Z2dlc3Rpb25zQ29udGFpbmVyKVxuICAgICAgICAgICAgLnNldE5hbWUoJ1N1Z2dlc3Rpb24gRGVsYXknKVxuICAgICAgICAgICAgLnNldERlc2MoJ0RlbGF5IGJlZm9yZSBzaG93aW5nIHN1Z2dlc3Rpb25zIChtaWxsaXNlY29uZHMpJylcbiAgICAgICAgICAgIC5hZGRTbGlkZXIoc2xpZGVyID0+IHNsaWRlclxuICAgICAgICAgICAgICAgIC5zZXRMaW1pdHMoNTAwLCA1MDAwLCAxMDApXG4gICAgICAgICAgICAgICAgLnNldFZhbHVlKHRoaXMucGx1Z2luLnNldHRpbmdzLnN1Z2dlc3Rpb25EZWxheSlcbiAgICAgICAgICAgICAgICAuc2V0RHluYW1pY1Rvb2x0aXAoKVxuICAgICAgICAgICAgICAgIC5vbkNoYW5nZShhc3luYyAodmFsdWUpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3Muc3VnZ2VzdGlvbkRlbGF5ID0gdmFsdWU7XG4gICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuICAgICAgICAgICAgICAgIH0pKVxuICAgICAgICAgICAgLnNldERpc2FibGVkKCF0aGlzLnBsdWdpbi5zZXR0aW5ncy5lbmFibGVMaXZlU3VnZ2VzdGlvbnMpO1xuXG4gICAgICAgIC8vIEhlbHBlciBtZXRob2QgdG8gc2hvdy9oaWRlIHNldHRpbmdzIGJhc2VkIG9uIGZlYXR1cmUgZW5hYmxlbWVudFxuICAgICAgICB0aGlzLnVwZGF0ZUxpdmVGZWF0dXJlU2V0dGluZ3NWaXNpYmlsaXR5KCk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSB1cGRhdGVMaXZlRmVhdHVyZVNldHRpbmdzVmlzaWJpbGl0eSgpIHtcbiAgICAgICAgY29uc3QgbGl2ZVNldHRpbmdzRGl2ID0gdGhpcy5jb250YWluZXJFbC5xdWVyeVNlbGVjdG9yKCcuc3luYXBzZS1saXZlLXNldHRpbmdzJyk7XG4gICAgICAgIGlmIChsaXZlU2V0dGluZ3NEaXYpIHtcbiAgICAgICAgICAgIGxpdmVTZXR0aW5nc0Rpdi5zdHlsZS5kaXNwbGF5ID0gdGhpcy5wbHVnaW4uc2V0dGluZ3MuZW5hYmxlTGl2ZVN1Z2dlc3Rpb25zID8gJ2Jsb2NrJyA6ICdub25lJztcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgYXN5bmMgbG9hZEF2YWlsYWJsZU1vZGVscyhkcm9wZG93bjogRHJvcGRvd25Db21wb25lbnQpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIC8vIENsZWFyIGRyb3Bkb3duXG4gICAgICAgICAgICBkcm9wZG93bi5zZWxlY3RFbC5lbXB0eSgpO1xuICAgICAgICAgICAgZHJvcGRvd24uYWRkT3B0aW9uKCcnLCAnTG9hZGluZyBtb2RlbHMuLi4nKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgLy8gQ3JlYXRlIG5ldyBPbGxhbWEgY2xpZW50XG4gICAgICAgICAgICBjb25zdCBjbGllbnQgPSBuZXcgT2xsYW1hQ2xpZW50KHRoaXMucGx1Z2luLnNldHRpbmdzLm9sbGFtYVVybCwgJycpO1xuICAgICAgICAgICAgY29uc3QgbW9kZWxzID0gYXdhaXQgY2xpZW50LmdldEF2YWlsYWJsZU1vZGVscygpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICAvLyBVcGRhdGUgZHJvcGRvd24gd2l0aCBhdmFpbGFibGUgbW9kZWxzXG4gICAgICAgICAgICBkcm9wZG93bi5zZWxlY3RFbC5lbXB0eSgpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBpZiAobW9kZWxzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgICAgIGRyb3Bkb3duLmFkZE9wdGlvbignJywgJ05vIG1vZGVscyBmb3VuZCcpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBtb2RlbHMuZm9yRWFjaChtb2RlbCA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGRyb3Bkb3duLmFkZE9wdGlvbihtb2RlbCwgbW9kZWwpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIC8vIFNlbGVjdCBjdXJyZW50IG1vZGVsIGlmIGF2YWlsYWJsZVxuICAgICAgICAgICAgICAgIGlmIChtb2RlbHMuaW5jbHVkZXModGhpcy5wbHVnaW4uc2V0dGluZ3Mub2xsYW1hTW9kZWwpKSB7XG4gICAgICAgICAgICAgICAgICAgIGRyb3Bkb3duLnNldFZhbHVlKHRoaXMucGx1Z2luLnNldHRpbmdzLm9sbGFtYU1vZGVsKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBsb2FkaW5nIG1vZGVsczonLCBlcnJvcik7XG4gICAgICAgICAgICBkcm9wZG93bi5zZWxlY3RFbC5lbXB0eSgpO1xuICAgICAgICAgICAgZHJvcGRvd24uYWRkT3B0aW9uKCcnLCAnRXJyb3IgbG9hZGluZyBtb2RlbHMnKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgYWRkQ3VzdG9tVmFyaWFibGVSb3coY29udGFpbmVyOiBIVE1MRWxlbWVudCwga2V5OiBzdHJpbmcsIHZhbHVlOiBzdHJpbmcpIHtcbiAgICAgICAgY29uc3Qgcm93ID0gY29udGFpbmVyLmNyZWF0ZURpdignc3luYXBzZS1jdXN0b20tdmFyLXJvdycpO1xuICAgICAgICBcbiAgICAgICAgLy8gQ3JlYXRlIGtleSBpbnB1dFxuICAgICAgICBjb25zdCBrZXlJbnB1dCA9IHJvdy5jcmVhdGVFbCgnaW5wdXQnLCB7XG4gICAgICAgICAgICB0eXBlOiAndGV4dCcsXG4gICAgICAgICAgICB2YWx1ZToga2V5LFxuICAgICAgICAgICAgcGxhY2Vob2xkZXI6ICdWYXJpYWJsZSBuYW1lJ1xuICAgICAgICB9KTtcbiAgICAgICAgXG4gICAgICAgIC8vIENyZWF0ZSB2YWx1ZSBpbnB1dFxuICAgICAgICBjb25zdCB2YWx1ZUlucHV0ID0gcm93LmNyZWF0ZUVsKCdpbnB1dCcsIHtcbiAgICAgICAgICAgIHR5cGU6ICd0ZXh0JyxcbiAgICAgICAgICAgIHZhbHVlOiB2YWx1ZSxcbiAgICAgICAgICAgIHBsYWNlaG9sZGVyOiAnVmFsdWUnXG4gICAgICAgIH0pO1xuICAgICAgICBcbiAgICAgICAgLy8gQ3JlYXRlIGRlbGV0ZSBidXR0b25cbiAgICAgICAgY29uc3QgZGVsZXRlQnV0dG9uID0gcm93LmNyZWF0ZUVsKCdidXR0b24nLCB7XG4gICAgICAgICAgICB0ZXh0OiAnXHUyNzE1JyxcbiAgICAgICAgICAgIGNsczogJ3N5bmFwc2UtZGVsZXRlLXZhci1idXR0b24nXG4gICAgICAgIH0pO1xuICAgICAgICBcbiAgICAgICAgLy8gQWRkIGV2ZW50IGxpc3RlbmVyc1xuICAgICAgICBrZXlJbnB1dC5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCAoKSA9PiB7XG4gICAgICAgICAgICAvLyBSZW1vdmUgb2xkIGtleVxuICAgICAgICAgICAgZGVsZXRlIHRoaXMucGx1Z2luLnNldHRpbmdzLmN1c3RvbVRlbXBsYXRlVmFyaWFibGVzW2tleV07XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vIEFkZCB3aXRoIG5ldyBrZXlcbiAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmN1c3RvbVRlbXBsYXRlVmFyaWFibGVzW2tleUlucHV0LnZhbHVlXSA9IHZhbHVlSW5wdXQudmFsdWU7XG4gICAgICAgICAgICB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcbiAgICAgICAgfSk7XG4gICAgICAgIFxuICAgICAgICB2YWx1ZUlucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsICgpID0+IHtcbiAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmN1c3RvbVRlbXBsYXRlVmFyaWFibGVzW2tleV0gPSB2YWx1ZUlucHV0LnZhbHVlO1xuICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG4gICAgICAgIH0pO1xuICAgICAgICBcbiAgICAgICAgZGVsZXRlQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xuICAgICAgICAgICAgZGVsZXRlIHRoaXMucGx1Z2luLnNldHRpbmdzLmN1c3RvbVRlbXBsYXRlVmFyaWFibGVzW2tleV07XG4gICAgICAgICAgICB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcbiAgICAgICAgICAgIHJvdy5yZW1vdmUoKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBjcmVhdGVGaWxlU2VsZWN0aW9uTW9kYWwoY2FsbGJhY2s6IChmaWxlOiBURmlsZSB8IG51bGwpID0+IHZvaWQpIHtcbiAgICAgICAgY29uc3QgeyBtb2RhbCwgY29udGVudEVsIH0gPSB0aGlzLmNyZWF0ZU1vZGFsKCdTZWxlY3QgVGVtcGxhdGUgRmlsZScpO1xuICAgICAgICBcbiAgICAgICAgLy8gQ3JlYXRlIHNlYXJjaCBpbnB1dFxuICAgICAgICBjb25zdCBzZWFyY2hFbCA9IGNvbnRlbnRFbC5jcmVhdGVFbCgnaW5wdXQnLCB7XG4gICAgICAgICAgICB0eXBlOiAndGV4dCcsXG4gICAgICAgICAgICBwbGFjZWhvbGRlcjogJ1NlYXJjaCBmaWxlcy4uLidcbiAgICAgICAgfSk7XG4gICAgICAgIFxuICAgICAgICAvLyBDcmVhdGUgZmlsZSBsaXN0IGNvbnRhaW5lclxuICAgICAgICBjb25zdCBmaWxlTGlzdEVsID0gY29udGVudEVsLmNyZWF0ZURpdignc3luYXBzZS1maWxlLWxpc3QnKTtcbiAgICAgICAgXG4gICAgICAgIC8vIEdldCBhbGwgbWFya2Rvd24gZmlsZXMgaW4gdmF1bHRcbiAgICAgICAgY29uc3QgbWFya2Rvd25GaWxlcyA9IHRoaXMuYXBwLnZhdWx0LmdldE1hcmtkb3duRmlsZXMoKTtcbiAgICAgICAgXG4gICAgICAgIC8vIEZ1bmN0aW9uIHRvIGRpc3BsYXkgZmlsZXNcbiAgICAgICAgY29uc3QgZGlzcGxheUZpbGVzID0gKGZpbGVzOiBURmlsZVtdKSA9PiB7XG4gICAgICAgICAgICBmaWxlTGlzdEVsLmVtcHR5KCk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGlmIChmaWxlcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICBmaWxlTGlzdEVsLmNyZWF0ZUVsKCdkaXYnLCB7IHRleHQ6ICdObyBmaWxlcyBmb3VuZCcgfSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgXG4gICAgICAgICAgICBmb3IgKGNvbnN0IGZpbGUgb2YgZmlsZXMpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBmaWxlSXRlbSA9IGZpbGVMaXN0RWwuY3JlYXRlRGl2KCdzeW5hcHNlLWZpbGUtaXRlbScpO1xuICAgICAgICAgICAgICAgIGZpbGVJdGVtLnNldFRleHQoZmlsZS5wYXRoKTtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICBmaWxlSXRlbS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soZmlsZSk7XG4gICAgICAgICAgICAgICAgICAgIG1vZGFsLmNsb3NlKCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIFxuICAgICAgICAvLyBJbml0aWFsIGRpc3BsYXkgb2YgYWxsIGZpbGVzXG4gICAgICAgIGRpc3BsYXlGaWxlcyhtYXJrZG93bkZpbGVzKTtcbiAgICAgICAgXG4gICAgICAgIC8vIEFkZCBzZWFyY2ggZnVuY3Rpb25hbGl0eVxuICAgICAgICBzZWFyY2hFbC5hZGRFdmVudExpc3RlbmVyKCdpbnB1dCcsICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHNlYXJjaFRlcm0gPSBzZWFyY2hFbC52YWx1ZS50b0xvd2VyQ2FzZSgpO1xuICAgICAgICAgICAgY29uc3QgZmlsdGVyZWRGaWxlcyA9IG1hcmtkb3duRmlsZXMuZmlsdGVyKGZpbGUgPT4gXG4gICAgICAgICAgICAgICAgZmlsZS5wYXRoLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoc2VhcmNoVGVybSlcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICBkaXNwbGF5RmlsZXMoZmlsdGVyZWRGaWxlcyk7XG4gICAgICAgIH0pO1xuICAgICAgICBcbiAgICAgICAgLy8gQWRkIGNhbmNlbCBidXR0b25cbiAgICAgICAgY29uc3QgZm9vdGVyRWwgPSBjb250ZW50RWwuY3JlYXRlRGl2KCdzeW5hcHNlLW1vZGFsLWZvb3RlcicpO1xuICAgICAgICBjb25zdCBjYW5jZWxCdXR0b24gPSBmb290ZXJFbC5jcmVhdGVFbCgnYnV0dG9uJywgeyB0ZXh0OiAnQ2FuY2VsJyB9KTtcbiAgICAgICAgY2FuY2VsQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xuICAgICAgICAgICAgY2FsbGJhY2sobnVsbCk7XG4gICAgICAgICAgICBtb2RhbC5jbG9zZSgpO1xuICAgICAgICB9KTtcbiAgICAgICAgXG4gICAgICAgIHJldHVybiBtb2RhbDtcbiAgICB9XG5cbiAgICBwcml2YXRlIGNyZWF0ZU1vZGFsKHRpdGxlOiBzdHJpbmcpIHtcbiAgICAgICAgY29uc3QgbW9kYWwgPSBuZXcgKHJlcXVpcmUoJ29ic2lkaWFuJykuTW9kYWwpKHRoaXMuYXBwKSBhcyBhbnk7XG4gICAgICAgIG1vZGFsLnRpdGxlRWwuc2V0VGV4dCh0aXRsZSk7XG4gICAgICAgIG1vZGFsLmNvbnRlbnRFbC5hZGRDbGFzcygnc3luYXBzZS1tb2RhbCcpO1xuICAgICAgICBcbiAgICAgICAgcmV0dXJuIHsgbW9kYWwsIGNvbnRlbnRFbDogbW9kYWwuY29udGVudEVsIH07XG4gICAgfVxufSIsICJleHBvcnQgaW50ZXJmYWNlIE9sbGFtYVJlc3BvbnNlIHtcbiAgICByZXNwb25zZTogc3RyaW5nO1xuICAgIGRvbmU6IGJvb2xlYW47XG4gICAgY29udGV4dD86IG51bWJlcltdO1xufVxuXG5leHBvcnQgY2xhc3MgT2xsYW1hQ2xpZW50IHtcbiAgICBwcml2YXRlIGJhc2VVcmw6IHN0cmluZztcbiAgICBwcml2YXRlIG1vZGVsOiBzdHJpbmc7XG5cbiAgICBjb25zdHJ1Y3RvcihiYXNlVXJsOiBzdHJpbmcsIG1vZGVsOiBzdHJpbmcpIHtcbiAgICAgICAgdGhpcy5iYXNlVXJsID0gYmFzZVVybC5yZXBsYWNlKC9cXC8kLywgJycpOyAvLyBSZW1vdmUgdHJhaWxpbmcgc2xhc2hcbiAgICAgICAgdGhpcy5tb2RlbCA9IG1vZGVsO1xuICAgIH1cblxuICAgIGFzeW5jIGlzQXZhaWxhYmxlKCk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChgJHt0aGlzLmJhc2VVcmx9L2FwaS90YWdzYCk7XG4gICAgICAgICAgICByZXR1cm4gcmVzcG9uc2Uub2s7XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBhc3luYyBnZW5lcmF0ZShwcm9tcHQ6IHN0cmluZywgc3lzdGVtUHJvbXB0Pzogc3RyaW5nLCBjaGF0SGlzdG9yeT86IHN0cmluZyk6IFByb21pc2U8c3RyaW5nPiB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICAvLyBJZiBjaGF0IGhpc3RvcnkgaXMgcHJvdmlkZWQsIGZvcm1hdCBpdCBuaWNlbHlcbiAgICAgICAgICAgIGxldCBmdWxsUHJvbXB0ID0gcHJvbXB0O1xuICAgICAgICAgICAgaWYgKGNoYXRIaXN0b3J5ICYmIGNoYXRIaXN0b3J5LnRyaW0oKSkge1xuICAgICAgICAgICAgICAgIGZ1bGxQcm9tcHQgPSBgQ2hhdCBoaXN0b3J5OlxcbiR7Y2hhdEhpc3Rvcnl9XFxuXFxuQ3VycmVudCBtZXNzYWdlOiAke3Byb21wdH1gO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgXG4gICAgICAgICAgICBjb25zdCByZXF1ZXN0Qm9keSA9IHtcbiAgICAgICAgICAgICAgICBtb2RlbDogdGhpcy5tb2RlbCxcbiAgICAgICAgICAgICAgICBwcm9tcHQ6IGZ1bGxQcm9tcHQsXG4gICAgICAgICAgICAgICAgc3lzdGVtOiBzeXN0ZW1Qcm9tcHQgfHwgJycsXG4gICAgICAgICAgICAgICAgc3RyZWFtOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBvcHRpb25zOiB7XG4gICAgICAgICAgICAgICAgICAgIHRlbXBlcmF0dXJlOiAwLjcsXG4gICAgICAgICAgICAgICAgICAgIHRvcF9wOiAwLjksXG4gICAgICAgICAgICAgICAgICAgIHRvcF9rOiA0MCxcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKGAke3RoaXMuYmFzZVVybH0vYXBpL2dlbmVyYXRlYCwge1xuICAgICAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgICAgICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAgICAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHJlcXVlc3RCb2R5KSxcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBpZiAoIXJlc3BvbnNlLm9rKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBPbGxhbWEgQVBJIGVycm9yOiAke3Jlc3BvbnNlLnN0YXR1c31gKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgY29uc3QgZGF0YTogT2xsYW1hUmVzcG9uc2UgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7XG4gICAgICAgICAgICByZXR1cm4gZGF0YS5yZXNwb25zZS50cmltKCk7XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEZhaWxlZCB0byBnZW5lcmF0ZSByZXNwb25zZTogJHtlcnJvci5tZXNzYWdlfWApO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgYXN5bmMgZ2V0QXZhaWxhYmxlTW9kZWxzKCk6IFByb21pc2U8c3RyaW5nW10+IHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goYCR7dGhpcy5iYXNlVXJsfS9hcGkvdGFnc2ApO1xuICAgICAgICAgICAgaWYgKCFyZXNwb25zZS5vaykge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgRmFpbGVkIHRvIGZldGNoIG1vZGVsczogJHtyZXNwb25zZS5zdGF0dXN9YCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGNvbnN0IGRhdGEgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7XG4gICAgICAgICAgICByZXR1cm4gZGF0YS5tb2RlbHM/Lm1hcCgobW9kZWw6IGFueSkgPT4gbW9kZWwubmFtZSkgfHwgW107XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBmZXRjaGluZyBtb2RlbHM6JywgZXJyb3IpO1xuICAgICAgICAgICAgcmV0dXJuIFtdO1xuICAgICAgICB9XG4gICAgfVxufVxuIiwgImltcG9ydCB7IEVkaXRvciwgVEZpbGUsIE5vdGljZSwgQXBwLCBNYXJrZG93blZpZXcgfSBmcm9tICdvYnNpZGlhbic7XG5pbXBvcnQgeyBPbGxhbWFDbGllbnQgfSBmcm9tICcuL29sbGFtYSc7XG5pbXBvcnQgeyBTeW5hcHNlU2V0dGluZ3MgfSBmcm9tICcuL3NldHRpbmdzJztcblxuZXhwb3J0IGNsYXNzIFN5bmFwc2VDb21tYW5kcyB7XG4gICAgcHJpdmF0ZSBhcHA6IEFwcDtcbiAgICBwcml2YXRlIG9sbGFtYTogT2xsYW1hQ2xpZW50O1xuICAgIHByaXZhdGUgc2V0dGluZ3M6IFN5bmFwc2VTZXR0aW5ncztcblxuICAgIGNvbnN0cnVjdG9yKGFwcDogQXBwLCBvbGxhbWE6IE9sbGFtYUNsaWVudCwgc2V0dGluZ3M6IFN5bmFwc2VTZXR0aW5ncykge1xuICAgICAgICB0aGlzLmFwcCA9IGFwcDtcbiAgICAgICAgdGhpcy5vbGxhbWEgPSBvbGxhbWE7XG4gICAgICAgIHRoaXMuc2V0dGluZ3MgPSBzZXR0aW5ncztcbiAgICB9XG5cbiAgICB1cGRhdGVTZXR0aW5ncyhzZXR0aW5nczogU3luYXBzZVNldHRpbmdzKSB7XG4gICAgICAgIHRoaXMuc2V0dGluZ3MgPSBzZXR0aW5ncztcbiAgICAgICAgdGhpcy5vbGxhbWEgPSBuZXcgT2xsYW1hQ2xpZW50KHNldHRpbmdzLm9sbGFtYVVybCwgc2V0dGluZ3Mub2xsYW1hTW9kZWwpO1xuICAgIH1cblxuICAgIGFzeW5jIGV4cGxhaW5BbmRMaW5rKGVkaXRvcjogRWRpdG9yLCBzZWxlY3RlZFRleHQ6IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xuICAgICAgICBpZiAoIXNlbGVjdGVkVGV4dC50cmltKCkpIHtcbiAgICAgICAgICAgIG5ldyBOb3RpY2UoJ1BsZWFzZSBzZWxlY3QgdGV4dCB0byBleHBsYWluJyk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBub3RpY2VMb2FkaW5nID0gbmV3IE5vdGljZSgnR2VuZXJhdGluZyBleHBsYW5hdGlvbi4uLicsIDApO1xuICAgICAgICBcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIC8vIEdlbmVyYXRlIGV4cGxhbmF0aW9uXG4gICAgICAgICAgICBjb25zdCBzeXN0ZW1Qcm9tcHQgPSB0aGlzLnByb2Nlc3NUZW1wbGF0ZVZhcmlhYmxlcyh0aGlzLnNldHRpbmdzLmV4cGxhbmF0aW9uU3lzdGVtUHJvbXB0KTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgY29uc3QgcHJvbXB0ID0gYEV4cGxhaW4gdGhpcyBjb25jZXB0OiBcIiR7c2VsZWN0ZWRUZXh0fVwiYDtcbiAgICAgICAgICAgIGNvbnN0IGV4cGxhbmF0aW9uID0gYXdhaXQgdGhpcy5vbGxhbWEuZ2VuZXJhdGUocHJvbXB0LCBzeXN0ZW1Qcm9tcHQpO1xuXG4gICAgICAgICAgICAvLyBDcmVhdGUgbm90ZSBmaWxlbmFtZSAoc2FuaXRpemUpXG4gICAgICAgICAgICBjb25zdCBub3RlVGl0bGUgPSB0aGlzLnNhbml0aXplRmlsZU5hbWUoc2VsZWN0ZWRUZXh0KTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgLy8gQ3JlYXRlIGZvbGRlciBpZiBpdCBkb2Vzbid0IGV4aXN0XG4gICAgICAgICAgICBhd2FpdCB0aGlzLmVuc3VyZUZvbGRlckV4aXN0cyh0aGlzLnNldHRpbmdzLmV4cGxhbmF0aW9uRm9sZGVyKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgLy8gQ3JlYXRlIHBhdGggd2l0aCBmb2xkZXJcbiAgICAgICAgICAgIGNvbnN0IGZpbGVQYXRoID0gYCR7dGhpcy5zZXR0aW5ncy5leHBsYW5hdGlvbkZvbGRlcn0vJHtub3RlVGl0bGV9Lm1kYDtcblxuICAgICAgICAgICAgLy8gQ2hlY2sgaWYgbm90ZSBhbHJlYWR5IGV4aXN0c1xuICAgICAgICAgICAgY29uc3QgZXhpc3RpbmdGaWxlID0gdGhpcy5hcHAudmF1bHQuZ2V0QWJzdHJhY3RGaWxlQnlQYXRoKGZpbGVQYXRoKTtcbiAgICAgICAgICAgIGlmIChleGlzdGluZ0ZpbGUgaW5zdGFuY2VvZiBURmlsZSkge1xuICAgICAgICAgICAgICAgIG5ldyBOb3RpY2UoYE5vdGUgXCIke25vdGVUaXRsZX1cIiBhbHJlYWR5IGV4aXN0c2ApO1xuICAgICAgICAgICAgICAgIG5vdGljZUxvYWRpbmcuaGlkZSgpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gQ3JlYXRlIG5ldyBub3RlIGNvbnRlbnQgLSBlaXRoZXIgZnJvbSB0ZW1wbGF0ZSBvciBmcm9tIHNjcmF0Y2hcbiAgICAgICAgICAgIGxldCBub3RlQ29udGVudDtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgaWYgKHRoaXMuc2V0dGluZ3MudXNlVGVtcGxhdGVGb3JFeHBsYW5hdGlvbnMgJiYgdGhpcy5zZXR0aW5ncy50ZW1wbGF0ZVBhdGgpIHtcbiAgICAgICAgICAgICAgICAvLyBVc2UgdGVtcGxhdGUgaWYgZW5hYmxlZCBhbmQgdGVtcGxhdGUgcGF0aCBpcyBzZXRcbiAgICAgICAgICAgICAgICBub3RlQ29udGVudCA9IGF3YWl0IHRoaXMuZ2VuZXJhdGVGcm9tVGVtcGxhdGUoXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0dGluZ3MudGVtcGxhdGVQYXRoLCBcbiAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6IG5vdGVUaXRsZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnQ6IGV4cGxhbmF0aW9uLFxuICAgICAgICAgICAgICAgICAgICAgICAgZGF0ZTogbmV3IERhdGUoKS50b0xvY2FsZURhdGVTdHJpbmcoKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHF1ZXJ5OiBzZWxlY3RlZFRleHQsXG4gICAgICAgICAgICAgICAgICAgICAgICAuLi50aGlzLnNldHRpbmdzLmN1c3RvbVRlbXBsYXRlVmFyaWFibGVzXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAvLyBVc2UgZGVmYXVsdCBmb3JtYXRcbiAgICAgICAgICAgICAgICBub3RlQ29udGVudCA9IGAjICR7bm90ZVRpdGxlfVxuXG4ke2V4cGxhbmF0aW9ufVxuXG4tLS1cbipHZW5lcmF0ZWQgYnkgU3luYXBzZSBBSSpcbipDcmVhdGVkOiAke25ldyBEYXRlKCkudG9Mb2NhbGVEYXRlU3RyaW5nKCl9KmA7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIENyZWF0ZSB0aGUgbmV3IG5vdGVcbiAgICAgICAgICAgIGNvbnN0IG5ld0ZpbGUgPSBhd2FpdCB0aGlzLmFwcC52YXVsdC5jcmVhdGUoZmlsZVBhdGgsIG5vdGVDb250ZW50KTtcblxuICAgICAgICAgICAgLy8gSW5zZXJ0IGxpbmsgaW4gY3VycmVudCBlZGl0b3JcbiAgICAgICAgICAgIGNvbnN0IGxpbmsgPSBgW1ske2ZpbGVQYXRoLnJlcGxhY2UoJy5tZCcsICcnKX18JHtub3RlVGl0bGV9XV1gO1xuICAgICAgICAgICAgZWRpdG9yLnJlcGxhY2VTZWxlY3Rpb24obGluayk7XG5cbiAgICAgICAgICAgIC8vIE9wZW4gdGhlIG5ldyBub3RlXG4gICAgICAgICAgICBhd2FpdCB0aGlzLmFwcC53b3Jrc3BhY2UuZ2V0TGVhZigpLm9wZW5GaWxlKG5ld0ZpbGUpO1xuXG4gICAgICAgICAgICBub3RpY2VMb2FkaW5nLmhpZGUoKTtcbiAgICAgICAgICAgIG5ldyBOb3RpY2UoYENyZWF0ZWQgYW5kIGxpbmtlZCBub3RlOiAke25vdGVUaXRsZX1gKTtcblxuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgbm90aWNlTG9hZGluZy5oaWRlKCk7XG4gICAgICAgICAgICBuZXcgTm90aWNlKGBFcnJvcjogJHtlcnJvci5tZXNzYWdlfWApO1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcignRXhwbGFpbiBhbmQgTGluayBlcnJvcjonLCBlcnJvcik7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBhc3luYyBzdW1tYXJpemVOb3RlKGVkaXRvcjogRWRpdG9yLCBjb250ZW50OiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAgICAgaWYgKCFjb250ZW50LnRyaW0oKSkge1xuICAgICAgICAgICAgbmV3IE5vdGljZSgnTm8gY29udGVudCB0byBzdW1tYXJpemUnKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IG5vdGljZUxvYWRpbmcgPSBuZXcgTm90aWNlKCdHZW5lcmF0aW5nIHN1bW1hcnkuLi4nLCAwKTtcblxuICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3Qgc3lzdGVtUHJvbXB0ID0gdGhpcy5wcm9jZXNzVGVtcGxhdGVWYXJpYWJsZXModGhpcy5zZXR0aW5ncy5zdW1tYXJ5U3lzdGVtUHJvbXB0KTtcblxuICAgICAgICAgICAgY29uc3QgcHJvbXB0ID0gYFN1bW1hcml6ZSB0aGlzIGNvbnRlbnQ6XFxuXFxuJHtjb250ZW50fWA7XG4gICAgICAgICAgICBjb25zdCBzdW1tYXJ5ID0gYXdhaXQgdGhpcy5vbGxhbWEuZ2VuZXJhdGUocHJvbXB0LCBzeXN0ZW1Qcm9tcHQpO1xuXG4gICAgICAgICAgICAvLyBGb3JtYXQgc3VtbWFyeSBiYXNlZCBvbiBzZXR0aW5nc1xuICAgICAgICAgICAgbGV0IHN1bW1hcnlTZWN0aW9uO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBpZiAodGhpcy5zZXR0aW5ncy51c2VTdW1tYXJ5WWFtbCkge1xuICAgICAgICAgICAgICAgIC8vIEZvcm1hdCBhcyBZQU1MXG4gICAgICAgICAgICAgICAgc3VtbWFyeVNlY3Rpb24gPSBgLS0tXG5zdW1tYXJ5OlxuJHtzdW1tYXJ5LnNwbGl0KCdcXG4nKS5tYXAobGluZSA9PiBgICAke2xpbmV9YCkuam9pbignXFxuJyl9XG4tLS1cblxuYDtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgLy8gRm9ybWF0IGFzIHJlZ3VsYXIgbWFya2Rvd25cbiAgICAgICAgICAgICAgICBzdW1tYXJ5U2VjdGlvbiA9IGAjIyBTdW1tYXJ5XG5cbiR7c3VtbWFyeX1cblxuLS0tXG5cbmA7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIEluc2VydCBzdW1tYXJ5IGF0IHNwZWNpZmllZCBsb2NhdGlvblxuICAgICAgICAgICAgaWYgKHRoaXMuc2V0dGluZ3Muc3VtbWFyeUxvY2F0aW9uID09PSAndG9wJykge1xuICAgICAgICAgICAgICAgIC8vIEZpbmQgZmlyc3QgaGVhZGluZyBvciBpbnNlcnQgYXQgYmVnaW5uaW5nXG4gICAgICAgICAgICAgICAgY29uc3QgbGluZXMgPSBjb250ZW50LnNwbGl0KCdcXG4nKTtcbiAgICAgICAgICAgICAgICBsZXQgaW5zZXJ0SW5kZXggPSAwO1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIC8vIFNraXAgZnJvbnQgbWF0dGVyIGlmIGV4aXN0c1xuICAgICAgICAgICAgICAgIGlmIChsaW5lc1swXT8uc3RhcnRzV2l0aCgnLS0tJykpIHtcbiAgICAgICAgICAgICAgICAgICAgbGV0IGVuZEZyb250TWF0dGVyID0gbGluZXMuZmluZEluZGV4KChsaW5lLCBpKSA9PiBpID4gMCAmJiBsaW5lLnN0YXJ0c1dpdGgoJy0tLScpKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGVuZEZyb250TWF0dGVyICE9PSAtMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaW5zZXJ0SW5kZXggPSBlbmRGcm9udE1hdHRlciArIDE7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyBJZiB3ZSdyZSB1c2luZyBZQU1MIGFuZCB0aGVyZSdzIGFscmVhZHkgZnJvbnRtYXR0ZXIsIHdlIG5lZWQgdG8gbWVyZ2UgdGhlbVxuICAgICAgICAgICAgICAgIGlmICh0aGlzLnNldHRpbmdzLnVzZVN1bW1hcnlZYW1sICYmIGxpbmVzWzBdPy5zdGFydHNXaXRoKCctLS0nKSkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBlbmRGcm9udE1hdHRlciA9IGxpbmVzLmZpbmRJbmRleCgobGluZSwgaSkgPT4gaSA+IDAgJiYgbGluZS5zdGFydHNXaXRoKCctLS0nKSk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChlbmRGcm9udE1hdHRlciAhPT0gLTEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEV4dHJhY3QgZXhpc3RpbmcgZnJvbnRtYXR0ZXJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGV4aXN0aW5nRnJvbnRtYXR0ZXIgPSBsaW5lcy5zbGljZSgwLCBlbmRGcm9udE1hdHRlciArIDEpLmpvaW4oJ1xcbicpO1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gUmVtb3ZlIGNsb3NpbmcgZGVsaW1pdGVyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBvcGVuRnJvbnRtYXR0ZXIgPSBleGlzdGluZ0Zyb250bWF0dGVyLnJlcGxhY2UoLy0tLVxccyokLywgJycpO1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gQWRkIHN1bW1hcnkgdG8gZnJvbnRtYXR0ZXJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHN1bW1hcnlZYW1sID0gYHN1bW1hcnk6XG4ke3N1bW1hcnkuc3BsaXQoJ1xcbicpLm1hcChsaW5lID0+IGAgICR7bGluZX1gKS5qb2luKCdcXG4nKX1cbi0tLWA7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBDb21iaW5lXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBuZXdDb250ZW50ID0gb3BlbkZyb250bWF0dGVyICsgc3VtbWFyeVlhbWwgKyAnXFxuXFxuJyArIGxpbmVzLnNsaWNlKGVuZEZyb250TWF0dGVyICsgMSkuam9pbignXFxuJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICBlZGl0b3Iuc2V0VmFsdWUobmV3Q29udGVudCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBub3RpY2VMb2FkaW5nLmhpZGUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBOb3RpY2UoJ1N1bW1hcnkgYWRkZWQgdG8gZnJvbnRtYXR0ZXInKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGNvbnN0IG5ld0NvbnRlbnQgPSBbXG4gICAgICAgICAgICAgICAgICAgIC4uLmxpbmVzLnNsaWNlKDAsIGluc2VydEluZGV4KSxcbiAgICAgICAgICAgICAgICAgICAgJycsXG4gICAgICAgICAgICAgICAgICAgIHN1bW1hcnlTZWN0aW9uLFxuICAgICAgICAgICAgICAgICAgICAuLi5saW5lcy5zbGljZShpbnNlcnRJbmRleClcbiAgICAgICAgICAgICAgICBdLmpvaW4oJ1xcbicpO1xuXG4gICAgICAgICAgICAgICAgZWRpdG9yLnNldFZhbHVlKG5ld0NvbnRlbnQpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAvLyBJbnNlcnQgYXQgYm90dG9tXG4gICAgICAgICAgICAgICAgZWRpdG9yLnNldFZhbHVlKGNvbnRlbnQgKyAnXFxuXFxuJyArIHN1bW1hcnlTZWN0aW9uKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgbm90aWNlTG9hZGluZy5oaWRlKCk7XG4gICAgICAgICAgICBuZXcgTm90aWNlKCdTdW1tYXJ5IGFkZGVkIHRvIG5vdGUnKTtcblxuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgbm90aWNlTG9hZGluZy5oaWRlKCk7XG4gICAgICAgICAgICBuZXcgTm90aWNlKGBFcnJvcjogJHtlcnJvci5tZXNzYWdlfWApO1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcignU3VtbWFyaXplIGVycm9yOicsIGVycm9yKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGFzeW5jIGNyZWF0ZUZsYXNoY2FyZHMoZWRpdG9yOiBFZGl0b3IsIHNlbGVjdGVkVGV4dDogc3RyaW5nKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgICAgIGlmICghc2VsZWN0ZWRUZXh0LnRyaW0oKSkge1xuICAgICAgICAgICAgbmV3IE5vdGljZSgnUGxlYXNlIHNlbGVjdCB0ZXh0IHRvIGNyZWF0ZSBmbGFzaGNhcmRzIGZyb20nKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IG5vdGljZUxvYWRpbmcgPSBuZXcgTm90aWNlKCdDcmVhdGluZyBmbGFzaGNhcmRzLi4uJywgMCk7XG5cbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IHN5c3RlbVByb21wdCA9IHRoaXMucHJvY2Vzc1RlbXBsYXRlVmFyaWFibGVzKHRoaXMuc2V0dGluZ3MuZmxhc2hjYXJkU3lzdGVtUHJvbXB0KTtcblxuICAgICAgICAgICAgY29uc3QgcHJvbXB0ID0gYENyZWF0ZSBmbGFzaGNhcmRzIGZyb20gdGhpcyBjb250ZW50OlxcblxcbiR7c2VsZWN0ZWRUZXh0fWA7XG4gICAgICAgICAgICBjb25zdCBmbGFzaGNhcmRzID0gYXdhaXQgdGhpcy5vbGxhbWEuZ2VuZXJhdGUocHJvbXB0LCBzeXN0ZW1Qcm9tcHQpO1xuXG4gICAgICAgICAgICAvLyBEZWNpZGUgaWYgd2Ugc2hvdWxkIGNyZWF0ZSBhIG5ldyBmbGFzaGNhcmQgbm90ZSBvciBpbnNlcnQgaW50byBjdXJyZW50IG5vdGVcbiAgICAgICAgICAgIGNvbnN0IGFjdGl2ZUZpbGUgPSB0aGlzLmFwcC53b3Jrc3BhY2UuZ2V0QWN0aXZlRmlsZSgpO1xuICAgICAgICAgICAgY29uc3Qgbm90ZVRpdGxlID0gYWN0aXZlRmlsZSA/IGFjdGl2ZUZpbGUuYmFzZW5hbWUgOiBcIlVudGl0bGVkXCI7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vIENyZWF0ZSBmbGFzaGNhcmRzIG5vdGUgaW4gZGVkaWNhdGVkIGZvbGRlclxuICAgICAgICAgICAgYXdhaXQgdGhpcy5lbnN1cmVGb2xkZXJFeGlzdHModGhpcy5zZXR0aW5ncy5mbGFzaGNhcmRGb2xkZXIpO1xuICAgICAgICAgICAgY29uc3QgZmxhc2hjYXJkRmlsZU5hbWUgPSBgJHt0aGlzLnNldHRpbmdzLmZsYXNoY2FyZEZvbGRlcn0vJHtub3RlVGl0bGV9IC0gRmxhc2hjYXJkcy5tZGA7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGNvbnN0IGZsYXNoY2FyZENvbnRlbnQgPSBgIyBGbGFzaGNhcmRzIGZvciAke25vdGVUaXRsZX1cblxuJHtmbGFzaGNhcmRzfVxuXG4tLS1cbipHZW5lcmF0ZWQgZnJvbTogW1ske2FjdGl2ZUZpbGUgPyBhY3RpdmVGaWxlLnBhdGgucmVwbGFjZSgnLm1kJywgJycpIDogJ1Vua25vd24gc291cmNlJ31dXSpcbipDcmVhdGVkOiAke25ldyBEYXRlKCkudG9Mb2NhbGVEYXRlU3RyaW5nKCl9KlxuYDtcblxuICAgICAgICAgICAgLy8gQ2hlY2sgaWYgZmxhc2hjYXJkIGZpbGUgZXhpc3RzIGFuZCBhcHBlbmQgb3IgY3JlYXRlXG4gICAgICAgICAgICBjb25zdCBleGlzdGluZ0ZpbGUgPSB0aGlzLmFwcC52YXVsdC5nZXRBYnN0cmFjdEZpbGVCeVBhdGgoZmxhc2hjYXJkRmlsZU5hbWUpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBpZiAoZXhpc3RpbmdGaWxlIGluc3RhbmNlb2YgVEZpbGUpIHtcbiAgICAgICAgICAgICAgICAvLyBBcHBlbmQgdG8gZXhpc3RpbmcgZmlsZVxuICAgICAgICAgICAgICAgIGNvbnN0IGV4aXN0aW5nQ29udGVudCA9IGF3YWl0IHRoaXMuYXBwLnZhdWx0LnJlYWQoZXhpc3RpbmdGaWxlKTtcbiAgICAgICAgICAgICAgICBjb25zdCBuZXdDb250ZW50ID0gZXhpc3RpbmdDb250ZW50ICsgXCJcXG5cXG4jIyBOZXcgRmxhc2hjYXJkc1xcblxcblwiICsgZmxhc2hjYXJkcztcbiAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLmFwcC52YXVsdC5tb2RpZnkoZXhpc3RpbmdGaWxlLCBuZXdDb250ZW50KTtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAvLyBPcGVuIHRoZSBmaWxlXG4gICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5hcHAud29ya3NwYWNlLmdldExlYWYoKS5vcGVuRmlsZShleGlzdGluZ0ZpbGUpO1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIG5vdGljZUxvYWRpbmcuaGlkZSgpO1xuICAgICAgICAgICAgICAgIG5ldyBOb3RpY2UoJ0FkZGVkIGZsYXNoY2FyZHMgdG8gZXhpc3Rpbmcgbm90ZScpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAvLyBDcmVhdGUgbmV3IGZpbGVcbiAgICAgICAgICAgICAgICBjb25zdCBuZXdGaWxlID0gYXdhaXQgdGhpcy5hcHAudmF1bHQuY3JlYXRlKGZsYXNoY2FyZEZpbGVOYW1lLCBmbGFzaGNhcmRDb250ZW50KTtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAvLyBPcGVuIHRoZSBmaWxlXG4gICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5hcHAud29ya3NwYWNlLmdldExlYWYoKS5vcGVuRmlsZShuZXdGaWxlKTtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICBub3RpY2VMb2FkaW5nLmhpZGUoKTtcbiAgICAgICAgICAgICAgICBuZXcgTm90aWNlKCdDcmVhdGVkIG5ldyBmbGFzaGNhcmRzIG5vdGUnKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gQWxzbyBhZGQgbGluayB0byBjdXJyZW50IG5vdGVcbiAgICAgICAgICAgIGNvbnN0IGxpbmsgPSBgXFxuXFxuW1ske2ZsYXNoY2FyZEZpbGVOYW1lLnJlcGxhY2UoJy5tZCcsICcnKX18Rmxhc2hjYXJkcyBmb3IgdGhpcyBub3RlXV1cXG5gO1xuICAgICAgICAgICAgY29uc3QgY3Vyc29yID0gZWRpdG9yLmdldEN1cnNvcigpO1xuICAgICAgICAgICAgZWRpdG9yLnNldExpbmUoY3Vyc29yLmxpbmUsIGVkaXRvci5nZXRMaW5lKGN1cnNvci5saW5lKSArIGxpbmspO1xuXG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICBub3RpY2VMb2FkaW5nLmhpZGUoKTtcbiAgICAgICAgICAgIG5ldyBOb3RpY2UoYEVycm9yOiAke2Vycm9yLm1lc3NhZ2V9YCk7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCdDcmVhdGUgRmxhc2hjYXJkcyBlcnJvcjonLCBlcnJvcik7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBhc3luYyBzdGFydENoYXRTZXNzaW9uKGVkaXRvcjogRWRpdG9yKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgICAgIC8vIENyZWF0ZSBhIG5ldyBjaGF0IG5vdGUgaW4gdGhlIGNoYXQgZm9sZGVyXG4gICAgICAgIGF3YWl0IHRoaXMuZW5zdXJlRm9sZGVyRXhpc3RzKHRoaXMuc2V0dGluZ3MuY2hhdEZvbGRlcik7XG4gICAgICAgIFxuICAgICAgICBjb25zdCB0aW1lc3RhbXAgPSBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCkucmVwbGFjZSgvWzouXS9nLCAnLScpO1xuICAgICAgICBjb25zdCBjaGF0RmlsZU5hbWUgPSBgJHt0aGlzLnNldHRpbmdzLmNoYXRGb2xkZXJ9L0NoYXQtJHt0aW1lc3RhbXB9Lm1kYDtcbiAgICAgICAgXG4gICAgICAgIGNvbnN0IGNoYXRUZW1wbGF0ZSA9IGAjIENoYXQgU2Vzc2lvbiAke25ldyBEYXRlKCkudG9Mb2NhbGVTdHJpbmcoKX1cblxuIyMgQ29udGV4dFxuKlRoaXMgaXMgYSBjaGF0IHNlc3Npb24gd2l0aCBTeW5hcHNlIEFJLiBUeXBlIHlvdXIgbWVzc2FnZXMgYWZ0ZXIgdGhlID4gcHJvbXB0LipcblxuIyMgQ2hhdFxuXG4+IFxuXG5gO1xuICAgICAgICBcbiAgICAgICAgY29uc3QgbmV3RmlsZSA9IGF3YWl0IHRoaXMuYXBwLnZhdWx0LmNyZWF0ZShjaGF0RmlsZU5hbWUsIGNoYXRUZW1wbGF0ZSk7XG4gICAgICAgIFxuICAgICAgICAvLyBPcGVuIHRoZSBmaWxlXG4gICAgICAgIGNvbnN0IGxlYWYgPSB0aGlzLmFwcC53b3Jrc3BhY2UuZ2V0TGVhZigpO1xuICAgICAgICBhd2FpdCBsZWFmLm9wZW5GaWxlKG5ld0ZpbGUpO1xuICAgICAgICBcbiAgICAgICAgLy8gUG9zaXRpb24gY3Vyc29yIGF0IHRoZSBwcm9tcHRcbiAgICAgICAgY29uc3QgbmV3RWRpdG9yID0gdGhpcy5nZXRBY3RpdmVFZGl0b3IoKTtcbiAgICAgICAgaWYgKG5ld0VkaXRvcikge1xuICAgICAgICAgICAgY29uc3QgbGluZXMgPSBjaGF0VGVtcGxhdGUuc3BsaXQoJ1xcbicpO1xuICAgICAgICAgICAgY29uc3QgcHJvbXB0TGluZSA9IGxpbmVzLmZpbmRJbmRleChsaW5lID0+IGxpbmUgPT09ICc+ICcpO1xuICAgICAgICAgICAgaWYgKHByb21wdExpbmUgIT09IC0xKSB7XG4gICAgICAgICAgICAgICAgbmV3RWRpdG9yLnNldEN1cnNvcih7IGxpbmU6IHByb21wdExpbmUsIGNoOiAyIH0pO1xuICAgICAgICAgICAgICAgIG5ld0VkaXRvci5mb2N1cygpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBuZXcgTm90aWNlKCdTdGFydGVkIG5ldyBjaGF0IHNlc3Npb24nKTtcbiAgICB9XG5cbiAgICBhc3luYyBzZW5kQ2hhdE1lc3NhZ2UoZWRpdG9yOiBFZGl0b3IpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAgICAgLy8gRmluZCB0aGUgY3VycmVudCBjaGF0IG1lc3NhZ2UgKGxpbmUgc3RhcnRpbmcgd2l0aCAnPicpXG4gICAgICAgIGNvbnN0IGNvbnRlbnQgPSBlZGl0b3IuZ2V0VmFsdWUoKTtcbiAgICAgICAgY29uc3QgbGluZXMgPSBjb250ZW50LnNwbGl0KCdcXG4nKTtcbiAgICAgICAgY29uc3QgY3VycmVudExpbmUgPSBlZGl0b3IuZ2V0Q3Vyc29yKCkubGluZTtcbiAgICAgICAgXG4gICAgICAgIC8vIExvY2F0ZSB0aGUgcHJvbXB0XG4gICAgICAgIGxldCBwcm9tcHRMaW5lID0gY3VycmVudExpbmU7XG4gICAgICAgIHdoaWxlIChwcm9tcHRMaW5lID49IDAgJiYgIWxpbmVzW3Byb21wdExpbmVdLnN0YXJ0c1dpdGgoJz4nKSkge1xuICAgICAgICAgICAgcHJvbXB0TGluZS0tO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBpZiAocHJvbXB0TGluZSA8IDApIHtcbiAgICAgICAgICAgIG5ldyBOb3RpY2UoJ05vIGNoYXQgcHJvbXB0IGZvdW5kLiBQbGVhc2Ugc3RhcnQgbWVzc2FnZSB3aXRoID4nKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgLy8gRXh0cmFjdCBtZXNzYWdlXG4gICAgICAgIGNvbnN0IHVzZXJNZXNzYWdlID0gbGluZXNbcHJvbXB0TGluZV0uc3Vic3RyaW5nKDIpLnRyaW0oKTtcbiAgICAgICAgaWYgKCF1c2VyTWVzc2FnZSkge1xuICAgICAgICAgICAgbmV3IE5vdGljZSgnUGxlYXNlIHR5cGUgYSBtZXNzYWdlIGZpcnN0Jyk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIC8vIFVwZGF0ZSB0aGUgY2hhdCB3aXRoIHRoZSB1c2VyIG1lc3NhZ2VcbiAgICAgICAgbGluZXNbcHJvbXB0TGluZV0gPSBgPiAke3VzZXJNZXNzYWdlfWA7XG4gICAgICAgIFxuICAgICAgICAvLyBBZGQgYSBsb2FkaW5nIGluZGljYXRvclxuICAgICAgICBsaW5lcy5zcGxpY2UocHJvbXB0TGluZSArIDEsIDAsICdcXG5fU3luYXBzZSBpcyB0aGlua2luZy4uLl8nKTtcbiAgICAgICAgZWRpdG9yLnNldFZhbHVlKGxpbmVzLmpvaW4oJ1xcbicpKTtcbiAgICAgICAgXG4gICAgICAgIC8vIEdldCBjaGF0IGhpc3RvcnkgZm9yIGNvbnRleHRcbiAgICAgICAgY29uc3QgY2hhdEhpc3RvcnkgPSB0aGlzLmV4dHJhY3RDaGF0SGlzdG9yeShsaW5lcywgcHJvbXB0TGluZSk7XG4gICAgICAgIFxuICAgICAgICB0cnkge1xuICAgICAgICAgICAgLy8gR2VuZXJhdGUgcmVzcG9uc2VcbiAgICAgICAgICAgIGNvbnN0IHN5c3RlbVByb21wdCA9IHRoaXMucHJvY2Vzc1RlbXBsYXRlVmFyaWFibGVzKHRoaXMuc2V0dGluZ3MuY2hhdFN5c3RlbVByb21wdCk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgdGhpcy5vbGxhbWEuZ2VuZXJhdGUodXNlck1lc3NhZ2UsIHN5c3RlbVByb21wdCwgY2hhdEhpc3RvcnkpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICAvLyBSZW1vdmUgbG9hZGluZyBpbmRpY2F0b3JcbiAgICAgICAgICAgIGxpbmVzLnNwbGljZShwcm9tcHRMaW5lICsgMSwgMSk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vIEFkZCBBSSByZXNwb25zZSBhbmQgbmV3IHByb21wdFxuICAgICAgICAgICAgbGluZXMuc3BsaWNlKHByb21wdExpbmUgKyAxLCAwLCBcbiAgICAgICAgICAgICAgICBgXFxuJHtyZXNwb25zZX1cXG5gLFxuICAgICAgICAgICAgICAgIGA+IGBcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vIFNhdmUgY3VycmVudCBzY3JvbGwgcG9zaXRpb25cbiAgICAgICAgICAgIGNvbnN0IHNjcm9sbEluZm8gPSBlZGl0b3IuZ2V0U2Nyb2xsSW5mbyA/IGVkaXRvci5nZXRTY3JvbGxJbmZvKCkgOiBudWxsO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBlZGl0b3Iuc2V0VmFsdWUobGluZXMuam9pbignXFxuJykpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICAvLyBJbXByb3ZlZCBjdXJzb3IgcG9zaXRpb25pbmcgYW5kIHZpZXcgc2Nyb2xsaW5nIGxvZ2ljXG4gICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgICAgICAvLyBHZXQgdXBkYXRlZCBjb250ZW50XG4gICAgICAgICAgICAgICAgY29uc3QgdXBkYXRlZENvbnRlbnQgPSBlZGl0b3IuZ2V0VmFsdWUoKTtcbiAgICAgICAgICAgICAgICBjb25zdCB1cGRhdGVkTGluZXMgPSB1cGRhdGVkQ29udGVudC5zcGxpdCgnXFxuJyk7XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgLy8gRmluZCB0aGUgbmV3IHByb21wdCBsaW5lIGFmdGVyIHRoZSBjdXJyZW50IG9uZVxuICAgICAgICAgICAgICAgIGxldCBuZXdQcm9tcHRMaW5lID0gLTE7XG4gICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IHByb21wdExpbmUgKyAxOyBpIDwgdXBkYXRlZExpbmVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh1cGRhdGVkTGluZXNbaV0gPT09ICc+ICcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5ld1Byb21wdExpbmUgPSBpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgLy8gSWYgd2UgZm91bmQgdGhlIG5ldyBwcm9tcHQgbGluZSwgcG9zaXRpb24gY3Vyc29yIGFmdGVyIFwiPlwiXG4gICAgICAgICAgICAgICAgaWYgKG5ld1Byb21wdExpbmUgPj0gMCkge1xuICAgICAgICAgICAgICAgICAgICAvLyBTZXQgY3Vyc29yIHBvc2l0aW9uXG4gICAgICAgICAgICAgICAgICAgIGVkaXRvci5zZXRDdXJzb3IoeyBsaW5lOiBuZXdQcm9tcHRMaW5lLCBjaDogMiB9KTtcbiAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgIC8vIFNjcm9sbCB0byB0aGUgbmV3IGN1cnNvciBwb3NpdGlvblxuICAgICAgICAgICAgICAgICAgICBjb25zdCBjbUVkaXRvciA9IChlZGl0b3IgYXMgYW55KS5jbTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNtRWRpdG9yKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBDb2RlTWlycm9yIDZcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjbUVkaXRvci5zY3JvbGxJbnRvVmlldykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNtRWRpdG9yLnNjcm9sbEludG9WaWV3KHsgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpbmU6IG5ld1Byb21wdExpbmUsIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaDogMiBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCAxMDApOyAvLyAxMDBweCBtYXJnaW4gZnJvbSBib3R0b21cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFVzZSBzY3JvbGxJbnRvVmlldyBBUEkgKGlmIGF2YWlsYWJsZSlcbiAgICAgICAgICAgICAgICAgICAgICAgIGVkaXRvci5zY3JvbGxJbnRvVmlldyh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZnJvbTogeyBsaW5lOiBuZXdQcm9tcHRMaW5lLCBjaDogMCB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvOiB7IGxpbmU6IG5ld1Byb21wdExpbmUsIGNoOiAyIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0sIHRydWUpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAvLyBFbnN1cmUgdmlldyBzdGF5cyBhdCBib3R0b21cbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZWRpdG9yRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5jbS1zY3JvbGxlcicpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoZWRpdG9yRWxlbWVudCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gU2Nyb2xsIHRvIGJvdHRvbSBvZiB0aGUgY3VycmVudCB2aWV3XG4gICAgICAgICAgICAgICAgICAgICAgICBlZGl0b3JFbGVtZW50LnNjcm9sbFRvcCA9IGVkaXRvckVsZW1lbnQuc2Nyb2xsSGVpZ2h0O1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICBlZGl0b3IuZm9jdXMoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LCAxMDApOyAvLyBJbmNyZWFzZWQgZGVsYXkgdG8gZW5zdXJlIGVkaXRvciBjb250ZW50IGFuZCBET00gYXJlIGZ1bGx5IHVwZGF0ZWRcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIG5ldyBOb3RpY2UoYEVycm9yOiAke2Vycm9yLm1lc3NhZ2V9YCk7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCdDaGF0IGVycm9yOicsIGVycm9yKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgLy8gUmVtb3ZlIGxvYWRpbmcgaW5kaWNhdG9yIGFuZCBhZGQgZXJyb3IgbWVzc2FnZVxuICAgICAgICAgICAgbGluZXMuc3BsaWNlKHByb21wdExpbmUgKyAxLCAxKTtcbiAgICAgICAgICAgIGxpbmVzLnNwbGljZShwcm9tcHRMaW5lICsgMSwgMCwgJ19FcnJvcjogQ291bGQgbm90IGdlbmVyYXRlIHJlc3BvbnNlXycpO1xuICAgICAgICAgICAgZWRpdG9yLnNldFZhbHVlKGxpbmVzLmpvaW4oJ1xcbicpKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBcbiAgICBhc3luYyBnZW5lcmF0ZUxpdmVTdWdnZXN0aW9uKGVkaXRvcjogRWRpdG9yKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgICAgIGlmICghdGhpcy5zZXR0aW5ncy5lbmFibGVMaXZlU3VnZ2VzdGlvbnMpIHJldHVybjtcbiAgICAgICAgXG4gICAgICAgIC8vIEdldCBjdXJyZW50IGNvbnRleHRcbiAgICAgICAgY29uc3QgY29udGVudCA9IGVkaXRvci5nZXRWYWx1ZSgpO1xuICAgICAgICBjb25zdCBjdXJzb3IgPSBlZGl0b3IuZ2V0Q3Vyc29yKCk7XG4gICAgICAgIGNvbnN0IGN1cnJlbnRMaW5lID0gY3Vyc29yLmxpbmU7XG4gICAgICAgIFxuICAgICAgICAvLyBHZXQgYSBmZXcgbGluZXMgYmVmb3JlIGN1cnJlbnQgbGluZSBmb3IgY29udGV4dFxuICAgICAgICBjb25zdCBjb250ZXh0TGluZXMgPSBjb250ZW50LnNwbGl0KCdcXG4nKS5zbGljZShNYXRoLm1heCgwLCBjdXJyZW50TGluZSAtIDUpLCBjdXJyZW50TGluZSArIDMpO1xuICAgICAgICBjb25zdCBjb250ZXh0ID0gY29udGV4dExpbmVzLmpvaW4oJ1xcbicpO1xuICAgICAgICBcbiAgICAgICAgaWYgKGNvbnRleHQudHJpbSgpLmxlbmd0aCA8IDMpIHJldHVybjsgLy8gTm90IGVub3VnaCBjb250ZXh0XG4gICAgICAgIFxuICAgICAgICB0cnkge1xuICAgICAgICAgICAgLy8gVHJhZGl0aW9uYWwgdGV4dCBjb250aW51YXRpb25cbiAgICAgICAgICAgIGNvbnN0IHN5c3RlbVByb21wdCA9IGBZb3UgYXJlIGFuIEFJIHdyaXRpbmcgYXNzaXN0YW50LiBcbiAgICAgICAgICAgIEJhc2VkIG9uIHRoZSBjb250ZXh0IHByb3ZpZGVkLCBzdWdnZXN0IGEgYnJpZWYgY29udGludWF0aW9uICgxLTMgd29yZHMgbWF4aW11bSkuXG4gICAgICAgICAgICBNYWtlIHlvdXIgc3VnZ2VzdGlvbiBkaXJlY3RseSByZWxldmFudCB0byB3aGF0J3MgYmVpbmcgd3JpdHRlbi5cbiAgICAgICAgICAgIERvIG5vdCByZXBlYXQgd2hhdCdzIGFscmVhZHkgd3JpdHRlbi4gXG4gICAgICAgICAgICBPbmx5IHJldHVybiB0aGUgY29udGludWF0aW9uIHRleHQuIERvIG5vdCBpbmNsdWRlIGFueSBhZGRpdGlvbmFsIHRleHQgb3IgZm9ybWF0dGluZy5gO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHRoaXMub2xsYW1hLmdlbmVyYXRlKGBDb250aW51ZSB0aGlzIHRleHQ6ICR7Y29udGV4dH1gLCBzeXN0ZW1Qcm9tcHQpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICAvLyBEaXNwbGF5IHN1Z2dlc3Rpb24gYXMgZ2hvc3QgdGV4dFxuICAgICAgICAgICAgdGhpcy5kaXNwbGF5R2hvc3RUZXh0KGVkaXRvciwgcmVzcG9uc2UpO1xuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcignU3VnZ2VzdGlvbiBlcnJvcjonLCBlcnJvcik7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIGRpc3BsYXlHaG9zdFRleHQoZWRpdG9yOiBFZGl0b3IsIHRleHQ6IHN0cmluZyk6IHZvaWQge1xuICAgICAgICAvLyBEaXNwbGF5IGdob3N0IHRleHQgc3VnZ2VzdGlvblxuICAgICAgICBpZiAoIXRoaXMuc2V0dGluZ3Muc2hvd0dob3N0VGV4dCkgcmV0dXJuO1xuICAgICAgICBcbiAgICAgICAgLy8gQ3JlYXRlIGEgbm90aWNlIHdpdGggdGhlIHN1Z2dlc3Rpb25cbiAgICAgICAgY29uc3Qgbm90aWNlID0gbmV3IE5vdGljZShgU3VnZ2VzdGlvbjogJHt0ZXh0LnN1YnN0cmluZygwLCA1MCl9JHt0ZXh0Lmxlbmd0aCA+IDUwID8gJy4uLicgOiAnJ31gLCA1MDAwKTtcbiAgICAgICAgXG4gICAgICAgIC8vIEFkZCBhbiBhY2NlcHQgYnV0dG9uXG4gICAgICAgIGlmICh0aGlzLnNldHRpbmdzLmFsbG93UXVpY2tBY2NlcHQpIHtcbiAgICAgICAgICAgIGNvbnN0IG5vdGljZUVsID0gbm90aWNlLm5vdGljZUVsO1xuICAgICAgICAgICAgY29uc3QgYnV0dG9uQ29udGFpbmVyID0gbm90aWNlRWwuY3JlYXRlRGl2KCdzeW5hcHNlLXN1Z2dlc3Rpb24tYWN0aW9ucycpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBjb25zdCBhY2NlcHRCdXR0b24gPSBidXR0b25Db250YWluZXIuY3JlYXRlRWwoJ2J1dHRvbicsIHtcbiAgICAgICAgICAgICAgICB0ZXh0OiAnQWNjZXB0JyxcbiAgICAgICAgICAgICAgICBjbHM6ICdzeW5hcHNlLWFjY2VwdC1idXR0b24nXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgYWNjZXB0QnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IGN1cnNvciA9IGVkaXRvci5nZXRDdXJzb3IoKTtcbiAgICAgICAgICAgICAgICBlZGl0b3IucmVwbGFjZVJhbmdlKFwiIFwiICsgdGV4dCwgY3Vyc29yKTtcbiAgICAgICAgICAgICAgICBub3RpY2UuaGlkZSgpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBOZXcgbWV0aG9kIHRvIHByb2Nlc3MgdGVtcGxhdGUgdmFyaWFibGVzIGluIHByb21wdHNcbiAgICBwcml2YXRlIHByb2Nlc3NUZW1wbGF0ZVZhcmlhYmxlcyh0ZXh0OiBzdHJpbmcpOiBzdHJpbmcge1xuICAgICAgICBsZXQgcHJvY2Vzc2VkID0gdGV4dDtcbiAgICAgICAgXG4gICAgICAgIC8vIFJlcGxhY2UgYnVpbHQtaW4gdmFyaWFibGVzXG4gICAgICAgIHByb2Nlc3NlZCA9IHByb2Nlc3NlZC5yZXBsYWNlKC97e21heFJlc3BvbnNlTGVuZ3RofX0vZywgdGhpcy5zZXR0aW5ncy5tYXhSZXNwb25zZUxlbmd0aC50b1N0cmluZygpKTtcbiAgICAgICAgcHJvY2Vzc2VkID0gcHJvY2Vzc2VkLnJlcGxhY2UoL3t7bW9kZWx9fS9nLCB0aGlzLnNldHRpbmdzLm9sbGFtYU1vZGVsKTtcbiAgICAgICAgcHJvY2Vzc2VkID0gcHJvY2Vzc2VkLnJlcGxhY2UoL3t7ZGF0ZX19L2csIG5ldyBEYXRlKCkudG9Mb2NhbGVEYXRlU3RyaW5nKCkpO1xuICAgICAgICBcbiAgICAgICAgLy8gUmVwbGFjZSBjdXN0b20gdmFyaWFibGVzXG4gICAgICAgIGZvciAoY29uc3QgW2tleSwgdmFsdWVdIG9mIE9iamVjdC5lbnRyaWVzKHRoaXMuc2V0dGluZ3MuY3VzdG9tVGVtcGxhdGVWYXJpYWJsZXMpKSB7XG4gICAgICAgICAgICBwcm9jZXNzZWQgPSBwcm9jZXNzZWQucmVwbGFjZShuZXcgUmVnRXhwKGB7eyR7a2V5fX19YCwgJ2cnKSwgdmFsdWUpO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICByZXR1cm4gcHJvY2Vzc2VkO1xuICAgIH1cblxuICAgIC8vIE5ldyBtZXRob2QgdG8gZ2VuZXJhdGUgbm90ZSBjb250ZW50IGZyb20gdGVtcGxhdGVcbiAgICBwcml2YXRlIGFzeW5jIGdlbmVyYXRlRnJvbVRlbXBsYXRlKHRlbXBsYXRlUGF0aDogc3RyaW5nLCB2YXJpYWJsZXM6IFJlY29yZDxzdHJpbmcsIHN0cmluZz4pOiBQcm9taXNlPHN0cmluZz4ge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgLy8gR2V0IHRlbXBsYXRlIGZpbGVcbiAgICAgICAgICAgIGNvbnN0IHRlbXBsYXRlRmlsZSA9IHRoaXMuYXBwLnZhdWx0LmdldEFic3RyYWN0RmlsZUJ5UGF0aCh0ZW1wbGF0ZVBhdGgpO1xuICAgICAgICAgICAgaWYgKCEodGVtcGxhdGVGaWxlIGluc3RhbmNlb2YgVEZpbGUpKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBUZW1wbGF0ZSBmaWxlIG5vdCBmb3VuZDogJHt0ZW1wbGF0ZVBhdGh9YCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vIFJlYWQgdGVtcGxhdGUgY29udGVudFxuICAgICAgICAgICAgbGV0IHRlbXBsYXRlQ29udGVudCA9IGF3YWl0IHRoaXMuYXBwLnZhdWx0LnJlYWQodGVtcGxhdGVGaWxlKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgLy8gUmVwbGFjZSB2YXJpYWJsZXNcbiAgICAgICAgICAgIGZvciAoY29uc3QgW2tleSwgdmFsdWVdIG9mIE9iamVjdC5lbnRyaWVzKHZhcmlhYmxlcykpIHtcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZUNvbnRlbnQgPSB0ZW1wbGF0ZUNvbnRlbnQucmVwbGFjZShuZXcgUmVnRXhwKGB7eyR7a2V5fX19YCwgJ2cnKSwgdmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgXG4gICAgICAgICAgICByZXR1cm4gdGVtcGxhdGVDb250ZW50O1xuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcignVGVtcGxhdGUgZXJyb3I6JywgZXJyb3IpO1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBGYWlsZWQgdG8gcHJvY2VzcyB0ZW1wbGF0ZTogJHtlcnJvci5tZXNzYWdlfWApO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBzYW5pdGl6ZUZpbGVOYW1lKHRleHQ6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgICAgIC8vIFJlbW92ZSBvciByZXBsYWNlIGludmFsaWQgY2hhcmFjdGVycyBmb3IgZmlsZSBuYW1lc1xuICAgICAgICByZXR1cm4gdGV4dFxuICAgICAgICAgICAgLnJlcGxhY2UoL1teXFx3XFxzLV0vZywgJycpIC8vIFJlbW92ZSBzcGVjaWFsIGNoYXJhY3RlcnMgZXhjZXB0IHdvcmQgY2hhcnMsIHNwYWNlcywgaHlwaGVuc1xuICAgICAgICAgICAgLnJlcGxhY2UoL1xccysvZywgJyAnKSAvLyBSZXBsYWNlIG11bHRpcGxlIHNwYWNlcyB3aXRoIHNpbmdsZSBzcGFjZVxuICAgICAgICAgICAgLnRyaW0oKVxuICAgICAgICAgICAgLnN1YnN0cmluZygwLCA1MCk7IC8vIExpbWl0IGxlbmd0aFxuICAgIH1cbiAgICBcbiAgICBwcml2YXRlIGFzeW5jIGVuc3VyZUZvbGRlckV4aXN0cyhmb2xkZXJQYXRoOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAgICAgaWYgKCFmb2xkZXJQYXRoKSByZXR1cm47XG4gICAgICAgIFxuICAgICAgICBjb25zdCBmb2xkZXJzID0gZm9sZGVyUGF0aC5zcGxpdCgnLycpLmZpbHRlcihwID0+IHAudHJpbSgpKTtcbiAgICAgICAgbGV0IGN1cnJlbnRQYXRoID0gJyc7XG4gICAgICAgIFxuICAgICAgICBmb3IgKGNvbnN0IGZvbGRlciBvZiBmb2xkZXJzKSB7XG4gICAgICAgICAgICBjdXJyZW50UGF0aCA9IGN1cnJlbnRQYXRoID8gYCR7Y3VycmVudFBhdGh9LyR7Zm9sZGVyfWAgOiBmb2xkZXI7XG4gICAgICAgICAgICBpZiAoIXRoaXMuYXBwLnZhdWx0LmdldEFic3RyYWN0RmlsZUJ5UGF0aChjdXJyZW50UGF0aCkpIHtcbiAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLmFwcC52YXVsdC5jcmVhdGVGb2xkZXIoY3VycmVudFBhdGgpO1xuICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYEZhaWxlZCB0byBjcmVhdGUgZm9sZGVyICR7Y3VycmVudFBhdGh9OmAsIGVycm9yKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgcHJpdmF0ZSBnZXRBY3RpdmVFZGl0b3IoKTogRWRpdG9yIHwgbnVsbCB7XG4gICAgICAgIGNvbnN0IHZpZXcgPSB0aGlzLmFwcC53b3Jrc3BhY2UuZ2V0QWN0aXZlVmlld09mVHlwZShNYXJrZG93blZpZXcpO1xuICAgICAgICByZXR1cm4gdmlldz8uZWRpdG9yIHx8IG51bGw7XG4gICAgfVxuICAgIFxuICAgIHByaXZhdGUgZXh0cmFjdENoYXRIaXN0b3J5KGxpbmVzOiBzdHJpbmdbXSwgY3VycmVudFByb21wdExpbmU6IG51bWJlcik6IHN0cmluZyB7XG4gICAgICAgIC8vIEV4dHJhY3QgYWxsIHByZXZpb3VzIGV4Y2hhbmdlcyB0byBnaXZlIGNvbnRleHQgdG8gdGhlIEFJXG4gICAgICAgIGxldCBjaGF0SGlzdG9yeSA9ICcnO1xuICAgICAgICBsZXQgaW5DaGF0ID0gZmFsc2U7XG4gICAgICAgIFxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGN1cnJlbnRQcm9tcHRMaW5lOyBpKyspIHtcbiAgICAgICAgICAgIGNvbnN0IGxpbmUgPSBsaW5lc1tpXTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgLy8gQ2hlY2sgaWYgd2UndmUgcmVhY2hlZCB0aGUgY2hhdCBzZWN0aW9uXG4gICAgICAgICAgICBpZiAobGluZSA9PT0gJyMjIENoYXQnKSB7XG4gICAgICAgICAgICAgICAgaW5DaGF0ID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIFxuICAgICAgICAgICAgaWYgKGluQ2hhdCkge1xuICAgICAgICAgICAgICAgIGlmIChsaW5lLnN0YXJ0c1dpdGgoJz4gJykpIHtcbiAgICAgICAgICAgICAgICAgICAgY2hhdEhpc3RvcnkgKz0gYFVzZXI6ICR7bGluZS5zdWJzdHJpbmcoMil9XFxuYDtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGxpbmUudHJpbSgpICYmICFsaW5lLnN0YXJ0c1dpdGgoJ18nKSAmJiBsaW5lICE9PSAnJykge1xuICAgICAgICAgICAgICAgICAgICBjaGF0SGlzdG9yeSArPSBgQUk6ICR7bGluZX1cXG5gO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgcmV0dXJuIGNoYXRIaXN0b3J5O1xuICAgIH1cbn0iXSwKICAibWFwcGluZ3MiOiAiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUEsSUFBQUEsbUJBQXFFOzs7QUM0QjlELElBQU0sbUJBQW9DO0FBQUEsRUFDN0MsV0FBVztBQUFBLEVBQ1gsYUFBYTtBQUFBLEVBQ2IsaUJBQWlCO0FBQUEsRUFDakIsaUJBQWlCO0FBQUEsRUFDakIsaUJBQWlCO0FBQUEsRUFDakIsbUJBQW1CO0FBQUEsRUFDbkIsbUJBQW1CO0FBQUEsRUFDbkIsaUJBQWlCO0FBQUEsRUFDakIsZ0JBQWdCO0FBQUEsRUFDaEIsWUFBWTtBQUFBLEVBQ1osZ0JBQWdC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
